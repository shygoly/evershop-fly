==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 DONE 0.0s

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.30kB 1.7s done
#1 DONE 1.7s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.8s done
#3 DONE 0.8s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [ 2/21] WORKDIR /app
#5 CACHED

#6 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#6 CACHED

#7 [internal] load build context
#7 transferring context: 46.03kB 3.6s done
#7 DONE 3.6s

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react
#8 4.623 npm error code ERESOLVE
#8 4.623 npm error ERESOLVE unable to resolve dependency tree
#8 4.623 npm error
#8 4.623 npm error While resolving: evershop@1.2.2
#8 4.623 npm error Found: react@18.3.1
#8 4.623 npm error node_modules/react
#8 4.623 npm error   peer react@"^19.0.0 || ^18.0.0 || ^17.0.0" from stream-chat-react@13.10.2
#8 4.623 npm error   node_modules/stream-chat-react
#8 4.623 npm error     stream-chat-react@"*" from the root project
#8 4.623 npm error   peer react@"^16.8 || ^17 || ^18" from @emoji-mart/react@1.1.1
#8 4.623 npm error   node_modules/@emoji-mart/react
#8 4.623 npm error     peerOptional @emoji-mart/react@"^1.1.0" from stream-chat-react@13.10.2
#8 4.623 npm error     node_modules/stream-chat-react
#8 4.623 npm error       stream-chat-react@"*" from the root project
#8 4.623 npm error
#8 4.623 npm error Could not resolve dependency:
#8 4.623 npm error peer react@"^19.2.0" from react-dom@19.2.0
#8 4.623 npm error node_modules/react-dom
#8 4.623 npm error   peer react-dom@"^19.0.0 || ^18.0.0 || ^17.0.0" from stream-chat-react@13.10.2
#8 4.623 npm error   node_modules/stream-chat-react
#8 4.623 npm error     stream-chat-react@"*" from the root project
#8 4.623 npm error
#8 4.623 npm error Fix the upstream dependency conflict, or retry
#8 4.623 npm error this command with --force or --legacy-peer-deps
#8 4.623 npm error to accept an incorrect (and potentially broken) dependency resolution.
#8 4.623 npm error
#8 4.623 npm error
#8 4.623 npm error For a full report see:
#8 4.623 npm error /root/.npm/_logs/2025-11-01T15_00_35_837Z-eresolve-report.txt
#8 4.626 npm notice
#8 4.626 npm notice New minor version of npm available! 11.0.0 -> 11.6.2
#8 4.626 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#8 4.626 npm notice To update run: npm install -g npm@11.6.2
#8 4.626 npm notice
#8 4.626 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-01T15_00_35_837Z-debug-0.log
#8 ERROR: process "/bin/sh -c npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react" did not complete successfully: exit code: 1
------
 > [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react:
4.623 npm error
4.623 npm error
4.623 npm error For a full report see:
4.623 npm error /root/.npm/_logs/2025-11-01T15_00_35_837Z-eresolve-report.txt
4.626 npm notice
4.626 npm notice New minor version of npm available! 11.0.0 -> 11.6.2
4.626 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
4.626 npm notice To update run: npm install -g npm@11.6.2
4.626 npm notice
4.626 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-01T15_00_35_837Z-debug-0.log
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.30kB 1.8s done
#1 DONE 1.9s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 1.2s done
#3 DONE 1.2s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [ 2/21] WORKDIR /app
#5 CACHED

#6 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#6 CACHED

#7 [internal] load build context
#7 transferring context: 15.96kB 1.3s done
#7 DONE 1.3s

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react
#8 2.623 npm error code ERESOLVE
#8 2.623 npm error ERESOLVE unable to resolve dependency tree
#8 2.623 npm error
#8 2.623 npm error While resolving: evershop@1.2.2
#8 2.623 npm error Found: react@18.3.1
#8 2.623 npm error node_modules/react
#8 2.623 npm error   peer react@"^19.0.0 || ^18.0.0 || ^17.0.0" from stream-chat-react@13.10.2
#8 2.623 npm error   node_modules/stream-chat-react
#8 2.623 npm error     stream-chat-react@"*" from the root project
#8 2.623 npm error   peer react@"^16.8 || ^17 || ^18" from @emoji-mart/react@1.1.1
#8 2.623 npm error   node_modules/@emoji-mart/react
#8 2.623 npm error     peerOptional @emoji-mart/react@"^1.1.0" from stream-chat-react@13.10.2
#8 2.623 npm error     node_modules/stream-chat-react
#8 2.623 npm error       stream-chat-react@"*" from the root project
#8 2.623 npm error
#8 2.623 npm error Could not resolve dependency:
#8 2.623 npm error peer react@"^19.2.0" from react-dom@19.2.0
#8 2.623 npm error node_modules/react-dom
#8 2.623 npm error   peer react-dom@"^19.0.0 || ^18.0.0 || ^17.0.0" from stream-chat-react@13.10.2
#8 2.623 npm error   node_modules/stream-chat-react
#8 2.623 npm error     stream-chat-react@"*" from the root project
#8 2.623 npm error
#8 2.623 npm error Fix the upstream dependency conflict, or retry
#8 2.623 npm error this command with --force or --legacy-peer-deps
#8 2.623 npm error to accept an incorrect (and potentially broken) dependency resolution.
#8 2.623 npm error
#8 2.623 npm error
#8 2.623 npm error For a full report see:
#8 2.623 npm error /root/.npm/_logs/2025-11-01T15_00_50_338Z-eresolve-report.txt
#8 2.626 npm notice
#8 2.626 npm notice New minor version of npm available! 11.0.0 -> 11.6.2
#8 2.626 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#8 2.626 npm notice To update run: npm install -g npm@11.6.2
#8 2.626 npm notice
#8 2.627 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-01T15_00_50_338Z-debug-0.log
#8 ERROR: process "/bin/sh -c npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react" did not complete successfully: exit code: 1
------
 > [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react:
2.623 npm error
2.623 npm error
2.623 npm error For a full report see:
2.623 npm error /root/.npm/_logs/2025-11-01T15_00_50_338Z-eresolve-report.txt
2.626 npm notice
2.626 npm notice New minor version of npm available! 11.0.0 -> 11.6.2
2.626 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
2.626 npm notice To update run: npm install -g npm@11.6.2
2.626 npm notice
2.627 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-01T15_00_50_338Z-debug-0.log
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c npm install @evershop/s3_file_storage global-agent stream-chat stream-chat-react" did not complete successfully: exit code: 1
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 1.0s done
#1 DONE 1.0s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.5s

#4 [internal] load build context
#4 DONE 0.0s

#5 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#5 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#5 DONE 0.0s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#4 [internal] load build context
#4 transferring context: 15.96kB 0.8s done
#4 DONE 0.8s

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 10.38 npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
#8 13.00 
#8 13.00 added 317 packages, and audited 1197 packages in 13s
#8 13.00 
#8 13.00 299 packages are looking for funding
#8 13.00   run `npm fund` for details
#8 13.01 
#8 13.01 10 vulnerabilities (3 low, 2 moderate, 4 high, 1 critical)
#8 13.01 
#8 13.01 To address issues that do not require attention, run:
#8 13.01   npm audit fix
#8 13.01 
#8 13.01 To address all issues (including breaking changes), run:
#8 13.01   npm audit fix --force
#8 13.01 
#8 13.01 Run `npm audit` for details.
#8 13.01 npm notice
#8 13.01 npm notice New minor version of npm available! 11.0.0 -> 11.6.2
#8 13.01 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#8 13.01 npm notice To update run: npm install -g npm@11.6.2
#8 13.01 npm notice
#8 DONE 14.6s

#9 [ 5/21] COPY config /app/config
#9 DONE 0.2s

#10 [ 6/21] COPY patches /tmp/patches
#10 DONE 0.0s

#11 [ 7/21] COPY scripts /app/scripts
#11 DONE 0.1s

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.0s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 12.89 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 13.17 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 13.79 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 13.82 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 16.78 
#14 16.78 added 680 packages, and audited 681 packages in 17s
#14 16.78 
#14 16.78 192 packages are looking for funding
#14 16.78   run `npm fund` for details
#14 16.79 
#14 16.79 3 high severity vulnerabilities
#14 16.79 
#14 16.79 To address all issues (including breaking changes), run:
#14 16.79   npm audit fix --force
#14 16.79 
#14 16.79 Run `npm audit` for details.
#14 DONE 20.1s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.082 + '[' -d /app/themes/redtheme ]
#16 0.082 + basename /app/themes/redtheme
#16 0.083 + name=redtheme
#16 0.083 + '[' -f /app/themes/redtheme/package.json ]
#16 0.083 + npm install --prefix /app/themes/redtheme
#16 1.415 
#16 1.415 added 5 packages, and audited 6 packages in 1s
#16 1.416 
#16 1.416 found 0 vulnerabilities
#16 1.441 + npm run build --prefix /app/themes/redtheme
#16 1.625 
#16 1.625 > redtheme@0.1.0 build
#16 1.625 > tsc --project tsconfig.json
#16 1.625 
#16 3.586 + '[' -d /app/themes/redtheme/dist ]
#16 3.586 + mkdir -p /app/themes-src/redtheme
#16 3.587 + rm -rf /app/themes-src/redtheme/dist
#16 3.588 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.592 + '[' -d /app/themes/venia ]
#16 3.592 + basename /app/themes/venia
#16 3.593 + name=venia
#16 3.593 + '[' -f /app/themes/venia/package.json ]
#16 3.593 + npm install --prefix /app/themes/venia
#16 4.778 
#16 4.778 added 5 packages, and audited 6 packages in 1s
#16 4.779 
#16 4.779 found 0 vulnerabilities
#16 4.808 + npm run build --prefix /app/themes/venia
#16 4.978 
#16 4.978 > venia@0.1.0 build
#16 4.978 > tsc --project tsconfig.json
#16 4.978 
#16 6.887 + '[' -d /app/themes/venia/dist ]
#16 6.887 + mkdir -p /app/themes-src/venia
#16 6.888 + rm -rf /app/themes-src/venia/dist
#16 6.889 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.0s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.082 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.086 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.292 
#25 0.292 > evershop@1.2.2 build
#25 0.292 > evershop build
#25 0.292 
#25 3.753 â„¹ Compiling Client
#25 3.795 â„¹ Compiling Server
#25 42.54 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.54   npx update-browserslist-db@latest
#25 42.54   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 142.0 âœ” Server: Compiled successfully in 2.30m
#25 145.0 âœ” Client: Compiled successfully in 2.35m
#25 DONE 145.8s

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.4s done
#26 exporting manifest sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9
#26 exporting manifest sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9 done
#26 exporting config sha256:af5933a730b1511531adcc3def5d0e349725845cc7f157d06cd4747af69eaf49 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K8ZZ000PR1CF7Q1E3K5WCZ20@sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9
#26 pushing layer sha256:af5933a730b1511531adcc3def5d0e349725845cc7f157d06cd4747af69eaf49
#26 pushing layer sha256:ac8d9aa2c5ec5cf37158c857bf9e7f2d4145c235752b507a9e07b48360571f1b
#26 pushing layer sha256:a46ff413efef11212643928571fcf8320a05cb678c8594e87ac75016c4226427
#26 pushing layer sha256:4338f607ed8e4342b4050627a1c00b73d5ae88f50c263fbb53db2566e39c82ce
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:95f29eab8180b69c35348d77dd798c457920cb4d3d9388ebd83a37c0b040151b
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:e3b49b44248655bc4108ec2ef697722545387c53e8135e54189c7c7bb17a5b18
#26 pushing layer sha256:cfe65ee1896ed8107ca4434c8e88e89285b50d093a6c1cd936fa74cae3b74f02
#26 pushing layer sha256:dd8bd820d9d1c694bb86828072fb596ab41b20564c41cc84d5d0ed5df2aa093f
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:98be09cc15e01cb9293339f30eb8be5302292a83abb270f4451ad3b0afd6a33a
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:b81640e992e5569d34ead6ddabb90e93fb057445ae3a88e308d1a5119f042a14
#26 pushing layer sha256:0713ef6d7259715091f8107839febcb33b0b831a5ac73b7360b0421530210339
#26 pushing layer sha256:7b138c82f1b60d0cad7e69721d40fdd35f444acb1de1f21cd11e8014acd87bc3
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:71dc2dbc5ddd12f182fd024a9e654c202f6e2a7da6cca43953065cb34674e910
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:082c11f11d788ef56618593cff75ff7f8e11be757230c94710a25b41ce37c107
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 0.7s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 1.1s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 2.7s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.9s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.9s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 3.9s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.9s done
#26 pushing layer sha256:af5933a730b1511531adcc3def5d0e349725845cc7f157d06cd4747af69eaf49 4.0s done
#26 pushing layer sha256:a46ff413efef11212643928571fcf8320a05cb678c8594e87ac75016c4226427 4.0s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 4.2s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 3.9s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 3.9s done
#26 pushing layer sha256:95f29eab8180b69c35348d77dd798c457920cb4d3d9388ebd83a37c0b040151b 4.0s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 3.9s done
#26 pushing layer sha256:ac8d9aa2c5ec5cf37158c857bf9e7f2d4145c235752b507a9e07b48360571f1b 4.2s done
#26 pushing layer sha256:4338f607ed8e4342b4050627a1c00b73d5ae88f50c263fbb53db2566e39c82ce 4.2s done
#26 pushing layer sha256:cfe65ee1896ed8107ca4434c8e88e89285b50d093a6c1cd936fa74cae3b74f02 4.2s done
#26 pushing layer sha256:dd8bd820d9d1c694bb86828072fb596ab41b20564c41cc84d5d0ed5df2aa093f 4.2s done
#26 pushing layer sha256:98be09cc15e01cb9293339f30eb8be5302292a83abb270f4451ad3b0afd6a33a 4.2s done
#26 pushing layer sha256:b81640e992e5569d34ead6ddabb90e93fb057445ae3a88e308d1a5119f042a14 4.2s done
#26 pushing layer sha256:e3b49b44248655bc4108ec2ef697722545387c53e8135e54189c7c7bb17a5b18 4.4s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 4.2s done
#26 pushing layer sha256:7b138c82f1b60d0cad7e69721d40fdd35f444acb1de1f21cd11e8014acd87bc3 4.2s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 4.2s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 4.2s done
#26 pushing layer sha256:71dc2dbc5ddd12f182fd024a9e654c202f6e2a7da6cca43953065cb34674e910 4.3s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 4.3s done
#26 pushing layer sha256:082c11f11d788ef56618593cff75ff7f8e11be757230c94710a25b41ce37c107 4.4s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 5.0s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K8ZZ000PR1CF7Q1E3K5WCZ20@sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9 5.4s done
#26 pushing layer sha256:0713ef6d7259715091f8107839febcb33b0b831a5ac73b7360b0421530210339 5.4s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K8ZZ000PR1CF7Q1E3K5WCZ20@sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K8ZZ000PR1CF7Q1E3K5WCZ20@sha256:fdd9e93f1cc8c6fdf6c1fa5a51667b4a76b578c815b4645d885ac0ba400f72e9 0.1s done
#26 DONE 14.0s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K8ZZ000PR1CF7Q1E3K5WCZ20
image size: 265 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 1.8s done
#1 DONE 1.8s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.6s done
#3 DONE 0.6s

#4 [internal] load build context
#4 DONE 0.0s

#5 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#5 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#5 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 43.30kB 1.9s done
#4 DONE 1.9s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 5/21] COPY config /app/config
#9 CACHED

#10 [ 6/21] COPY patches /tmp/patches
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.1s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 15.85 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 16.11 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 16.71 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 16.74 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 19.64 
#14 19.64 added 680 packages, and audited 681 packages in 19s
#14 19.64 
#14 19.64 192 packages are looking for funding
#14 19.64   run `npm fund` for details
#14 19.65 
#14 19.65 3 high severity vulnerabilities
#14 19.65 
#14 19.65 To address all issues (including breaking changes), run:
#14 19.65   npm audit fix --force
#14 19.65 
#14 19.65 Run `npm audit` for details.
#14 DONE 23.2s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.102 + '[' -d /app/themes/redtheme ]
#16 0.102 + basename /app/themes/redtheme
#16 0.102 + name=redtheme
#16 0.102 + '[' -f /app/themes/redtheme/package.json ]
#16 0.102 + npm install --prefix /app/themes/redtheme
#16 1.388 
#16 1.388 added 5 packages, and audited 6 packages in 1s
#16 1.388 
#16 1.388 found 0 vulnerabilities
#16 1.416 + npm run build --prefix /app/themes/redtheme
#16 1.602 
#16 1.602 > redtheme@0.1.0 build
#16 1.602 > tsc --project tsconfig.json
#16 1.602 
#16 3.577 + '[' -d /app/themes/redtheme/dist ]
#16 3.577 + mkdir -p /app/themes-src/redtheme
#16 3.578 + rm -rf /app/themes-src/redtheme/dist
#16 3.579 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.583 + '[' -d /app/themes/venia ]
#16 3.583 + basename /app/themes/venia
#16 3.584 + name=venia
#16 3.584 + '[' -f /app/themes/venia/package.json ]
#16 3.584 + npm install --prefix /app/themes/venia
#16 4.741 
#16 4.741 added 5 packages, and audited 6 packages in 1s
#16 4.742 
#16 4.742 found 0 vulnerabilities
#16 4.768 + npm run build --prefix /app/themes/venia
#16 4.938 
#16 4.938 > venia@0.1.0 build
#16 4.938 > tsc --project tsconfig.json
#16 4.938 
#16 6.897 + '[' -d /app/themes/venia/dist ]
#16 6.897 + mkdir -p /app/themes-src/venia
#16 6.898 + rm -rf /app/themes-src/venia/dist
#16 6.898 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.1s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.085 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.089 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.284 
#25 0.284 > evershop@1.2.2 build
#25 0.284 > evershop build
#25 0.284 
#25 3.945 â„¹ Compiling Client
#25 3.985 â„¹ Compiling Server
#25 43.17 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 43.17   npx update-browserslist-db@latest
#25 43.17   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 142.6 âœ” Server: Compiled successfully in 2.31m
#25 146.4 âœ” Client: Compiled successfully in 2.37m
#25 DONE 147.3s

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.0s done
#26 exporting manifest sha256:2aa7202a7e71d721be5e554d0248475eaaf3b51e99097090596cec0442f5338c done
#26 exporting config sha256:35b1d5681078681cf5dcdc2c90a95d4469265597a200534c071cfbe33a40e1a3 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K8ZZWSFYX7PM31RHSZT90K3N@sha256:2aa7202a7e71d721be5e554d0248475eaaf3b51e99097090596cec0442f5338c
#26 pushing layer sha256:35b1d5681078681cf5dcdc2c90a95d4469265597a200534c071cfbe33a40e1a3
#26 pushing layer sha256:077a3fcf58efa7e0e8081808dafdcfc18cd56939b44df5285bc916b708ad313a
#26 pushing layer sha256:ce6c6c3f6e2633fdcea784183ea3b772620cbdefd13544743db70feb8390398d
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:fdf08d4e6c1d2a58d580007c22c80bdba7d733e850d9a24e1fb489180b109d50
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:418075d1cfbb64068425211fc109964c39c8e9739ee4c9482d9865c093bc8696
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:7ccbb96bf315e4c65842aa749a9a1b7e822de293a1f77353f7423bce22898da3
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:a42b20cd8c092047c568afb6479dff0386edc3eb7fa3a4657b9891dd6ef66106
#26 pushing layer sha256:505af552c22c6fec65c1566cdee35e8f22a22c16ec102e7eb4f275ef4d805407
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:701bae1fabf3e1266ea46a54f32109cbaa5d456ad4d32888ffa327d0f0bb1d86
#26 pushing layer sha256:4a73d9d74d8db14aa9eba1354d87071739446e20df4b7291953ce6b32df95dd3
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:c0541a1981567e63659b8fdeb7ac01cf6f8625bd965f957b7e153c1cbfd004d0
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:b1f0acc5826a72f6c7dfe0ab259d1b631e1c62053f40430bb148747b79d6e135
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:0ec488951b4e032aea7c2d117086a72844831a2b1626d3264128b05a5092523e
#26 pushing layer sha256:41d538062cba9483943ec5ab86040cfea385c1d6e170f0b8ab731b3cd878f452
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 1.4s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.6s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 5.7s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 5.7s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 5.7s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 5.7s done
#26 pushing layer sha256:7ccbb96bf315e4c65842aa749a9a1b7e822de293a1f77353f7423bce22898da3 5.7s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 5.7s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 5.7s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 5.7s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 5.7s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 5.7s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 5.7s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 5.7s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 5.7s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 5.7s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 5.7s done
#26 pushing layer sha256:35b1d5681078681cf5dcdc2c90a95d4469265597a200534c071cfbe33a40e1a3 5.9s done
#26 pushing layer sha256:077a3fcf58efa7e0e8081808dafdcfc18cd56939b44df5285bc916b708ad313a 6.0s done
#26 pushing layer sha256:ce6c6c3f6e2633fdcea784183ea3b772620cbdefd13544743db70feb8390398d 6.1s done
#26 pushing layer sha256:418075d1cfbb64068425211fc109964c39c8e9739ee4c9482d9865c093bc8696 5.9s done
#26 pushing layer sha256:a42b20cd8c092047c568afb6479dff0386edc3eb7fa3a4657b9891dd6ef66106 5.9s done
#26 pushing layer sha256:505af552c22c6fec65c1566cdee35e8f22a22c16ec102e7eb4f275ef4d805407 5.9s done
#26 pushing layer sha256:701bae1fabf3e1266ea46a54f32109cbaa5d456ad4d32888ffa327d0f0bb1d86 5.9s done
#26 pushing layer sha256:4a73d9d74d8db14aa9eba1354d87071739446e20df4b7291953ce6b32df95dd3 5.9s done
#26 pushing layer sha256:c0541a1981567e63659b8fdeb7ac01cf6f8625bd965f957b7e153c1cbfd004d0 5.9s done
#26 pushing layer sha256:b1f0acc5826a72f6c7dfe0ab259d1b631e1c62053f40430bb148747b79d6e135 5.9s done
#26 pushing layer sha256:0ec488951b4e032aea7c2d117086a72844831a2b1626d3264128b05a5092523e 5.9s done
#26 pushing layer sha256:41d538062cba9483943ec5ab86040cfea385c1d6e170f0b8ab731b3cd878f452 5.9s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K8ZZWSFYX7PM31RHSZT90K3N@sha256:2aa7202a7e71d721be5e554d0248475eaaf3b51e99097090596cec0442f5338c 6.8s done
#26 pushing layer sha256:fdf08d4e6c1d2a58d580007c22c80bdba7d733e850d9a24e1fb489180b109d50 6.8s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K8ZZWSFYX7PM31RHSZT90K3N@sha256:2aa7202a7e71d721be5e554d0248475eaaf3b51e99097090596cec0442f5338c
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K8ZZWSFYX7PM31RHSZT90K3N@sha256:2aa7202a7e71d721be5e554d0248475eaaf3b51e99097090596cec0442f5338c 0.1s done
#26 DONE 15.0s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K8ZZWSFYX7PM31RHSZT90K3N
image size: 265 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state
> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 2.0s done
#1 DONE 2.0s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 DONE 0.0s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 1.2s done
#3 DONE 1.2s

#4 [internal] load build context
#4 DONE 0.0s

#5 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#5 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#5 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 26.26kB 2.2s done
#4 DONE 2.2s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 5/21] COPY config /app/config
#7 CACHED

#8 [ 6/21] COPY patches /tmp/patches
#8 CACHED

#9 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#9 CACHED

#10 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.0s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 15.08 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 15.36 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 15.91 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 15.94 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 18.77 
#14 18.77 added 680 packages, and audited 681 packages in 19s
#14 18.77 
#14 18.77 192 packages are looking for funding
#14 18.77   run `npm fund` for details
#14 18.78 
#14 18.78 3 high severity vulnerabilities
#14 18.78 
#14 18.78 To address all issues (including breaking changes), run:
#14 18.78   npm audit fix --force
#14 18.78 
#14 18.78 Run `npm audit` for details.
#14 DONE 22.3s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.076 + '[' -d /app/themes/redtheme ]
#16 0.076 + basename /app/themes/redtheme
#16 0.077 + name=redtheme
#16 0.077 + '[' -f /app/themes/redtheme/package.json ]
#16 0.077 + npm install --prefix /app/themes/redtheme
#16 1.348 
#16 1.348 added 5 packages, and audited 6 packages in 1s
#16 1.348 
#16 1.348 found 0 vulnerabilities
#16 1.373 + npm run build --prefix /app/themes/redtheme
#16 1.552 
#16 1.552 > redtheme@0.1.0 build
#16 1.552 > tsc --project tsconfig.json
#16 1.552 
#16 3.464 + '[' -d /app/themes/redtheme/dist ]
#16 3.464 + mkdir -p /app/themes-src/redtheme
#16 3.465 + rm -rf /app/themes-src/redtheme/dist
#16 3.466 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.470 + '[' -d /app/themes/venia ]
#16 3.470 + basename /app/themes/venia
#16 3.470 + name=venia
#16 3.470 + '[' -f /app/themes/venia/package.json ]
#16 3.470 + npm install --prefix /app/themes/venia
#16 4.616 
#16 4.616 added 5 packages, and audited 6 packages in 1s
#16 4.618 
#16 4.618 found 0 vulnerabilities
#16 4.646 + npm run build --prefix /app/themes/venia
#16 4.818 
#16 4.818 > venia@0.1.0 build
#16 4.818 > tsc --project tsconfig.json
#16 4.818 
#16 6.755 + '[' -d /app/themes/venia/dist ]
#16 6.755 + mkdir -p /app/themes-src/venia
#16 6.756 + rm -rf /app/themes-src/venia/dist
#16 6.756 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 6.9s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.089 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.094 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.296 
#25 0.296 > evershop@1.2.2 build
#25 0.296 > evershop build
#25 0.296 
#25 3.402 â„¹ Compiling Client
#25 3.436 â„¹ Compiling Server
#25 41.69 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 41.69   npx update-browserslist-db@latest
#25 41.69   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 141.5 âœ” Server: Compiled successfully in 2.30m
#25 144.6 âœ” Client: Compiled successfully in 2.35m
#25 DONE 145.4s

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.4s done
#26 exporting manifest sha256:1ae7b6ccda36aebd033c17842bb7623bae93fb4571ee1493dcb26fd17004914f done
#26 exporting config sha256:746b989c403bf870d46a92985ec840f93ba23ec4153463c9ff7b87683e21b45f done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K900B5BKT3WQ9HM5WAJCYS4K@sha256:1ae7b6ccda36aebd033c17842bb7623bae93fb4571ee1493dcb26fd17004914f
#26 pushing layer sha256:746b989c403bf870d46a92985ec840f93ba23ec4153463c9ff7b87683e21b45f
#26 pushing layer sha256:76f5e73230841296de89820be974fd6f4d80cb1d2a0370c61833864c783f9b99
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:f638b00e3f2b137852a606afa12f3e9ad09bfad486e47d5eb9cbd4bdbe9134ce
#26 pushing layer sha256:28491938171abbe24c42ba596d010d30a2e0fc8fd3dc365e7aab79f3d84371a8
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:7097fbb659f3cfa68876127aa34aaf15db2878277666a882591d138c6c9dbc7c
#26 pushing layer sha256:a97d2b12a97db52bdfbb0aaf7d055b4e84347bd405bf152e77341d2c7af11c9f
#26 pushing layer sha256:bce245308f69986ec3a129c228f061cdceba9f4e2e41c4478e5a41b86b0917a5
#26 pushing layer sha256:3ddd045b102ac949a6c68a958bdd4d6c5b8f2acab622c24be0fc2fb8527489a4
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:93432f931d6a1aebe0bda26f6143134dd501702f6935284f703018b9d892f8ad
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:56dc6dae060573d4ce7a15242d9e9a869e30f1dcb2475d5ceef3395ea0f9a10e
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:c89d8bcab7b438368519aa446bad0a9765ede95fe13971442a9ba47a5de28cd7
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:ada214abe90198e49a67ec1d361b5ae6165db97fc456ae2811ce5e379d3c70d3
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:90a42e89923c63f010a1195af31317fd69171ca9aa43eef96d3c8167a1e4931f
#26 pushing layer sha256:c354846f1e48fe45def303997cfd53594c9f4b35cd4da0c7d4b12a5990254ebf
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 0.7s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 3.6s done
#26 pushing layer sha256:746b989c403bf870d46a92985ec840f93ba23ec4153463c9ff7b87683e21b45f 3.7s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.7s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 3.7s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 3.7s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 3.7s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 3.7s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 3.7s done
#26 pushing layer sha256:bce245308f69986ec3a129c228f061cdceba9f4e2e41c4478e5a41b86b0917a5 3.7s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 3.7s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 3.7s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 3.7s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 3.7s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 3.7s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 3.7s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 3.7s done
#26 pushing layer sha256:90a42e89923c63f010a1195af31317fd69171ca9aa43eef96d3c8167a1e4931f 3.9s done
#26 pushing layer sha256:7097fbb659f3cfa68876127aa34aaf15db2878277666a882591d138c6c9dbc7c 3.9s done
#26 pushing layer sha256:a97d2b12a97db52bdfbb0aaf7d055b4e84347bd405bf152e77341d2c7af11c9f 3.9s done
#26 pushing layer sha256:3ddd045b102ac949a6c68a958bdd4d6c5b8f2acab622c24be0fc2fb8527489a4 3.9s done
#26 pushing layer sha256:93432f931d6a1aebe0bda26f6143134dd501702f6935284f703018b9d892f8ad 3.9s done
#26 pushing layer sha256:56dc6dae060573d4ce7a15242d9e9a869e30f1dcb2475d5ceef3395ea0f9a10e 3.9s done
#26 pushing layer sha256:ada214abe90198e49a67ec1d361b5ae6165db97fc456ae2811ce5e379d3c70d3 3.9s done
#26 pushing layer sha256:28491938171abbe24c42ba596d010d30a2e0fc8fd3dc365e7aab79f3d84371a8 3.9s done
#26 pushing layer sha256:76f5e73230841296de89820be974fd6f4d80cb1d2a0370c61833864c783f9b99 4.1s done
#26 pushing layer sha256:f638b00e3f2b137852a606afa12f3e9ad09bfad486e47d5eb9cbd4bdbe9134ce 3.9s done
#26 pushing layer sha256:c89d8bcab7b438368519aa446bad0a9765ede95fe13971442a9ba47a5de28cd7 3.9s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K900B5BKT3WQ9HM5WAJCYS4K@sha256:1ae7b6ccda36aebd033c17842bb7623bae93fb4571ee1493dcb26fd17004914f 4.8s done
#26 pushing layer sha256:c354846f1e48fe45def303997cfd53594c9f4b35cd4da0c7d4b12a5990254ebf 4.8s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K900B5BKT3WQ9HM5WAJCYS4K@sha256:1ae7b6ccda36aebd033c17842bb7623bae93fb4571ee1493dcb26fd17004914f
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K900B5BKT3WQ9HM5WAJCYS4K@sha256:1ae7b6ccda36aebd033c17842bb7623bae93fb4571ee1493dcb26fd17004914f 0.1s done
#26 DONE 13.4s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K900B5BKT3WQ9HM5WAJCYS4K
image size: 265 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.5s done
#1 DONE 0.5s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.3s done
#3 DONE 0.3s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 44.96kB 0.7s done
#5 DONE 0.7s

#6 [ 5/21] COPY config /app/config
#6 CACHED

#7 [ 2/21] WORKDIR /app
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 6/21] COPY patches /tmp/patches
#9 CACHED

#10 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.1s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 16.01 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 16.29 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 16.93 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 17.19 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 19.85 
#14 19.85 added 680 packages, and audited 681 packages in 19s
#14 19.85 
#14 19.85 192 packages are looking for funding
#14 19.85   run `npm fund` for details
#14 19.86 
#14 19.86 3 high severity vulnerabilities
#14 19.86 
#14 19.86 To address all issues (including breaking changes), run:
#14 19.86   npm audit fix --force
#14 19.86 
#14 19.86 Run `npm audit` for details.
#14 DONE 21.6s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.084 + '[' -d /app/themes/redtheme ]
#16 0.085 + basename /app/themes/redtheme
#16 0.085 + name=redtheme
#16 0.085 + '[' -f /app/themes/redtheme/package.json ]
#16 0.085 + npm install --prefix /app/themes/redtheme
#16 1.377 
#16 1.377 added 5 packages, and audited 6 packages in 1s
#16 1.378 
#16 1.378 found 0 vulnerabilities
#16 1.413 + npm run build --prefix /app/themes/redtheme
#16 1.605 
#16 1.605 > redtheme@0.1.0 build
#16 1.605 > tsc --project tsconfig.json
#16 1.605 
#16 3.613 + '[' -d /app/themes/redtheme/dist ]
#16 3.613 + mkdir -p /app/themes-src/redtheme
#16 3.614 + rm -rf /app/themes-src/redtheme/dist
#16 3.614 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.618 + '[' -d /app/themes/venia ]
#16 3.618 + basename /app/themes/venia
#16 3.619 + name=venia
#16 3.619 + '[' -f /app/themes/venia/package.json ]
#16 3.619 + npm install --prefix /app/themes/venia
#16 4.805 
#16 4.805 added 5 packages, and audited 6 packages in 1s
#16 4.807 
#16 4.807 found 0 vulnerabilities
#16 4.832 + npm run build --prefix /app/themes/venia
#16 5.009 
#16 5.009 > venia@0.1.0 build
#16 5.009 > tsc --project tsconfig.json
#16 5.009 
#16 6.925 + '[' -d /app/themes/venia/dist ]
#16 6.925 + mkdir -p /app/themes-src/venia
#16 6.926 + rm -rf /app/themes-src/venia/dist
#16 6.926 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.1s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.087 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.091 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.279 
#25 0.279 > evershop@1.2.2 build
#25 0.279 > evershop build
#25 0.279 
#25 3.887 â„¹ Compiling Client
#25 3.929 â„¹ Compiling Server
#25 42.85 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.85   npx update-browserslist-db@latest
#25 42.85   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 144.9 âœ” Server: Compiled successfully in 2.35m
#25 147.3 âœ” Client: Compiled successfully in 2.39m
#25 DONE 148.2s

#26 exporting to image
#26 exporting layers
#26 exporting layers 7.9s done
#26 exporting manifest sha256:26d2dad0e9b7f9fcbe56be213d708d2cfe902528254388dc239ecafdb70743d2 done
#26 exporting config sha256:f6f10db38448e55c830348b2156cf43744f987690c9b6c4d1a7f504b1322f7f1 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K916BYHSMVGQQ8HWS18AYT10@sha256:26d2dad0e9b7f9fcbe56be213d708d2cfe902528254388dc239ecafdb70743d2
#26 pushing layer sha256:f6f10db38448e55c830348b2156cf43744f987690c9b6c4d1a7f504b1322f7f1
#26 pushing layer sha256:26a8e81072d7fa7499b9f344b6720df7a567b334e09f83b013900548bf16f5be
#26 pushing layer sha256:de763364880292b257e9457d7943eaf01ec4fc5cc11e36eb1fe74d76a90c9d00
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:b5c2e64288cbf1fe26f0627ac3ec2718560e7c7b13eed2679365a4500aaf59c9
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:a515a6dbdcaa7ec3430c6292489efdf49df6da700cd4cb1942270e2e34e506d5
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:7fd30b81884dc7e7f1bf1ed8f92d4cbc59d6f901687d54a1b72cb7d7abf779ae
#26 pushing layer sha256:636911e96ab366f0b333fd842fef8409b1d3d85fc6806e5dc62f4d9b14bcbe2c
#26 pushing layer sha256:4058fe1c50933eb875945a2895c7a5144f1761d4cbd3a30b8a2c930d068d5652
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:e0e5ec3d64d7312579eba7bfb7c917ccc5c589d8150dd34dee586108117dc403
#26 pushing layer sha256:cf63fd67436d2ddc3ea24be86e9216c7326e56a379b34791f4ab7a4371456843
#26 pushing layer sha256:d39c2c247d2ec089bbe7210287c074ee73956889d02ebee8dec86a56394ce001
#26 pushing layer sha256:2ccdb91dfb50235209b7fc1e5548550b50b7a711ac6719ab4eac5b43949ccca8
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:49e74f1b178eb0932584683aa84164e8ad476bef20cd3466d9a94953bf7f5d40
#26 pushing layer sha256:fc62a599dc927e60494d1783a0286e8a11f7e8524b414bbed22f2b550910879c
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 0.3s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 0.8s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 1.0s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 1.9s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.4s done
#26 pushing layer sha256:f6f10db38448e55c830348b2156cf43744f987690c9b6c4d1a7f504b1322f7f1 2.5s done
#26 pushing layer sha256:de763364880292b257e9457d7943eaf01ec4fc5cc11e36eb1fe74d76a90c9d00 2.5s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 2.4s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.4s done
#26 pushing layer sha256:a515a6dbdcaa7ec3430c6292489efdf49df6da700cd4cb1942270e2e34e506d5 2.5s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 2.4s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.4s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.4s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 2.4s done
#26 pushing layer sha256:26a8e81072d7fa7499b9f344b6720df7a567b334e09f83b013900548bf16f5be 2.5s done
#26 pushing layer sha256:b5c2e64288cbf1fe26f0627ac3ec2718560e7c7b13eed2679365a4500aaf59c9 2.5s done
#26 pushing layer sha256:7fd30b81884dc7e7f1bf1ed8f92d4cbc59d6f901687d54a1b72cb7d7abf779ae 2.5s done
#26 pushing layer sha256:636911e96ab366f0b333fd842fef8409b1d3d85fc6806e5dc62f4d9b14bcbe2c 2.6s done
#26 pushing layer sha256:4058fe1c50933eb875945a2895c7a5144f1761d4cbd3a30b8a2c930d068d5652 2.6s done
#26 pushing layer sha256:e0e5ec3d64d7312579eba7bfb7c917ccc5c589d8150dd34dee586108117dc403 2.6s done
#26 pushing layer sha256:d39c2c247d2ec089bbe7210287c074ee73956889d02ebee8dec86a56394ce001 2.6s done
#26 pushing layer sha256:2ccdb91dfb50235209b7fc1e5548550b50b7a711ac6719ab4eac5b43949ccca8 2.6s done
#26 pushing layer sha256:49e74f1b178eb0932584683aa84164e8ad476bef20cd3466d9a94953bf7f5d40 2.6s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.5s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.5s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 2.5s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 2.5s done
#26 pushing layer sha256:fc62a599dc927e60494d1783a0286e8a11f7e8524b414bbed22f2b550910879c 2.8s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K916BYHSMVGQQ8HWS18AYT10@sha256:26d2dad0e9b7f9fcbe56be213d708d2cfe902528254388dc239ecafdb70743d2 3.5s done
#26 pushing layer sha256:cf63fd67436d2ddc3ea24be86e9216c7326e56a379b34791f4ab7a4371456843 3.5s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K916BYHSMVGQQ8HWS18AYT10@sha256:26d2dad0e9b7f9fcbe56be213d708d2cfe902528254388dc239ecafdb70743d2
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K916BYHSMVGQQ8HWS18AYT10@sha256:26d2dad0e9b7f9fcbe56be213d708d2cfe902528254388dc239ecafdb70743d2 0.1s done
#26 DONE 11.5s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K916BYHSMVGQQ8HWS18AYT10
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state
> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.5s done
#3 DONE 0.5s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 19.51kB 0.8s done
#5 DONE 0.9s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 5/21] COPY config /app/config
#9 CACHED

#10 [ 6/21] COPY patches /tmp/patches
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.1s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 18.23 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 18.50 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 19.10 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 19.14 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 22.00 
#14 22.00 added 680 packages, and audited 681 packages in 22s
#14 22.00 
#14 22.00 192 packages are looking for funding
#14 22.00   run `npm fund` for details
#14 22.01 
#14 22.01 3 high severity vulnerabilities
#14 22.01 
#14 22.01 To address all issues (including breaking changes), run:
#14 22.01   npm audit fix --force
#14 22.01 
#14 22.01 Run `npm audit` for details.
#14 DONE 24.6s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.077 + '[' -d /app/themes/redtheme ]
#16 0.077 + basename /app/themes/redtheme
#16 0.077 + name=redtheme
#16 0.077 + '[' -f /app/themes/redtheme/package.json ]
#16 0.077 + npm install --prefix /app/themes/redtheme
#16 1.395 
#16 1.395 added 5 packages, and audited 6 packages in 1s
#16 1.396 
#16 1.396 found 0 vulnerabilities
#16 1.427 + npm run build --prefix /app/themes/redtheme
#16 1.609 
#16 1.609 > redtheme@0.1.0 build
#16 1.609 > tsc --project tsconfig.json
#16 1.609 
#16 3.583 + '[' -d /app/themes/redtheme/dist ]
#16 3.583 + mkdir -p /app/themes-src/redtheme
#16 3.584 + rm -rf /app/themes-src/redtheme/dist
#16 3.585 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.589 + '[' -d /app/themes/venia ]
#16 3.589 + basename /app/themes/venia
#16 3.590 + name=venia
#16 3.590 + '[' -f /app/themes/venia/package.json ]
#16 3.590 + npm install --prefix /app/themes/venia
#16 4.764 
#16 4.764 added 5 packages, and audited 6 packages in 1s
#16 4.766 
#16 4.766 found 0 vulnerabilities
#16 4.791 + npm run build --prefix /app/themes/venia
#16 4.973 
#16 4.973 > venia@0.1.0 build
#16 4.973 > tsc --project tsconfig.json
#16 4.973 
#16 6.927 + '[' -d /app/themes/venia/dist ]
#16 6.927 + mkdir -p /app/themes-src/venia
#16 6.928 + rm -rf /app/themes-src/venia/dist
#16 6.929 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.1s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.082 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.087 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.283 
#25 0.283 > evershop@1.2.2 build
#25 0.283 > evershop build
#25 0.283 
#25 4.021 â„¹ Compiling Client
#25 4.071 â„¹ Compiling Server
#25 42.90 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.90   npx update-browserslist-db@latest
#25 42.90   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 142.8 âœ” Server: Compiled successfully in 2.31m
#25 146.3 âœ” Client: Compiled successfully in 2.37m
#25 DONE 147.1s

#26 exporting to image
#26 exporting layers
#26 exporting layers 7.9s done
#26 exporting manifest sha256:6def1501c084eaeb064dfcad2c64653163463b405b37b0ae46ea530a6e28b4a1 done
#26 exporting config sha256:2442b01027fe017f133cc185754248ae0511aa27c1db54f997b96c6c7193abdc done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K918NGJH5PMFNCCPRH8T90BA@sha256:6def1501c084eaeb064dfcad2c64653163463b405b37b0ae46ea530a6e28b4a1
#26 pushing layer sha256:2442b01027fe017f133cc185754248ae0511aa27c1db54f997b96c6c7193abdc
#26 pushing layer sha256:fade87934af8143cd5fa86f637293f34f1f672420be3980a505edea073f12291
#26 pushing layer sha256:93b1bcdc86b7cc163600d3cbec4d894c69db3930bdf3bc360c7c78e251fdf3a2
#26 pushing layer sha256:1dc6067412711f24aa1fce3545ada60ee97b9b03e63d7ea1b3da3ddbe2507a0b
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:4f6f8511134d1e9fd8cb4aca48ffb1d088c974f670e934ab449b226c4e0518f3
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:355bcf0d7acaa04726d3670c887fb51541bdef682dca52ad3038d5515de7ccdc
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:a415ab3a0759b948e45836a2f251b576c80cd6e075e6ef87d6ecffc70e886392
#26 pushing layer sha256:d938ecc2814ff1b88ddd08e2e6bf910d7b300bb297942066ab75515e1ced424c
#26 pushing layer sha256:05f09a8691278d15fa1ec50bd581e071c6571e31755b5bcea9eb4e57596a03a9
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:a0dd94a1e3fbedc005ab1822ff5c33797b6973475ebff30847e1304afaf8043a
#26 pushing layer sha256:17465b51f61efda527b8638235b25fc7af884d7555e4ffea709db5e325c5a85d
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:1b460321b936ed81bddffcfb10811f88805b6b7e69d7754b60b3dcc7587f461f
#26 pushing layer sha256:da15d58030f96e619ed25f8beac1196a3e68e5618c0e481d60e9cc3ff2ad3f7c
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:e510d8b1f82ce431a27a62843b2ce8e9fda0fea3d5ca4e94b8b28d4ff0dea688
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 0.7s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 2.8s done
#26 pushing layer sha256:2442b01027fe017f133cc185754248ae0511aa27c1db54f997b96c6c7193abdc 3.0s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 2.8s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.8s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 2.8s done
#26 pushing layer sha256:355bcf0d7acaa04726d3670c887fb51541bdef682dca52ad3038d5515de7ccdc 2.9s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 2.8s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.8s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 2.8s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.8s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 2.8s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 2.8s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.8s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 2.8s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.8s done
#26 pushing layer sha256:a415ab3a0759b948e45836a2f251b576c80cd6e075e6ef87d6ecffc70e886392 3.1s done
#26 pushing layer sha256:d938ecc2814ff1b88ddd08e2e6bf910d7b300bb297942066ab75515e1ced424c 3.1s done
#26 pushing layer sha256:05f09a8691278d15fa1ec50bd581e071c6571e31755b5bcea9eb4e57596a03a9 3.1s done
#26 pushing layer sha256:a0dd94a1e3fbedc005ab1822ff5c33797b6973475ebff30847e1304afaf8043a 3.0s done
#26 pushing layer sha256:17465b51f61efda527b8638235b25fc7af884d7555e4ffea709db5e325c5a85d 3.0s done
#26 pushing layer sha256:1b460321b936ed81bddffcfb10811f88805b6b7e69d7754b60b3dcc7587f461f 3.1s done
#26 pushing layer sha256:da15d58030f96e619ed25f8beac1196a3e68e5618c0e481d60e9cc3ff2ad3f7c 3.1s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 3.1s done
#26 pushing layer sha256:fade87934af8143cd5fa86f637293f34f1f672420be3980a505edea073f12291 3.1s done
#26 pushing layer sha256:1dc6067412711f24aa1fce3545ada60ee97b9b03e63d7ea1b3da3ddbe2507a0b 3.3s done
#26 pushing layer sha256:4f6f8511134d1e9fd8cb4aca48ffb1d088c974f670e934ab449b226c4e0518f3 3.1s done
#26 pushing layer sha256:e510d8b1f82ce431a27a62843b2ce8e9fda0fea3d5ca4e94b8b28d4ff0dea688 3.1s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K918NGJH5PMFNCCPRH8T90BA@sha256:6def1501c084eaeb064dfcad2c64653163463b405b37b0ae46ea530a6e28b4a1 3.9s done
#26 pushing layer sha256:93b1bcdc86b7cc163600d3cbec4d894c69db3930bdf3bc360c7c78e251fdf3a2 3.9s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K918NGJH5PMFNCCPRH8T90BA@sha256:6def1501c084eaeb064dfcad2c64653163463b405b37b0ae46ea530a6e28b4a1
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K918NGJH5PMFNCCPRH8T90BA@sha256:6def1501c084eaeb064dfcad2c64653163463b405b37b0ae46ea530a6e28b4a1 0.1s done
#26 DONE 11.9s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K918NGJH5PMFNCCPRH8T90BA
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.8s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 19.43kB 0.8s done
#5 DONE 0.8s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 5/21] COPY config /app/config
#9 CACHED

#10 [ 6/21] COPY patches /tmp/patches
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.1s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 16.46 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 16.74 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 17.42 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 17.58 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 20.31 
#14 20.31 added 680 packages, and audited 681 packages in 20s
#14 20.31 
#14 20.31 192 packages are looking for funding
#14 20.31   run `npm fund` for details
#14 20.32 
#14 20.32 3 high severity vulnerabilities
#14 20.32 
#14 20.32 To address all issues (including breaking changes), run:
#14 20.32   npm audit fix --force
#14 20.32 
#14 20.32 Run `npm audit` for details.
#14 DONE 22.1s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.080 + '[' -d /app/themes/redtheme ]
#16 0.081 + basename /app/themes/redtheme
#16 0.081 + name=redtheme
#16 0.081 + '[' -f /app/themes/redtheme/package.json ]
#16 0.081 + npm install --prefix /app/themes/redtheme
#16 1.375 
#16 1.375 added 5 packages, and audited 6 packages in 1s
#16 1.375 
#16 1.375 found 0 vulnerabilities
#16 1.403 + npm run build --prefix /app/themes/redtheme
#16 1.581 
#16 1.581 > redtheme@0.1.0 build
#16 1.581 > tsc --project tsconfig.json
#16 1.581 
#16 3.626 + '[' -d /app/themes/redtheme/dist ]
#16 3.626 + mkdir -p /app/themes-src/redtheme
#16 3.627 + rm -rf /app/themes-src/redtheme/dist
#16 3.628 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.632 + '[' -d /app/themes/venia ]
#16 3.632 + basename /app/themes/venia
#16 3.633 + name=venia
#16 3.633 + '[' -f /app/themes/venia/package.json ]
#16 3.633 + npm install --prefix /app/themes/venia
#16 4.829 
#16 4.829 added 5 packages, and audited 6 packages in 1s
#16 4.831 
#16 4.831 found 0 vulnerabilities
#16 4.860 + npm run build --prefix /app/themes/venia
#16 5.036 
#16 5.036 > venia@0.1.0 build
#16 5.036 > tsc --project tsconfig.json
#16 5.036 
#16 7.068 + '[' -d /app/themes/venia/dist ]
#16 7.068 + mkdir -p /app/themes-src/venia
#16 7.069 + rm -rf /app/themes-src/venia/dist
#16 7.070 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.2s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.077 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.081 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.287 
#25 0.287 > evershop@1.2.2 build
#25 0.287 > evershop build
#25 0.287 
#25 3.904 â„¹ Compiling Client
#25 3.945 â„¹ Compiling Server
#25 42.64 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.64   npx update-browserslist-db@latest
#25 42.64   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 142.9 âœ” Server: Compiled successfully in 2.32m
#25 145.6 âœ” Client: Compiled successfully in 2.36m
#25 DONE 146.4s

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.1s done
#26 exporting manifest sha256:ef2e68ace20626de43c8049bb52965828fcdbdaf3d80ae4099dba381004be608 done
#26 exporting config sha256:a60ffdc9c2b91f73370603bdac6ef38ef4920fa162735f24fbbf8a3212510ece done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91957QEXXEVAHM7GPKRHNTK@sha256:ef2e68ace20626de43c8049bb52965828fcdbdaf3d80ae4099dba381004be608
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:a60ffdc9c2b91f73370603bdac6ef38ef4920fa162735f24fbbf8a3212510ece
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:9d11d0f1af87207f05d9bf90a2795cb117be2e6b0af4e5b31137dfc2074f44b0
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:00d4e3b2319ac801a1df3c7165243d0821fe0776ee1a4166bb40adbf0c620def
#26 pushing layer sha256:97da2c8035a1ebf01a1d92f89df4cfd440183ab77340432b7a3722127db0c80b
#26 pushing layer sha256:394abe6ad920d79bbba929f8e5cb6780d13aa60ba2d8add3bcb76081d02c75db
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:ab4d812dc87fb9e5c4f0a2bb8d7dfd74a4ec7fe6114720f3ddf7619b23517298
#26 pushing layer sha256:2b1e6b6d5a3693989f3a45ae72c7052d221b58309ef40c7acc84c35c63dbf951
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:9fabbcbfd5d8d5c72985a99c47ccb4dea5a7cc67c18951eeb7680ac4321417af
#26 pushing layer sha256:cfb820f8b003a3127cda436c9179215dbe391aa738e80d6ff97493682a29d60b
#26 pushing layer sha256:4f66776da2b251e6e602ea40b9e67fce9b2de9c4245303f07f0b31d8738d8ed6
#26 pushing layer sha256:c4d16a1b0fa219882e81fd378d82f39a668106b00a4709ef57b10e9d7e4a9909
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:e345d7f01d9fffd8d45778ed1ea2f8a41acf890cd210623883d5f334b0012c8d
#26 pushing layer sha256:d07c946cc9fe53b2c57c9b952b20299cd765dd9ca4e823d406ac7731778aa624
#26 pushing layer sha256:946bad3f9b69d27158b590f6684d936ff987f5d1d65d877d7763132e2720982b
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 0.3s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 0.4s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 1.2s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 1.7s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.5s done
#26 pushing layer sha256:a60ffdc9c2b91f73370603bdac6ef38ef4920fa162735f24fbbf8a3212510ece 2.5s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 2.5s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.5s done
#26 pushing layer sha256:97da2c8035a1ebf01a1d92f89df4cfd440183ab77340432b7a3722127db0c80b 2.5s done
#26 pushing layer sha256:394abe6ad920d79bbba929f8e5cb6780d13aa60ba2d8add3bcb76081d02c75db 2.5s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.5s done
#26 pushing layer sha256:ab4d812dc87fb9e5c4f0a2bb8d7dfd74a4ec7fe6114720f3ddf7619b23517298 2.6s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.5s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.5s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.5s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 2.5s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 2.5s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 2.5s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 2.6s done
#26 pushing layer sha256:9d11d0f1af87207f05d9bf90a2795cb117be2e6b0af4e5b31137dfc2074f44b0 2.6s done
#26 pushing layer sha256:00d4e3b2319ac801a1df3c7165243d0821fe0776ee1a4166bb40adbf0c620def 2.6s done
#26 pushing layer sha256:2b1e6b6d5a3693989f3a45ae72c7052d221b58309ef40c7acc84c35c63dbf951 2.6s done
#26 pushing layer sha256:cfb820f8b003a3127cda436c9179215dbe391aa738e80d6ff97493682a29d60b 2.7s done
#26 pushing layer sha256:4f66776da2b251e6e602ea40b9e67fce9b2de9c4245303f07f0b31d8738d8ed6 2.7s done
#26 pushing layer sha256:c4d16a1b0fa219882e81fd378d82f39a668106b00a4709ef57b10e9d7e4a9909 2.6s done
#26 pushing layer sha256:e345d7f01d9fffd8d45778ed1ea2f8a41acf890cd210623883d5f334b0012c8d 2.7s done
#26 pushing layer sha256:d07c946cc9fe53b2c57c9b952b20299cd765dd9ca4e823d406ac7731778aa624 2.7s done
#26 pushing layer sha256:9fabbcbfd5d8d5c72985a99c47ccb4dea5a7cc67c18951eeb7680ac4321417af 2.8s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91957QEXXEVAHM7GPKRHNTK@sha256:ef2e68ace20626de43c8049bb52965828fcdbdaf3d80ae4099dba381004be608 3.5s done
#26 pushing layer sha256:946bad3f9b69d27158b590f6684d936ff987f5d1d65d877d7763132e2720982b 3.5s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91957QEXXEVAHM7GPKRHNTK@sha256:ef2e68ace20626de43c8049bb52965828fcdbdaf3d80ae4099dba381004be608
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91957QEXXEVAHM7GPKRHNTK@sha256:ef2e68ace20626de43c8049bb52965828fcdbdaf3d80ae4099dba381004be608 0.1s done
#26 DONE 11.8s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91957QEXXEVAHM7GPKRHNTK
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 20.49kB 0.7s done
#5 ...

#6 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#6 CACHED

#7 [ 5/21] COPY config /app/config
#7 CACHED

#8 [ 6/21] COPY patches /tmp/patches
#8 CACHED

#9 [ 2/21] WORKDIR /app
#9 CACHED

#10 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 0.1s

#5 [internal] load build context
#5 ...

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 16.04 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 16.33 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 16.88 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 16.95 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 19.80 
#14 19.80 added 680 packages, and audited 681 packages in 19s
#14 19.80 
#14 19.80 192 packages are looking for funding
#14 19.80   run `npm fund` for details
#14 19.81 
#14 19.81 3 high severity vulnerabilities
#14 19.81 
#14 19.81 To address all issues (including breaking changes), run:
#14 19.81   npm audit fix --force
#14 19.81 
#14 19.81 Run `npm audit` for details.
#14 DONE 21.5s

#5 [internal] load build context
#5 ...

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#5 [internal] load build context
#5 ...

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.068 + '[' -d /app/themes/redtheme ]
#16 0.069 + basename /app/themes/redtheme
#16 0.069 + name=redtheme
#16 0.069 + '[' -f /app/themes/redtheme/package.json ]
#16 0.069 + npm install --prefix /app/themes/redtheme
#16 1.393 
#16 1.393 added 5 packages, and audited 6 packages in 1s
#16 1.394 
#16 1.394 found 0 vulnerabilities
#16 1.422 + npm run build --prefix /app/themes/redtheme
#16 1.598 
#16 1.598 > redtheme@0.1.0 build
#16 1.598 > tsc --project tsconfig.json
#16 1.598 
#16 3.583 + '[' -d /app/themes/redtheme/dist ]
#16 3.583 + mkdir -p /app/themes-src/redtheme
#16 3.584 + rm -rf /app/themes-src/redtheme/dist
#16 3.585 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.588 + '[' -d /app/themes/venia ]
#16 3.589 + basename /app/themes/venia
#16 3.589 + name=venia
#16 3.589 + '[' -f /app/themes/venia/package.json ]
#16 3.589 + npm install --prefix /app/themes/venia
#16 4.732 
#16 4.732 added 5 packages, and audited 6 packages in 1s
#16 4.733 
#16 4.733 found 0 vulnerabilities
#16 4.759 + npm run build --prefix /app/themes/venia
#16 4.928 
#16 4.928 > venia@0.1.0 build
#16 4.928 > tsc --project tsconfig.json
#16 4.928 
#16 6.825 + '[' -d /app/themes/venia/dist ]
#16 6.825 + mkdir -p /app/themes-src/venia
#16 6.826 + rm -rf /app/themes-src/venia/dist
#16 6.826 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.0s

#5 [internal] load build context
#5 ...

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.079 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.084 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#5 [internal] load build context
#5 ...

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#5 [internal] load build context
#5 ...

#25 [21/21] RUN npm run build
#25 0.309 
#25 0.309 > evershop@1.2.2 build
#25 0.309 > evershop build
#25 0.309 
#25 3.943 â„¹ Compiling Client
#25 3.983 â„¹ Compiling Server
#25 43.80 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 43.80   npx update-browserslist-db@latest
#25 43.80   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 143.2 âœ” Server: Compiled successfully in 2.32m
#25 145.8 âœ” Client: Compiled successfully in 2.37m
#25 DONE 146.8s

#5 [internal] load build context
#5 ...

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.0s done
#26 exporting manifest sha256:30a387738d53db68b043608573882e7ac25d7014c377f7101738fde4ed9984e6 done
#26 exporting config sha256:4aadad3a905579432ca096cbb6b6844552258a4626e060b5c63eba0c94f21146 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K919MVYCXQ3JDRTSE50AC6JQ@sha256:30a387738d53db68b043608573882e7ac25d7014c377f7101738fde4ed9984e6
#26 pushing layer sha256:47a5e3616ee1993acffdf50e77c89100efed879a4dc20b3cb6e3f62fec1ec266
#26 pushing layer sha256:4aadad3a905579432ca096cbb6b6844552258a4626e060b5c63eba0c94f21146
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:5b4cd689cf488c7595695147ebf44229dc774946a8b18544681f8a93726721b8
#26 pushing layer sha256:cf92f3251c5b14797fffbc83acca650e4be2f4ed6c889e97ea806a5fea6e6260
#26 pushing layer sha256:2ba26d1c8bf3ef33f11e4babe1707609eeee7c0a0b07840f60ab8e6f714206ee
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:454eedfbe6e70bfbeb4057df6b2a9e0b4e4491672a513219c3db81815183a949
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f
#26 pushing layer sha256:1130e303943274c5c9c9e9a6aee1303792f6ffe273dd9c8cf67d1287f3607b17
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:7fa74366b24bccdf3522c91f4d2b903f0221dab31e241e47036c83b86d751f6c
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:1b0c0a11d8494ccc9b9a900ebfcd3bb2f630f0cb7b3a696105280c8e18ce6aa3
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:4e1a091f005468013819f766e8c8710dd84585e8934a32b6a5f2ebb18061bc84
#26 pushing layer sha256:1e437a0d3ce5fa9dae29b48d18e287ae40319ce5a7fbe130daaaf518fc1808ab
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:10e869550b6b9024d0d50430e74acd6ae2a46ffabada05d4b480a4078b7d0f18
#26 pushing layer sha256:bac6423985534f25af91aa57e0e549f836397e45631a7742bca3a274e9aca6ea
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.8s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.8s done
#26 pushing layer sha256:cf92f3251c5b14797fffbc83acca650e4be2f4ed6c889e97ea806a5fea6e6260 3.0s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 2.8s done
#26 pushing layer sha256:454eedfbe6e70bfbeb4057df6b2a9e0b4e4491672a513219c3db81815183a949 2.8s done
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f 2.9s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.8s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 2.8s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.8s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 2.8s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.8s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 2.8s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 2.8s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 2.8s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 2.8s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.8s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 2.9s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 2.9s done
#26 pushing layer sha256:47a5e3616ee1993acffdf50e77c89100efed879a4dc20b3cb6e3f62fec1ec266 3.0s done
#26 pushing layer sha256:4aadad3a905579432ca096cbb6b6844552258a4626e060b5c63eba0c94f21146 3.0s done
#26 pushing layer sha256:2ba26d1c8bf3ef33f11e4babe1707609eeee7c0a0b07840f60ab8e6f714206ee 3.0s done
#26 pushing layer sha256:1130e303943274c5c9c9e9a6aee1303792f6ffe273dd9c8cf67d1287f3607b17 3.0s done
#26 pushing layer sha256:7fa74366b24bccdf3522c91f4d2b903f0221dab31e241e47036c83b86d751f6c 3.0s done
#26 pushing layer sha256:1b0c0a11d8494ccc9b9a900ebfcd3bb2f630f0cb7b3a696105280c8e18ce6aa3 3.0s done
#26 pushing layer sha256:4e1a091f005468013819f766e8c8710dd84585e8934a32b6a5f2ebb18061bc84 3.1s done
#26 pushing layer sha256:1e437a0d3ce5fa9dae29b48d18e287ae40319ce5a7fbe130daaaf518fc1808ab 3.0s done
#26 pushing layer sha256:10e869550b6b9024d0d50430e74acd6ae2a46ffabada05d4b480a4078b7d0f18 3.0s done
#26 pushing layer sha256:bac6423985534f25af91aa57e0e549f836397e45631a7742bca3a274e9aca6ea 3.0s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K919MVYCXQ3JDRTSE50AC6JQ@sha256:30a387738d53db68b043608573882e7ac25d7014c377f7101738fde4ed9984e6 3.8s done
#26 pushing layer sha256:5b4cd689cf488c7595695147ebf44229dc774946a8b18544681f8a93726721b8 3.8s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K919MVYCXQ3JDRTSE50AC6JQ@sha256:30a387738d53db68b043608573882e7ac25d7014c377f7101738fde4ed9984e6
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K919MVYCXQ3JDRTSE50AC6JQ@sha256:30a387738d53db68b043608573882e7ac25d7014c377f7101738fde4ed9984e6 0.1s done
#26 DONE 12.0s

#5 [internal] load build context
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K919MVYCXQ3JDRTSE50AC6JQ
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 ...

#6 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#6 CACHED

#7 [ 6/21] COPY patches /tmp/patches
#7 CACHED

#8 [ 7/21] COPY scripts /app/scripts
#8 CACHED

#9 [ 2/21] WORKDIR /app
#9 CACHED

#10 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#10 CACHED

#11 [ 5/21] COPY config /app/config
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 CACHED

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 20.92kB 0.8s done
#5 ...

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 15.63 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 15.89 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 16.63 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 16.63 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 19.58 
#14 19.58 added 680 packages, and audited 681 packages in 19s
#14 19.58 
#14 19.58 192 packages are looking for funding
#14 19.58   run `npm fund` for details
#14 19.59 
#14 19.59 3 high severity vulnerabilities
#14 19.59 
#14 19.59 To address all issues (including breaking changes), run:
#14 19.59   npm audit fix --force
#14 19.59 
#14 19.59 Run `npm audit` for details.
#14 DONE 23.0s

#5 [internal] load build context
#5 ...

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#5 [internal] load build context
#5 ...

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.083 + '[' -d /app/themes/redtheme ]
#16 0.083 + basename /app/themes/redtheme
#16 0.084 + name=redtheme
#16 0.084 + '[' -f /app/themes/redtheme/package.json ]
#16 0.084 + npm install --prefix /app/themes/redtheme
#16 1.394 
#16 1.394 added 5 packages, and audited 6 packages in 1s
#16 1.395 
#16 1.395 found 0 vulnerabilities
#16 1.424 + npm run build --prefix /app/themes/redtheme
#16 1.601 
#16 1.601 > redtheme@0.1.0 build
#16 1.601 > tsc --project tsconfig.json
#16 1.601 
#16 3.530 + '[' -d /app/themes/redtheme/dist ]
#16 3.530 + mkdir -p /app/themes-src/redtheme
#16 3.531 + rm -rf /app/themes-src/redtheme/dist
#16 3.532 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.536 + '[' -d /app/themes/venia ]
#16 3.536 + basename /app/themes/venia
#16 3.536 + name=venia
#16 3.536 + '[' -f /app/themes/venia/package.json ]
#16 3.536 + npm install --prefix /app/themes/venia
#16 4.703 
#16 4.703 added 5 packages, and audited 6 packages in 1s
#16 4.704 
#16 4.704 found 0 vulnerabilities
#16 4.730 + npm run build --prefix /app/themes/venia
#16 4.904 
#16 4.904 > venia@0.1.0 build
#16 4.904 > tsc --project tsconfig.json
#16 4.904 
#16 6.895 + '[' -d /app/themes/venia/dist ]
#16 6.895 + mkdir -p /app/themes-src/venia
#16 6.896 + rm -rf /app/themes-src/venia/dist
#16 6.896 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.1s

#5 [internal] load build context
#5 ...

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.091 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.096 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#5 [internal] load build context
#5 ...

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#5 [internal] load build context
#5 ...

#25 [21/21] RUN npm run build
#25 0.298 
#25 0.298 > evershop@1.2.2 build
#25 0.298 > evershop build
#25 0.298 
#25 3.330 â„¹ Compiling Client
#25 3.365 â„¹ Compiling Server
#25 42.36 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.36   npx update-browserslist-db@latest
#25 42.36   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 142.9 âœ” Server: Compiled successfully in 2.32m
#25 145.6 âœ” Client: Compiled successfully in 2.37m
#25 DONE 146.5s

#5 [internal] load build context
#5 ...

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.4s done
#26 exporting manifest sha256:4d647390d7a3203231b02eb91ba8d7fc29a223d25364088523d4d12c90374f8f done
#26 exporting config sha256:416f633c6c51b01f3c7da6cc2daaba8b5e7ab1bbfa6b6ff27c48482ed6ebb5ac done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91A3N7DPN6WTG0A6ARGC67B@sha256:4d647390d7a3203231b02eb91ba8d7fc29a223d25364088523d4d12c90374f8f
#26 pushing layer sha256:927cc3a3c825ace739abeaccc206e8f52580c8d6872c2536769ffa9acc20fac0
#26 pushing layer sha256:416f633c6c51b01f3c7da6cc2daaba8b5e7ab1bbfa6b6ff27c48482ed6ebb5ac
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:980c9ffa08cda160d0c3cfc71e12be8c8bbce95f16f2193edc728dfec8c15e2c
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:e10b3bccaaa483427605f695d604f7c2c5e7979957661fbdb5e612bb8e27a823
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:58f639d5ed89db87fe91cac5f145102ec01d80520531dbb20b2823aec4bbd364
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:0ba6493ff26c4f7139a9e3affec5e305b1eeaf92b4fcf53656e5d3838a2ee344
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:068bdf0578e6e3f3934d2fae50a2d3eb8ff3eae1fcd14d5e3ddc42a4d926b5cd
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:0de8b9714f2f10b538a310846e504820d8b0e51316492618df968aa0c680c398
#26 pushing layer sha256:9a313a26924b1f8fb574677cb3c161533da5249038f3bcbd3002dac9b3902913
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:596dde5fac00c4276a233833a32979316ca4dc411ec3c63d80bb00d3a2eab191
#26 pushing layer sha256:65b1a51eb2b6d229668af4f3d56b5ed93251e7452974458205de82e6de165a83
#26 pushing layer sha256:5e86202510b20a5ed95189eb0d906c908012b3f6d7ad17d0c8f33a372b5a8ec8
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:3b17c37c59a2f0a91d4f51c4340bacdee731b574690e0a73ec44c1652b76cb75
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 0.4s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 0.9s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 1.2s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 2.7s done
#26 pushing layer sha256:927cc3a3c825ace739abeaccc206e8f52580c8d6872c2536769ffa9acc20fac0 2.7s done
#26 pushing layer sha256:416f633c6c51b01f3c7da6cc2daaba8b5e7ab1bbfa6b6ff27c48482ed6ebb5ac 2.7s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 2.7s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 2.7s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 2.7s done
#26 pushing layer sha256:068bdf0578e6e3f3934d2fae50a2d3eb8ff3eae1fcd14d5e3ddc42a4d926b5cd 2.7s done
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f 2.7s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 2.7s done
#26 pushing layer sha256:5e86202510b20a5ed95189eb0d906c908012b3f6d7ad17d0c8f33a372b5a8ec8 2.8s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.7s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.7s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 2.7s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 2.7s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.7s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.7s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.7s done
#26 pushing layer sha256:980c9ffa08cda160d0c3cfc71e12be8c8bbce95f16f2193edc728dfec8c15e2c 2.9s done
#26 pushing layer sha256:e10b3bccaaa483427605f695d604f7c2c5e7979957661fbdb5e612bb8e27a823 2.9s done
#26 pushing layer sha256:0ba6493ff26c4f7139a9e3affec5e305b1eeaf92b4fcf53656e5d3838a2ee344 2.9s done
#26 pushing layer sha256:9a313a26924b1f8fb574677cb3c161533da5249038f3bcbd3002dac9b3902913 2.8s done
#26 pushing layer sha256:596dde5fac00c4276a233833a32979316ca4dc411ec3c63d80bb00d3a2eab191 2.9s done
#26 pushing layer sha256:65b1a51eb2b6d229668af4f3d56b5ed93251e7452974458205de82e6de165a83 2.8s done
#26 pushing layer sha256:3b17c37c59a2f0a91d4f51c4340bacdee731b574690e0a73ec44c1652b76cb75 2.9s done
#26 pushing layer sha256:58f639d5ed89db87fe91cac5f145102ec01d80520531dbb20b2823aec4bbd364 3.1s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91A3N7DPN6WTG0A6ARGC67B@sha256:4d647390d7a3203231b02eb91ba8d7fc29a223d25364088523d4d12c90374f8f 3.8s done
#26 pushing layer sha256:0de8b9714f2f10b538a310846e504820d8b0e51316492618df968aa0c680c398 3.8s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91A3N7DPN6WTG0A6ARGC67B@sha256:4d647390d7a3203231b02eb91ba8d7fc29a223d25364088523d4d12c90374f8f
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91A3N7DPN6WTG0A6ARGC67B@sha256:4d647390d7a3203231b02eb91ba8d7fc29a223d25364088523d4d12c90374f8f 0.1s done
#26 DONE 12.4s

#5 [internal] load build context
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91A3N7DPN6WTG0A6ARGC67B
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.5s done
#1 DONE 0.5s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.4s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 20.72kB 0.7s done
#5 DONE 0.7s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 6/21] COPY patches /tmp/patches
#9 CACHED

#10 [ 7/21] COPY scripts /app/scripts
#10 CACHED

#11 [ 5/21] COPY config /app/config
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 CACHED

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.0s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 17.30 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#14 17.59 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#14 18.21 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#14 18.31 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#14 21.10 
#14 21.10 added 680 packages, and audited 681 packages in 21s
#14 21.10 
#14 21.10 192 packages are looking for funding
#14 21.10   run `npm fund` for details
#14 21.11 
#14 21.11 3 high severity vulnerabilities
#14 21.11 
#14 21.11 To address all issues (including breaking changes), run:
#14 21.11   npm audit fix --force
#14 21.11 
#14 21.11 Run `npm audit` for details.
#14 DONE 23.6s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.4s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.091 + '[' -d /app/themes/redtheme ]
#16 0.091 + basename /app/themes/redtheme
#16 0.092 + name=redtheme
#16 0.092 + '[' -f /app/themes/redtheme/package.json ]
#16 0.092 + npm install --prefix /app/themes/redtheme
#16 1.425 
#16 1.425 added 5 packages, and audited 6 packages in 1s
#16 1.426 
#16 1.426 found 0 vulnerabilities
#16 1.453 + npm run build --prefix /app/themes/redtheme
#16 1.624 
#16 1.624 > redtheme@0.1.0 build
#16 1.624 > tsc --project tsconfig.json
#16 1.624 
#16 3.593 + '[' -d /app/themes/redtheme/dist ]
#16 3.593 + mkdir -p /app/themes-src/redtheme
#16 3.594 + rm -rf /app/themes-src/redtheme/dist
#16 3.595 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 3.598 + '[' -d /app/themes/venia ]
#16 3.599 + basename /app/themes/venia
#16 3.599 + name=venia
#16 3.599 + '[' -f /app/themes/venia/package.json ]
#16 3.599 + npm install --prefix /app/themes/venia
#16 4.741 
#16 4.741 added 5 packages, and audited 6 packages in 1s
#16 4.742 
#16 4.742 found 0 vulnerabilities
#16 4.768 + npm run build --prefix /app/themes/venia
#16 4.935 
#16 4.935 > venia@0.1.0 build
#16 4.935 > tsc --project tsconfig.json
#16 4.935 
#16 6.868 + '[' -d /app/themes/venia/dist ]
#16 6.868 + mkdir -p /app/themes-src/venia
#16 6.869 + rm -rf /app/themes-src/venia/dist
#16 6.870 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.0s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.087 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.091 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.291 
#25 0.291 > evershop@1.2.2 build
#25 0.291 > evershop build
#25 0.291 
#25 3.920 â„¹ Compiling Client
#25 3.958 â„¹ Compiling Server
#25 43.18 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 43.18   npx update-browserslist-db@latest
#25 43.18   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 144.8 âœ” Server: Compiled successfully in 2.35m
#25 147.6 âœ” Client: Compiled successfully in 2.39m
#25 DONE 148.4s

#26 exporting to image
#26 exporting layers
#26 exporting layers 8.5s done
#26 exporting manifest sha256:eb3200468fe0953019d3f698653eb553c8c335e5ee2b33b86d71920ab1a618d8 done
#26 exporting config sha256:bdfa2820421db7f6c4f9bcf10fe6d0ca917ff34d7213d6f7c54b3dfe401f7fc1 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91B0ED2ZWGRH23CJ0Z9HAA4@sha256:eb3200468fe0953019d3f698653eb553c8c335e5ee2b33b86d71920ab1a618d8
#26 pushing layer sha256:bdfa2820421db7f6c4f9bcf10fe6d0ca917ff34d7213d6f7c54b3dfe401f7fc1
#26 pushing layer sha256:efa4d608caa002f7fbc9a11ed2d92f951b4930483c999f9e29683df05c50f8a6
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:642b24cb6c19c6e8a5c9203a2b6cda43ffa610524e62ca304738c1b62fcd7b16
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:a64087e7d61ff9fde21e308e29860ca2cfec372cac61421bfb5ecb1c6fcb4954
#26 pushing layer sha256:ccf049f8236311651141802e108c2a480563437c64ad3245872cdd5648764638
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:0243120dd91d127945fa9ebe9b049cf67decca2edae1d92c9787d0fb63e0e689
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:d9c6dad2f538e175546a52746fbacfa1a5f5126d39296b6e313fb106eaaeefb2
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:c477fb112e40d77ccf25ecb738fa8a8a8c1bc8063e1f219b114015e44243ffb8
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f
#26 pushing layer sha256:06ba2e58ef720c178bcc1f1d6a31c7ba0cfae8829dbb5307a2ebc9949d206a18
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:dd8d0e17e9a780be2546b01cf8ed7e241bbf34cb39000e3fe8acc39f00288199
#26 pushing layer sha256:c761ca1cec74ebb839010a4b4de7be6229e905c5fb8c95ac7a6aec251b9a8eb9
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:f443ec9637ff9c099d8bb465a3bb6cb535b9033db9f53127095d3ba40622cd06
#26 pushing layer sha256:d0b023af9146fcce7f7c6f8fad8b8cff3fff0fb5e5ffb84866baf2d80c387132
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 0.2s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 0.6s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 0.8s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 0.9s done
#26 pushing layer sha256:d4b97f7205aeca8d48131b37fb70ef9172f363cfec62560fb482fd486258861f 1.3s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 2.6s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 2.6s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 2.6s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.6s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 2.6s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 2.6s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 2.6s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 2.6s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 2.6s done
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.6s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 2.6s done
#26 pushing layer sha256:d9c6dad2f538e175546a52746fbacfa1a5f5126d39296b6e313fb106eaaeefb2 2.8s done
#26 pushing layer sha256:bdfa2820421db7f6c4f9bcf10fe6d0ca917ff34d7213d6f7c54b3dfe401f7fc1 2.8s done
#26 pushing layer sha256:efa4d608caa002f7fbc9a11ed2d92f951b4930483c999f9e29683df05c50f8a6 2.9s done
#26 pushing layer sha256:642b24cb6c19c6e8a5c9203a2b6cda43ffa610524e62ca304738c1b62fcd7b16 2.8s done
#26 pushing layer sha256:a64087e7d61ff9fde21e308e29860ca2cfec372cac61421bfb5ecb1c6fcb4954 2.8s done
#26 pushing layer sha256:0243120dd91d127945fa9ebe9b049cf67decca2edae1d92c9787d0fb63e0e689 2.9s done
#26 pushing layer sha256:c477fb112e40d77ccf25ecb738fa8a8a8c1bc8063e1f219b114015e44243ffb8 2.8s done
#26 pushing layer sha256:06ba2e58ef720c178bcc1f1d6a31c7ba0cfae8829dbb5307a2ebc9949d206a18 2.8s done
#26 pushing layer sha256:dd8d0e17e9a780be2546b01cf8ed7e241bbf34cb39000e3fe8acc39f00288199 2.8s done
#26 pushing layer sha256:f443ec9637ff9c099d8bb465a3bb6cb535b9033db9f53127095d3ba40622cd06 2.8s done
#26 pushing layer sha256:d0b023af9146fcce7f7c6f8fad8b8cff3fff0fb5e5ffb84866baf2d80c387132 2.8s done
#26 pushing layer sha256:ccf049f8236311651141802e108c2a480563437c64ad3245872cdd5648764638 3.0s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91B0ED2ZWGRH23CJ0Z9HAA4@sha256:eb3200468fe0953019d3f698653eb553c8c335e5ee2b33b86d71920ab1a618d8 3.8s done
#26 pushing layer sha256:c761ca1cec74ebb839010a4b4de7be6229e905c5fb8c95ac7a6aec251b9a8eb9 3.8s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91B0ED2ZWGRH23CJ0Z9HAA4@sha256:eb3200468fe0953019d3f698653eb553c8c335e5ee2b33b86d71920ab1a618d8
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91B0ED2ZWGRH23CJ0Z9HAA4@sha256:eb3200468fe0953019d3f698653eb553c8c335e5ee2b33b86d71920ab1a618d8 0.1s done
#26 DONE 12.6s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91B0ED2ZWGRH23CJ0Z9HAA4
image size: 266 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state
> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/evershop/evershop:1.2.2
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [ 1/21] FROM docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4
#4 resolve docker.io/evershop/evershop:1.2.2@sha256:63b98c7f7ddd6aa100a630571c2275081622cbf03bfc27627961f1189de2c4b4 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 9.27MB 5.1s
#5 transferring context: 91.88MB 10.2s
#5 transferring context: 156.55MB 15.1s done
#5 DONE 15.2s

#6 [ 2/21] WORKDIR /app
#6 CACHED

#7 [ 3/21] RUN apk add --no-cache ca-certificates && update-ca-certificates
#7 CACHED

#8 [ 4/21] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [ 5/21] COPY config /app/config
#9 CACHED

#10 [ 6/21] COPY patches /tmp/patches
#10 CACHED

#11 [ 7/21] COPY scripts /app/scripts
#11 CACHED

#12 [ 8/21] COPY extensions /app/extensions
#12 DONE 6.4s

#13 [ 9/21] COPY themes /app/themes-src
#13 DONE 0.2s

#14 [10/21] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#14 2.830 
#14 2.830 removed 4 packages, and audited 681 packages in 2s
#14 2.830 
#14 2.830 192 packages are looking for funding
#14 2.830   run `npm fund` for details
#14 2.847 
#14 2.847 3 high severity vulnerabilities
#14 2.847 
#14 2.847 To address all issues (including breaking changes), run:
#14 2.847   npm audit fix --force
#14 2.847 
#14 2.847 Run `npm audit` for details.
#14 DONE 2.9s

#15 [11/21] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#15 DONE 0.1s

#16 [12/21] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#16 0.083 + '[' -d /app/themes/redtheme ]
#16 0.083 + basename /app/themes/redtheme
#16 0.084 + name=redtheme
#16 0.084 + '[' -f /app/themes/redtheme/package.json ]
#16 0.084 + npm install --prefix /app/themes/redtheme
#16 1.795 
#16 1.795 added 5 packages, and audited 6 packages in 2s
#16 1.797 
#16 1.797 found 0 vulnerabilities
#16 1.816 + npm run build --prefix /app/themes/redtheme
#16 1.998 
#16 1.998 > redtheme@0.1.0 build
#16 1.998 > tsc --project tsconfig.json
#16 1.998 
#16 4.107 + '[' -d /app/themes/redtheme/dist ]
#16 4.107 + mkdir -p /app/themes-src/redtheme
#16 4.108 + rm -rf /app/themes-src/redtheme/dist
#16 4.109 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#16 4.113 + '[' -d /app/themes/venia ]
#16 4.113 + basename /app/themes/venia
#16 4.113 + name=venia
#16 4.113 + '[' -f /app/themes/venia/package.json ]
#16 4.113 + npm install --prefix /app/themes/venia
#16 5.289 
#16 5.289 added 5 packages, and audited 6 packages in 1s
#16 5.290 
#16 5.290 found 0 vulnerabilities
#16 5.314 + npm run build --prefix /app/themes/venia
#16 5.502 
#16 5.502 > venia@0.1.0 build
#16 5.502 > tsc --project tsconfig.json
#16 5.502 
#16 7.459 + '[' -d /app/themes/venia/dist ]
#16 7.459 + mkdir -p /app/themes-src/venia
#16 7.460 + rm -rf /app/themes-src/venia/dist
#16 7.461 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#16 DONE 7.7s

#17 [13/21] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#17 DONE 0.0s

#18 [14/21] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#18 DONE 0.0s

#19 [15/21] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 DONE 0.0s

#20 [16/21] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#20 0.090 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#20 0.094 + sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#20 DONE 0.1s

#21 [17/21] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#21 DONE 0.0s

#22 [18/21] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#22 DONE 0.1s

#23 [19/21] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#23 DONE 0.1s

#24 [20/21] RUN chmod +x /app/scripts/entrypoint.sh
#24 DONE 0.1s

#25 [21/21] RUN npm run build
#25 0.283 
#25 0.283 > evershop@1.2.2 build
#25 0.283 > evershop build
#25 0.283 
#25 3.795 â„¹ Compiling Client
#25 3.834 â„¹ Compiling Server
#25 42.45 Browserslist: browsers data (caniuse-lite) is 11 months old. Please run:
#25 42.45   npx update-browserslist-db@latest
#25 42.45   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#25 143.1 âœ” Server: Compiled successfully in 2.32m
#25 146.1 âœ” Client: Compiled successfully in 2.37m
#25 DONE 146.9s

#26 exporting to image
#26 exporting layers
#26 exporting layers 4.1s done
#26 exporting manifest sha256:88056ce77eb332fc0ff240dfddbd9c512927ebff191fa4e09c815bdaf0fd9092 done
#26 exporting config sha256:351c9f9a54127b328c17650a1a217937dc65dbe3395efb4d53aa255757fba6e6 done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91C89ATKSP3BWPAQ414GPY8@sha256:88056ce77eb332fc0ff240dfddbd9c512927ebff191fa4e09c815bdaf0fd9092
#26 pushing layer sha256:351c9f9a54127b328c17650a1a217937dc65dbe3395efb4d53aa255757fba6e6
#26 pushing layer sha256:702bb90c33efba09cb813221bf377eacd8c5e1f143fb1ccf825012aafaf93ea6
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae
#26 pushing layer sha256:eed663c2ab03d896e8cced2f1cc659bf6d00c53ce7c87fb70ab0c184446866ea
#26 pushing layer sha256:f5e78b8029787d2cd35722d37068e7ffd826ced6e4f337bf7b108ca117e26d20
#26 pushing layer sha256:22ee52e64d6fa51bb1a2d3024529e1da4d526d891d2dec0188fff7bdc871ce74
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005
#26 pushing layer sha256:311df6b90348916565e5b406499134f4cc465afd510eb837c914d8ed6db27a18
#26 pushing layer sha256:1368a42b1fca6e5a3579255b4a7c7e66d8a0c404a1da2c7fc4b0d0daf41b7b8c
#26 pushing layer sha256:da39d81de2f4652fcc0fb948cb16c9dec1890ba8a3c016e59ec168cd556fd411
#26 pushing layer sha256:91bc775b705d60a41fa63adbe76042c8bc20140c5d69a875d155e80aed2a1582
#26 pushing layer sha256:666ae27644b5046e9d757a157c3491b793895c9daa26d94edf46b0640edf3170
#26 pushing layer sha256:2433c972a3034d7c4b1521fae660e832cb02512b59622ee28d148db5ef1b7e5c
#26 pushing layer sha256:9f28e9eb097345b2c646cb6a75351508edf5993175ed1c51109c365a224435f2
#26 pushing layer sha256:da5652815f849f2f12f8b462957bd16ebd73595b3d695c1d580b60fe1db864a0
#26 pushing layer sha256:957cb33a575a888eab94ea4f33cc44ecfa9cdc18a25ec2f1b8fc492ae3866757
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847
#26 pushing layer sha256:15a252daee2e9230393119df18d45fcebbd1e2e9954400d4317f694fe1583005 2.8s done
#26 pushing layer sha256:4bfd01919ea9afb3921624310a9fa52e876769c86b7ab45f785fb49c7ec8f6ae 2.8s done
#26 pushing layer sha256:666ae27644b5046e9d757a157c3491b793895c9daa26d94edf46b0640edf3170 3.0s done
#26 pushing layer sha256:351c9f9a54127b328c17650a1a217937dc65dbe3395efb4d53aa255757fba6e6 3.0s done
#26 pushing layer sha256:eed663c2ab03d896e8cced2f1cc659bf6d00c53ce7c87fb70ab0c184446866ea 3.0s done
#26 pushing layer sha256:f5e78b8029787d2cd35722d37068e7ffd826ced6e4f337bf7b108ca117e26d20 3.0s done
#26 pushing layer sha256:22ee52e64d6fa51bb1a2d3024529e1da4d526d891d2dec0188fff7bdc871ce74 3.0s done
#26 pushing layer sha256:1368a42b1fca6e5a3579255b4a7c7e66d8a0c404a1da2c7fc4b0d0daf41b7b8c 3.0s done
#26 pushing layer sha256:91bc775b705d60a41fa63adbe76042c8bc20140c5d69a875d155e80aed2a1582 3.1s done
#26 pushing layer sha256:2433c972a3034d7c4b1521fae660e832cb02512b59622ee28d148db5ef1b7e5c 3.0s done
#26 pushing layer sha256:da5652815f849f2f12f8b462957bd16ebd73595b3d695c1d580b60fe1db864a0 3.0s done
#26 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.0s done
#26 pushing layer sha256:9da3565a3a57979c0e8e64e745a163626030dc5c0bb06b23bb56833b84ef7243 3.0s done
#26 pushing layer sha256:0dc0c995e4ad2c57403be9783ebaf1ea83081aeb915f4b62f6922b37cc7cc6cc 3.0s done
#26 pushing layer sha256:702d01eedf74d397501ab4494133a503092d81d9b32ca71f6e6109842c7b2854 3.0s done
#26 pushing layer sha256:18c320ee474e87dd45292cd5291b0bbba35c574297443d115d8e438c439bd6d3 3.0s done
#26 pushing layer sha256:40482da5b5de24a36c4953a6e5d490b3a0ce6bd7fbc99d66ae9ea6a41e6109b2 3.0s done
#26 pushing layer sha256:fa2fd11fc86774016cb1add2d0a873299cbdb6e8950a4f74ab2fc702bc298249 3.0s done
#26 pushing layer sha256:afccae104cd109b2075a01511eb1fa6d1e164772e296ac6bf6173ab46583f5ff 3.0s done
#26 pushing layer sha256:b35b131cc9d4b66b072d0d3759de2498c2b0db7a7c9b296964d8fa6bea51420c 3.0s done
#26 pushing layer sha256:577fd73ab19eb8aa35b5989fd459bfdca258523dccc3efabd57b24913481850b 3.0s done
#26 pushing layer sha256:cb8287d72496aeeb0a87e702d2b3259d9f72c4b6f5d2e524f9c0219bc37e8827 3.0s done
#26 pushing layer sha256:6ae136e6b286758cc1c3737cd24339b600dbb8dc4d8245c9755ff931bab64d34 3.0s done
#26 pushing layer sha256:3cb5ca7f188c70b40d8ab495b0da7ec6f26f8c1a1ae4550c9ce7a3928e6a2847 3.0s done
#26 pushing layer sha256:702bb90c33efba09cb813221bf377eacd8c5e1f143fb1ccf825012aafaf93ea6 3.1s done
#26 pushing layer sha256:311df6b90348916565e5b406499134f4cc465afd510eb837c914d8ed6db27a18 3.1s done
#26 pushing layer sha256:da39d81de2f4652fcc0fb948cb16c9dec1890ba8a3c016e59ec168cd556fd411 3.1s done
#26 pushing layer sha256:9f28e9eb097345b2c646cb6a75351508edf5993175ed1c51109c365a224435f2 3.3s done
#26 pushing layers for registry.fly.io/evershop-fly:deployment-01K91C89ATKSP3BWPAQ414GPY8@sha256:88056ce77eb332fc0ff240dfddbd9c512927ebff191fa4e09c815bdaf0fd9092 3.4s done
#26 pushing layer sha256:957cb33a575a888eab94ea4f33cc44ecfa9cdc18a25ec2f1b8fc492ae3866757 3.4s done
#26 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91C89ATKSP3BWPAQ414GPY8@sha256:88056ce77eb332fc0ff240dfddbd9c512927ebff191fa4e09c815bdaf0fd9092 0.1s done
#26 DONE 7.7s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91C89ATKSP3BWPAQ414GPY8
image size: 217 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state

WARNING The app is not listening on the expected address and will not be reachable by fly-proxy.
You can fix this by configuring your app to listen on the following addresses:
  - 0.0.0.0:3000
Found these processes inside the machine with open listening sockets:
  PROCESS        | ADDRESSES                              
-----------------*----------------------------------------
  /.fly/hallpass | [fdaa:29:c944:a7b:480:f235:93e5:2]:22  

> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.9s done
#1 DONE 0.9s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.8s done
#1 DONE 0.8s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
Error: failed to fetch an image or build from source: error building: failed to solve: evershop/evershop:2.0.0: failed to resolve source metadata for docker.io/evershop/evershop:2.0.0: docker.io/evershop/evershop:2.0.0: not found
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.41kB 0.9s done
#1 DONE 0.9s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
Warning: Metrics token unavailable: failed to run query($slug: String!) { organization(slug: $slug) { id internalNumericId slug rawSlug name type billable limitedAccessTokens { nodes { id name expiresAt revokedAt user { email } } } } }: context canceled
Error: failed to fetch an image or build from source: error building: failed to solve: evershop/evershop:2.0.0: failed to resolve source metadata for docker.io/evershop/evershop:2.0.0: docker.io/evershop/evershop:2.0.0: not found
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 7.11kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 7.11kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/evershop/evershop:2.0.0
#2 ERROR: docker.io/evershop/evershop:2.0.0: not found
------
 > [internal] load metadata for docker.io/evershop/evershop:2.0.0:
------
Error: failed to fetch an image or build from source: error building: failed to solve: evershop/evershop:2.0.0: failed to resolve source metadata for docker.io/evershop/evershop:2.0.0: docker.io/evershop/evershop:2.0.0: not found
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.78kB 0.6s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 1.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [internal] load build context
#4 DONE 0.0s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#5 DONE 0.1s

#4 [internal] load build context
#4 transferring context: 2.82MB 5.1s
#4 ...

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 sha256:322c09dcd099afec7804c6ba6badb3b7f6371f487c27819c081085af1e4f8ae3 448B / 448B 0.1s done
#5 sha256:186e6c266a62c926f27c443fbb3bfcb801e1aad7993d2291f1595d08369631f9 1.25MB / 1.25MB 0.2s done
#5 sha256:4ce2133b014300dd0b16f06a938dc73a5020219fd1d1523b61980365c8335038 4.08kB / 4.08kB 0.2s done
#5 sha256:fe0a6aa2738dae1ff8da803f602bab5838afa7bff5923d44435e1df54247dac6 48.41MB / 48.41MB 1.7s done
#5 sha256:6bafbf91825be17f2ceae6674de95a31e6f8a5a24c7cb95ae123d19de9c63e61 197.20MB / 197.20MB 4.5s done
#5 sha256:3e663cb3204c49ebc21b005f5976ee62e4f00b632aaa8000dbe6db86d9cde2a1 54.76MB / 54.76MB 2.0s done
#5 sha256:9cfa9ab09db8d94503213f634b29be3505174979f2e0c6e3fd46c2acc0716c25 15.76MB / 15.76MB 1.4s done
#5 sha256:b6f830cd306f01980373f1e0120f2d00018fbe51a9506b7262f5d9e4bbda74f9 53.76MB / 53.76MB 1.8s done
#5 extracting sha256:b6f830cd306f01980373f1e0120f2d00018fbe51a9506b7262f5d9e4bbda74f9 2.6s done
#5 DONE 4.8s

#4 [internal] load build context
#4 ...

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:9cfa9ab09db8d94503213f634b29be3505174979f2e0c6e3fd46c2acc0716c25 0.3s done
#5 DONE 5.1s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:3e663cb3204c49ebc21b005f5976ee62e4f00b632aaa8000dbe6db86d9cde2a1
#5 ...

#4 [internal] load build context
#4 transferring context: 4.31MB 7.3s done
#4 DONE 7.5s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:3e663cb3204c49ebc21b005f5976ee62e4f00b632aaa8000dbe6db86d9cde2a1 1.7s done
#5 DONE 6.8s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:6bafbf91825be17f2ceae6674de95a31e6f8a5a24c7cb95ae123d19de9c63e61
#5 extracting sha256:6bafbf91825be17f2ceae6674de95a31e6f8a5a24c7cb95ae123d19de9c63e61 4.2s done
#5 DONE 10.9s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:4ce2133b014300dd0b16f06a938dc73a5020219fd1d1523b61980365c8335038 0.0s done
#5 extracting sha256:fe0a6aa2738dae1ff8da803f602bab5838afa7bff5923d44435e1df54247dac6
#5 extracting sha256:fe0a6aa2738dae1ff8da803f602bab5838afa7bff5923d44435e1df54247dac6 2.0s done
#5 DONE 13.0s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 extracting sha256:186e6c266a62c926f27c443fbb3bfcb801e1aad7993d2291f1595d08369631f9 0.0s done
#5 extracting sha256:322c09dcd099afec7804c6ba6badb3b7f6371f487c27819c081085af1e4f8ae3 done
#5 DONE 13.0s

#6 [stage-1  2/22] WORKDIR /app
#6 ...

#7 [evershop-source 2/5] WORKDIR /opt/evershop
#7 DONE 9.3s

#6 [stage-1  2/22] WORKDIR /app
#6 DONE 9.3s

#8 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#8 0.237 Get:1 http://deb.debian.org/debian bullseye InRelease [75.1 kB]
#8 0.248 Get:2 http://deb.debian.org/debian-security bullseye-security InRelease [27.2 kB]
#8 0.248 Get:3 http://deb.debian.org/debian bullseye-updates InRelease [44.0 kB]
#8 0.382 Get:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8066 kB]
#8 0.519 Get:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [420 kB]
#8 0.652 Get:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [18.8 kB]
#8 1.565 Fetched 8652 kB in 1s (6012 kB/s)
#8 1.565 Reading package lists...
#8 2.171 Reading package lists...
#8 2.783 Building dependency tree...
#8 2.967 Reading state information...
#8 3.210 ca-certificates is already the newest version (20210119).
#8 3.210 g++ is already the newest version (4:10.2.1-1).
#8 3.210 make is already the newest version (4.3-4.1).
#8 3.210 python3 is already the newest version (3.9.2-3).
#8 3.210 python3 set to manually installed.
#8 3.210 git is already the newest version (1:2.30.2-1+deb11u5).
#8 3.210 0 upgraded, 0 newly installed, 0 to remove and 5 not upgraded.
#8 ...

#9 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#9 0.250 Get:1 http://deb.debian.org/debian bullseye InRelease [75.1 kB]
#9 0.262 Get:2 http://deb.debian.org/debian-security bullseye-security InRelease [27.2 kB]
#9 0.262 Get:3 http://deb.debian.org/debian bullseye-updates InRelease [44.0 kB]
#9 0.395 Get:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8066 kB]
#9 0.523 Get:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [420 kB]
#9 0.653 Get:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [18.8 kB]
#9 1.576 Fetched 8652 kB in 1s (6038 kB/s)
#9 1.576 Reading package lists...
#9 2.215 Reading package lists...
#9 2.847 Building dependency tree...
#9 3.023 Reading state information...
#9 3.255 git is already the newest version (1:2.30.2-1+deb11u5).
#9 3.255 0 upgraded, 0 newly installed, 0 to remove and 5 not upgraded.
#9 DONE 3.3s

#8 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#8 3.215 Updating certificates in /etc/ssl/certs...
#8 3.889 0 added, 0 removed; done.
#8 3.889 Running hooks in /etc/ca-certificates/update.d...
#8 3.890 done.
#8 DONE 3.9s

#10 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#10 0.087 Cloning into '.'...
#10 1.097 Note: switching to 'aaa518a5db1ccdd9e0983150bf25e1f26811589b'.
#10 1.097 
#10 1.097 You are in 'detached HEAD' state. You can look around, make experimental
#10 1.097 changes and commit them, and you can discard any commits you make in this
#10 1.097 state without impacting any branches by switching back to a branch.
#10 1.097 
#10 1.097 If you want to create a new branch to retain commits you create, you may
#10 1.097 do so (now or later) by using -c with the switch command. Example:
#10 1.097 
#10 1.097   git switch -c <new-branch-name>
#10 1.097 
#10 1.097 Or undo this operation with:
#10 1.097 
#10 1.097   git switch -
#10 1.097 
#10 1.097 Turn off this advice by setting config variable advice.detachedHead to false
#10 1.097 
#10 DONE 1.4s

#11 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#11 6.815 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#11 7.061 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#11 31.64 
#11 31.64 > evershop@1.2.2 prepare
#11 31.64 > husky install
#11 31.64 
#11 31.69 husky - Git hooks installed
#11 31.71 
#11 31.71 added 1466 packages, and audited 1485 packages in 31s
#11 31.71 
#11 31.71 293 packages are looking for funding
#11 31.71   run `npm fund` for details
#11 31.72 
#11 31.72 9 vulnerabilities (6 low, 2 high, 1 critical)
#11 31.72 
#11 31.72 To address all issues, run:
#11 31.72   npm audit fix
#11 31.72 
#11 31.72 Run `npm audit` for details.
#11 31.72 npm notice
#11 31.72 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#11 31.72 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#11 31.72 npm notice To update run: npm install -g npm@11.6.2
#11 31.72 npm notice
#11 DONE 36.9s

#12 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#12 DONE 15.7s

#13 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#13 9.396 npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
#13 13.21 
#13 13.21 added 211 packages, changed 1 package, and audited 1167 packages in 12s
#13 13.21 
#13 13.21 276 packages are looking for funding
#13 13.21   run `npm fund` for details
#13 13.22 
#13 13.22 9 vulnerabilities (3 low, 5 high, 1 critical)
#13 13.22 
#13 13.22 To address issues that do not require attention, run:
#13 13.22   npm audit fix
#13 13.22 
#13 13.22 To address all issues (including breaking changes), run:
#13 13.22   npm audit fix --force
#13 13.22 
#13 13.22 Run `npm audit` for details.
#13 13.22 npm notice
#13 13.22 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#13 13.22 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#13 13.22 npm notice To update run: npm install -g npm@11.6.2
#13 13.22 npm notice
#13 DONE 14.2s

#14 [stage-1  6/22] COPY config /app/config
#14 DONE 0.1s

#15 [stage-1  7/22] COPY patches /tmp/patches
#15 DONE 0.0s

#16 [stage-1  8/22] COPY scripts /app/scripts
#16 DONE 0.0s

#17 [stage-1  9/22] COPY extensions /app/extensions
#17 DONE 6.9s

#18 [stage-1 10/22] COPY themes /app/themes-src
#18 DONE 0.2s

#19 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#19 1.382 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#19 22.39 
#19 22.39 > evershop@1.2.2 prepare
#19 22.39 > husky install
#19 22.39 
#19 22.39 sh: 1: husky: not found
#19 22.40 npm error code 127
#19 22.40 npm error path /app
#19 22.40 npm error command failed
#19 22.40 npm error command sh -c husky install
#19 22.40 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-02T06_22_19_872Z-debug-0.log
#19 ERROR: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi" did not complete successfully: exit code: 127
------
 > [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi:
22.39 
22.39 > evershop@1.2.2 prepare
22.39 > husky install
22.39 
22.39 sh: 1: husky: not found
22.40 npm error code 127
22.40 npm error path /app
22.40 npm error command failed
22.40 npm error command sh -c husky install
22.40 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-02T06_22_19_872Z-debug-0.log
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.78kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 DONE 0.0s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.6s done
#3 DONE 0.6s

#4 [internal] load build context
#4 ...

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#5 DONE 0.0s

#4 [internal] load build context
#4 ...

#6 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#7 CACHED

#8 [stage-1  7/22] COPY patches /tmp/patches
#8 CACHED

#9 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#9 CACHED

#10 [stage-1  8/22] COPY scripts /app/scripts
#10 CACHED

#11 [stage-1  9/22] COPY extensions /app/extensions
#11 CACHED

#12 [evershop-source 2/5] WORKDIR /opt/evershop
#12 CACHED

#13 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#13 CACHED

#14 [stage-1  6/22] COPY config /app/config
#14 CACHED

#15 [stage-1  2/22] WORKDIR /app
#15 CACHED

#16 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#16 CACHED

#17 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#17 CACHED

#18 [stage-1 10/22] COPY themes /app/themes-src
#18 CACHED

#4 [internal] load build context
#4 transferring context: 2.28MB 3.3s done
#4 ...

#19 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi
#19 1.476 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#19 21.47 
#19 21.47 > evershop@1.2.2 prepare
#19 21.47 > husky install
#19 21.47 
#19 21.48 sh: 1: husky: not found
#19 21.48 npm error code 127
#19 21.48 npm error path /app
#19 21.48 npm error command failed
#19 21.48 npm error command sh -c husky install
#19 21.48 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-02T06_22_53_090Z-debug-0.log
#19 ERROR: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi" did not complete successfully: exit code: 127

#4 [internal] load build context
------
 > [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi:
21.47 
21.47 > evershop@1.2.2 prepare
21.47 > husky install
21.47 
21.48 sh: 1: husky: not found
21.48 npm error code 127
21.48 npm error path /app
21.48 npm error command failed
21.48 npm error command sh -c husky install
21.48 npm error A complete log of this run can be found in: /root/.npm/_logs/2025-11-02T06_22_53_090Z-debug-0.log
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm install --legacy-peer-deps; fi" did not complete successfully: exit code: 127
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.80kB 1.4s done
#1 DONE 1.5s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 1.4s done
#3 DONE 1.4s

#4 [stage-1  1/22] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.16MB 5.0s
#5 transferring context: 2.28MB 7.9s done
#5 DONE 7.9s

#6 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#6 CACHED

#7 [stage-1  7/22] COPY patches /tmp/patches
#7 CACHED

#8 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [stage-1  2/22] WORKDIR /app
#9 CACHED

#10 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#10 CACHED

#11 [evershop-source 2/5] WORKDIR /opt/evershop
#11 CACHED

#12 [stage-1  6/22] COPY config /app/config
#12 CACHED

#13 [stage-1  8/22] COPY scripts /app/scripts
#13 CACHED

#14 [stage-1  9/22] COPY extensions /app/extensions
#14 CACHED

#15 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#15 CACHED

#16 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#16 CACHED

#17 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#17 CACHED

#18 [stage-1 10/22] COPY themes /app/themes-src
#18 CACHED

#19 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#19 1.334 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#19 20.51 
#19 20.51 added 1 package, removed 712 packages, changed 2 packages, and audited 1161 packages in 20s
#19 20.51 
#19 20.51 276 packages are looking for funding
#19 20.51   run `npm fund` for details
#19 20.53 
#19 20.53 6 vulnerabilities (1 low, 4 high, 1 critical)
#19 20.53 
#19 20.53 To address issues that do not require attention, run:
#19 20.53   npm audit fix
#19 20.53 
#19 20.53 To address all issues (including breaking changes), run:
#19 20.53   npm audit fix --force
#19 20.53 
#19 20.53 Run `npm audit` for details.
#19 DONE 20.7s

#20 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#20 DONE 0.1s

#21 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#21 0.068 + [ -d /app/themes/redtheme ]
#21 0.068 + basename /app/themes/redtheme
#21 0.070 + name=redtheme
#21 0.070 + [ -f /app/themes/redtheme/package.json ]
#21 0.070 + npm install --prefix /app/themes/redtheme
#21 1.127 
#21 1.127 added 4 packages, and audited 5 packages in 983ms
#21 1.128 
#21 1.128 found 0 vulnerabilities
#21 1.149 + npm run build --prefix /app/themes/redtheme
#21 1.278 
#21 1.278 > redtheme@0.1.0 build
#21 1.278 > tsc --project tsconfig.json
#21 1.278 
#21 1.284 sh: 1: tsc: not found
#21 ERROR: process "/bin/sh -c set -eux;   for theme in /app/themes/*; do     [ -d \"${theme}\" ] || continue;     name=\"$(basename \"${theme}\")\";     if [ -f \"${theme}/package.json\" ]; then       npm install --prefix \"${theme}\";       npm run build --prefix \"${theme}\";       if [ -d \"${theme}/dist\" ]; then         mkdir -p \"/app/themes-src/${name}\";         rm -rf \"/app/themes-src/${name}/dist\";         cp -R \"${theme}/dist\" \"/app/themes-src/${name}/dist\";       fi;     fi;   done" did not complete successfully: exit code: 127
------
 > [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done:
1.127 
1.127 added 4 packages, and audited 5 packages in 983ms
1.128 
1.128 found 0 vulnerabilities
1.149 + npm run build --prefix /app/themes/redtheme
1.278 
1.278 > redtheme@0.1.0 build
1.278 > tsc --project tsconfig.json
1.278 
1.284 sh: 1: tsc: not found
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.80kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 3.7s done
#5 DONE 3.8s

#6 [stage-1  8/22] COPY scripts /app/scripts
#6 CACHED

#7 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#7 CACHED

#8 [evershop-source 2/5] WORKDIR /opt/evershop
#8 CACHED

#9 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#9 CACHED

#10 [stage-1  6/22] COPY config /app/config
#10 CACHED

#11 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#11 CACHED

#12 [stage-1  7/22] COPY patches /tmp/patches
#12 CACHED

#13 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#13 CACHED

#14 [stage-1 10/22] COPY themes /app/themes-src
#14 CACHED

#15 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#15 CACHED

#16 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#16 CACHED

#17 [stage-1  9/22] COPY extensions /app/extensions
#17 CACHED

#18 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#18 CACHED

#19 [stage-1  2/22] WORKDIR /app
#19 CACHED

#20 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#20 CACHED

#21 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#21 0.071 + [ -d /app/themes/redtheme ]
#21 0.071 + basename /app/themes/redtheme
#21 0.072 + name=redtheme
#21 0.072 + [ -f /app/themes/redtheme/package.json ]
#21 0.072 + npm install --prefix /app/themes/redtheme
#21 1.122 
#21 1.122 added 4 packages, and audited 5 packages in 972ms
#21 1.123 
#21 1.123 found 0 vulnerabilities
#21 1.146 + npm run build --prefix /app/themes/redtheme
#21 1.276 
#21 1.276 > redtheme@0.1.0 build
#21 1.276 > tsc --project tsconfig.json
#21 1.276 
#21 1.280 sh: 1: tsc: not found
#21 ERROR: process "/bin/sh -c set -eux;   for theme in /app/themes/*; do     [ -d \"${theme}\" ] || continue;     name=\"$(basename \"${theme}\")\";     if [ -f \"${theme}/package.json\" ]; then       npm install --prefix \"${theme}\";       npm run build --prefix \"${theme}\";       if [ -d \"${theme}/dist\" ]; then         mkdir -p \"/app/themes-src/${name}\";         rm -rf \"/app/themes-src/${name}/dist\";         cp -R \"${theme}/dist\" \"/app/themes-src/${name}/dist\";       fi;     fi;   done" did not complete successfully: exit code: 127
------
 > [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       npm install --prefix "${theme}";       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done:
1.122 
1.122 added 4 packages, and audited 5 packages in 972ms
1.123 
1.123 found 0 vulnerabilities
1.146 + npm run build --prefix /app/themes/redtheme
1.276 
1.276 > redtheme@0.1.0 build
1.276 > tsc --project tsconfig.json
1.276 
1.280 sh: 1: tsc: not found
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c set -eux;   for theme in /app/themes/*; do     [ -d \"${theme}\" ] || continue;     name=\"$(basename \"${theme}\")\";     if [ -f \"${theme}/package.json\" ]; then       npm install --prefix \"${theme}\";       npm run build --prefix \"${theme}\";       if [ -d \"${theme}/dist\" ]; then         mkdir -p \"/app/themes-src/${name}\";         rm -rf \"/app/themes-src/${name}/dist\";         cp -R \"${theme}/dist\" \"/app/themes-src/${name}/dist\";       fi;     fi;   done" did not complete successfully: exit code: 127
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.85kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.5s done
#3 DONE 0.5s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 5.2s done
#5 DONE 5.2s

#6 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#7 CACHED

#8 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [evershop-source 2/5] WORKDIR /opt/evershop
#9 CACHED

#10 [stage-1  2/22] WORKDIR /app
#10 CACHED

#11 [stage-1  6/22] COPY config /app/config
#11 CACHED

#12 [stage-1 10/22] COPY themes /app/themes-src
#12 CACHED

#13 [stage-1  8/22] COPY scripts /app/scripts
#13 CACHED

#14 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#14 CACHED

#15 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#15 CACHED

#16 [stage-1  7/22] COPY patches /tmp/patches
#16 CACHED

#17 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#17 CACHED

#18 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#18 CACHED

#19 [stage-1  9/22] COPY extensions /app/extensions
#19 CACHED

#20 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#20 CACHED

#21 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#21 0.065 + [ -d /app/themes/redtheme ]
#21 0.065 + basename /app/themes/redtheme
#21 0.066 + name=redtheme
#21 0.066 + [ -f /app/themes/redtheme/package.json ]
#21 0.066 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#21 0.181 npm warn config production Use `--omit=dev` instead.
#21 1.365 
#21 1.365 added 5 packages, and audited 6 packages in 1s
#21 1.366 
#21 1.366 found 0 vulnerabilities
#21 1.388 + npm run build --prefix /app/themes/redtheme
#21 1.515 
#21 1.515 > redtheme@0.1.0 build
#21 1.515 > tsc --project tsconfig.json
#21 1.515 
#21 2.979 + [ -d /app/themes/redtheme/dist ]
#21 2.979 + mkdir -p /app/themes-src/redtheme
#21 2.981 + rm -rf /app/themes-src/redtheme/dist
#21 2.982 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#21 2.986 + [ -d /app/themes/venia ]
#21 2.986 + basename /app/themes/venia
#21 2.987 + name=venia
#21 2.987 + [ -f /app/themes/venia/package.json ]
#21 2.987 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#21 3.096 npm warn config production Use `--omit=dev` instead.
#21 4.020 
#21 4.020 added 5 packages, and audited 6 packages in 958ms
#21 4.021 
#21 4.021 found 0 vulnerabilities
#21 4.043 + npm run build --prefix /app/themes/venia
#21 4.184 
#21 4.184 > venia@0.1.0 build
#21 4.184 > tsc --project tsconfig.json
#21 4.184 
#21 5.674 + [ -d /app/themes/venia/dist ]
#21 5.674 + mkdir -p /app/themes-src/venia
#21 5.675 + rm -rf /app/themes-src/venia/dist
#21 5.676 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#21 DONE 5.8s

#22 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#22 DONE 0.0s

#23 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#23 DONE 0.0s

#24 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#24 DONE 0.0s

#25 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#25 0.093 + sed -i s/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#25 0.095 sed: can't read /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js: No such file or directory
#25 ERROR: process "/bin/sh -c set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv(\"AWS_REGION\") });/new S3Client({ region: getEnv(\"AWS_REGION\"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' \"$f\";   done" did not complete successfully: exit code: 2
------
 > [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done:
0.093 + sed -i s/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
0.095 sed: can't read /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js: No such file or directory
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.85kB 1.6s done
#1 DONE 1.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.6s done
#3 DONE 0.6s

#4 [internal] load build context
#4 ...

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#5 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 1.10MB 5.2s
#4 transferring context: 2.28MB 7.8s done
#4 ...

#6 [stage-1  9/22] COPY extensions /app/extensions
#6 CACHED

#7 [stage-1  6/22] COPY config /app/config
#7 CACHED

#8 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#8 CACHED

#9 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#9 CACHED

#10 [stage-1  7/22] COPY patches /tmp/patches
#10 CACHED

#11 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#11 CACHED

#12 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#12 CACHED

#13 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#13 CACHED

#14 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#14 CACHED

#15 [evershop-source 2/5] WORKDIR /opt/evershop
#15 CACHED

#16 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#16 CACHED

#17 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#17 CACHED

#18 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#18 CACHED

#19 [stage-1  8/22] COPY scripts /app/scripts
#19 CACHED

#20 [stage-1 10/22] COPY themes /app/themes-src
#20 CACHED

#21 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#21 CACHED

#22 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#22 CACHED

#23 [stage-1  2/22] WORKDIR /app
#23 CACHED

#24 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#24 CACHED

#25 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done
#25 0.074 + sed -i s/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#25 0.076 sed: can't read /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js: No such file or directory
#25 ERROR: process "/bin/sh -c set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv(\"AWS_REGION\") });/new S3Client({ region: getEnv(\"AWS_REGION\"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' \"$f\";   done" did not complete successfully: exit code: 2

#4 [internal] load build context
------
 > [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";   done:
0.074 + sed -i s/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
0.076 sed: can't read /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js: No such file or directory
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     sed -i 's/new S3Client({ region: getEnv(\"AWS_REGION\") });/new S3Client({ region: getEnv(\"AWS_REGION\"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' \"$f\";   done" did not complete successfully: exit code: 2
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.95kB 1.7s done
#1 DONE 1.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.8s done
#3 DONE 0.8s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.11MB 5.0s
#5 transferring context: 2.28MB 6.8s done
#5 DONE 6.8s

#6 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#6 CACHED

#7 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#7 CACHED

#8 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#8 CACHED

#9 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#9 CACHED

#10 [stage-1  8/22] COPY scripts /app/scripts
#10 CACHED

#11 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#11 CACHED

#12 [evershop-source 2/5] WORKDIR /opt/evershop
#12 CACHED

#13 [stage-1 10/22] COPY themes /app/themes-src
#13 CACHED

#14 [stage-1  7/22] COPY patches /tmp/patches
#14 CACHED

#15 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#15 CACHED

#16 [stage-1  6/22] COPY config /app/config
#16 CACHED

#17 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#17 CACHED

#18 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#18 CACHED

#19 [stage-1  9/22] COPY extensions /app/extensions
#19 CACHED

#20 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#20 CACHED

#21 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#21 CACHED

#22 [stage-1  2/22] WORKDIR /app
#22 CACHED

#23 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#23 CACHED

#24 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#24 CACHED

#25 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#25 0.099 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#25 0.099 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#25 0.099 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#25 0.099 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#25 0.099 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#25 0.099 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#25 DONE 0.1s

#26 [stage-1 18/22] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#26 DONE 0.0s

#27 [stage-1 19/22] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#27 DONE 0.1s

#28 [stage-1 20/22] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#28 DONE 0.1s

#29 [stage-1 21/22] RUN chmod +x /app/scripts/entrypoint.sh
#29 DONE 0.1s

#30 [stage-1 22/22] RUN npm run build
#30 0.250 
#30 0.250 > evershop@1.2.2 build
#30 0.250 > node ./packages/evershop/dist/bin/build/index.js
#30 0.250 
#30 0.292 node:internal/modules/cjs/loader:1210
#30 0.292   throw err;
#30 0.292   ^
#30 0.292 
#30 0.292 Error: Cannot find module '/app/packages/evershop/dist/bin/build/index.js'
#30 0.292     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
#30 0.292     at Module._load (node:internal/modules/cjs/loader:1038:27)
#30 0.292     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
#30 0.292     at node:internal/main/run_main_module:28:49 {
#30 0.292   code: 'MODULE_NOT_FOUND',
#30 0.292   requireStack: []
#30 0.292 }
#30 0.292 
#30 0.292 Node.js v20.19.5
#30 ERROR: process "/bin/sh -c npm run build" did not complete successfully: exit code: 1
------
 > [stage-1 22/22] RUN npm run build:
0.292 Error: Cannot find module '/app/packages/evershop/dist/bin/build/index.js'
0.292     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
0.292     at Module._load (node:internal/modules/cjs/loader:1038:27)
0.292     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
0.292     at node:internal/main/run_main_module:28:49 {
0.292   code: 'MODULE_NOT_FOUND',
0.292   requireStack: []
0.292 }
0.292 
0.292 Node.js v20.19.5
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.95kB 0.8s done
#1 DONE 0.8s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.6s done
#3 DONE 0.6s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 5.0s done
#5 DONE 5.0s

#6 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#6 CACHED

#7 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#7 CACHED

#8 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#8 CACHED

#9 [stage-1  8/22] COPY scripts /app/scripts
#9 CACHED

#10 [stage-1 10/22] COPY themes /app/themes-src
#10 CACHED

#11 [stage-1 20/22] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#11 CACHED

#12 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#12 CACHED

#13 [stage-1  2/22] WORKDIR /app
#13 CACHED

#14 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#14 CACHED

#15 [stage-1 18/22] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#15 CACHED

#16 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#16 CACHED

#17 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#17 CACHED

#18 [stage-1  6/22] COPY config /app/config
#18 CACHED

#19 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#19 CACHED

#20 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#20 CACHED

#21 [evershop-source 2/5] WORKDIR /opt/evershop
#21 CACHED

#22 [stage-1  9/22] COPY extensions /app/extensions
#22 CACHED

#23 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#23 CACHED

#24 [stage-1 19/22] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#24 CACHED

#25 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#25 CACHED

#26 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#26 CACHED

#27 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#27 CACHED

#28 [stage-1  7/22] COPY patches /tmp/patches
#28 CACHED

#29 [stage-1 21/22] RUN chmod +x /app/scripts/entrypoint.sh
#29 CACHED

#30 [stage-1 22/22] RUN npm run build
#30 0.236 
#30 0.236 > evershop@1.2.2 build
#30 0.236 > node ./packages/evershop/dist/bin/build/index.js
#30 0.236 
#30 0.286 node:internal/modules/cjs/loader:1210
#30 0.286   throw err;
#30 0.286   ^
#30 0.286 
#30 0.286 Error: Cannot find module '/app/packages/evershop/dist/bin/build/index.js'
#30 0.286     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
#30 0.286     at Module._load (node:internal/modules/cjs/loader:1038:27)
#30 0.286     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
#30 0.286     at node:internal/main/run_main_module:28:49 {
#30 0.286   code: 'MODULE_NOT_FOUND',
#30 0.286   requireStack: []
#30 0.286 }
#30 0.286 
#30 0.286 Node.js v20.19.5
#30 ERROR: process "/bin/sh -c npm run build" did not complete successfully: exit code: 1
------
 > [stage-1 22/22] RUN npm run build:
0.286 Error: Cannot find module '/app/packages/evershop/dist/bin/build/index.js'
0.286     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
0.286     at Module._load (node:internal/modules/cjs/loader:1038:27)
0.286     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12)
0.286     at node:internal/main/run_main_module:28:49 {
0.286   code: 'MODULE_NOT_FOUND',
0.286   requireStack: []
0.286 }
0.286 
0.286 Node.js v20.19.5
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c npm run build" did not complete successfully: exit code: 1
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.03kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 3.2s done
#5 ...

#6 [stage-1 19/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#6 CACHED

#7 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#7 CACHED

#8 [evershop-source 2/5] WORKDIR /opt/evershop
#8 CACHED

#9 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#9 CACHED

#10 [stage-1 15/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#10 CACHED

#11 [stage-1 16/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#11 CACHED

#12 [stage-1 14/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#12 CACHED

#13 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#13 CACHED

#14 [stage-1  8/23] COPY scripts /app/scripts
#14 CACHED

#15 [stage-1 18/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#15 CACHED

#16 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#16 CACHED

#17 [stage-1 10/23] COPY themes /app/themes-src
#17 CACHED

#18 [stage-1  2/23] WORKDIR /app
#18 CACHED

#19 [stage-1  6/23] COPY config /app/config
#19 CACHED

#20 [stage-1 12/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#20 CACHED

#21 [stage-1  9/23] COPY extensions /app/extensions
#21 CACHED

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#22 CACHED

#23 [stage-1  7/23] COPY patches /tmp/patches
#23 CACHED

#24 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#24 CACHED

#25 [stage-1 20/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#25 CACHED

#26 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#26 CACHED

#27 [stage-1 13/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#27 CACHED

#28 [stage-1 17/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#28 CACHED

#29 [stage-1 21/23] RUN chmod +x /app/scripts/entrypoint.sh
#29 CACHED

#5 [internal] load build context
#5 ...

#30 [stage-1 22/23] RUN npm run compile:tsc
#30 0.238 
#30 0.238 > evershop@1.2.2 compile:tsc
#30 0.238 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#30 0.238 
#30 0.242 sh: 1: rimraf: not found
#30 ERROR: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 127
------
 > [stage-1 22/23] RUN npm run compile:tsc:
0.238 
0.238 > evershop@1.2.2 compile:tsc
0.238 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
0.238 
0.242 sh: 1: rimraf: not found
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.03kB 0.8s done
#1 DONE 0.8s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 2.3s done
#3 DONE 2.3s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.51MB 5.0s
#5 transferring context: 2.28MB 6.4s done
#5 DONE 6.4s

#6 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#6 CACHED

#7 [evershop-source 2/5] WORKDIR /opt/evershop
#7 CACHED

#8 [stage-1 13/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#8 CACHED

#9 [stage-1  9/23] COPY extensions /app/extensions
#9 CACHED

#10 [stage-1 10/23] COPY themes /app/themes-src
#10 CACHED

#11 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#11 CACHED

#12 [stage-1 17/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#12 CACHED

#13 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#13 CACHED

#14 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#14 CACHED

#15 [stage-1  7/23] COPY patches /tmp/patches
#15 CACHED

#16 [stage-1  2/23] WORKDIR /app
#16 CACHED

#17 [stage-1 15/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#17 CACHED

#18 [stage-1 18/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#18 CACHED

#19 [stage-1 16/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#19 CACHED

#20 [stage-1 14/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#20 CACHED

#21 [stage-1 20/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#21 CACHED

#22 [stage-1  8/23] COPY scripts /app/scripts
#22 CACHED

#23 [stage-1 12/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#23 CACHED

#24 [stage-1 19/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#24 CACHED

#25 [stage-1  6/23] COPY config /app/config
#25 CACHED

#26 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#26 CACHED

#27 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#27 CACHED

#28 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#28 CACHED

#29 [stage-1 21/23] RUN chmod +x /app/scripts/entrypoint.sh
#29 CACHED

#30 [stage-1 22/23] RUN npm run compile:tsc
#30 0.243 
#30 0.243 > evershop@1.2.2 compile:tsc
#30 0.243 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#30 0.243 
#30 0.248 sh: 1: rimraf: not found
#30 ERROR: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 127
------
 > [stage-1 22/23] RUN npm run compile:tsc:
0.243 
0.243 > evershop@1.2.2 compile:tsc
0.243 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
0.243 
0.248 sh: 1: rimraf: not found
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 127
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 DONE 0.0s

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.16kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.5s done
#3 DONE 0.5s

#4 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.12MB 5.5s
#5 transferring context: 2.28MB 7.9s done
#5 DONE 7.9s

#6 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#6 CACHED

#7 [stage-1 15/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#7 CACHED

#8 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [stage-1  9/23] COPY extensions /app/extensions
#9 CACHED

#10 [stage-1 10/23] COPY themes /app/themes-src
#10 CACHED

#11 [stage-1 14/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#11 CACHED

#12 [stage-1 18/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#12 CACHED

#13 [stage-1 20/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#13 CACHED

#14 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#14 CACHED

#15 [stage-1  8/23] COPY scripts /app/scripts
#15 CACHED

#16 [stage-1 19/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#16 CACHED

#17 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#17 CACHED

#18 [stage-1  2/23] WORKDIR /app
#18 CACHED

#19 [stage-1 13/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#19 CACHED

#20 [stage-1 16/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#20 CACHED

#21 [stage-1 17/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#21 CACHED

#22 [stage-1  7/23] COPY patches /tmp/patches
#22 CACHED

#23 [evershop-source 2/5] WORKDIR /opt/evershop
#23 CACHED

#24 [stage-1  6/23] COPY config /app/config
#24 CACHED

#25 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#25 CACHED

#26 [stage-1 12/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#26 CACHED

#27 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#27 CACHED

#28 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#28 CACHED

#29 [stage-1 21/23] RUN chmod +x /app/scripts/entrypoint.sh
#29 CACHED

#30 [stage-1 22/23] RUN npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#30 1.781 npm warn exec The following package was not found and will be installed: rimraf@6.1.0
#30 4.774 npm warn exec The following package was not found and will be installed: tsc@2.0.4
#30 5.018 
#30 5.018 [41m                                                                               [0m
#30 5.018 [41m[37m                This is not the tsc command you are looking for                [0m
#30 5.018 [41m                                                                               [0m
#30 5.018 
#30 5.018 To get access to the TypeScript compiler, [34mtsc[0m, from the command line either:
#30 5.018 
#30 5.018 - Use [1mnpm install typescript[0m to first add TypeScript to your project [1mbefore[0m using npx
#30 5.018 - Use [1myarn[0m to avoid accidentally running code from un-installed packages
#30 ERROR: process "/bin/sh -c npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 \"src/**/*.{graphql,scss,json}\" dist" did not complete successfully: exit code: 1
------
 > [stage-1 22/23] RUN npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist:
4.774 npm warn exec The following package was not found and will be installed: tsc@2.0.4
5.018 
5.018 [41m                                                                               [0m
5.018 [41m[37m                This is not the tsc command you are looking for                [0m
5.018 [41m                                                                               [0m
5.018 
5.018 To get access to the TypeScript compiler, [34mtsc[0m, from the command line either:
5.018 
5.018 - Use [1mnpm install typescript[0m to first add TypeScript to your project [1mbefore[0m using npx
5.018 - Use [1myarn[0m to avoid accidentally running code from un-installed packages
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.16kB 0.9s done
#1 DONE 0.9s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [internal] load build context
#4 DONE 0.0s

#5 [evershop-source 1/5] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#5 DONE 0.0s

#4 [internal] load build context
#4 transferring context: 2.28MB 3.2s done
#4 DONE 3.2s

#6 [stage-1  9/23] COPY extensions /app/extensions
#6 CACHED

#7 [stage-1  2/23] WORKDIR /app
#7 CACHED

#8 [stage-1 15/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#8 CACHED

#9 [stage-1 19/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#9 CACHED

#10 [stage-1 20/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#10 CACHED

#11 [stage-1 16/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#11 CACHED

#12 [evershop-source 3/5] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#12 CACHED

#13 [stage-1 12/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#13 CACHED

#14 [stage-1  8/23] COPY scripts /app/scripts
#14 CACHED

#15 [stage-1  6/23] COPY config /app/config
#15 CACHED

#16 [stage-1  7/23] COPY patches /tmp/patches
#16 CACHED

#17 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#17 CACHED

#18 [stage-1 13/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#18 CACHED

#19 [stage-1 14/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#19 CACHED

#20 [evershop-source 5/5] RUN npm install --legacy-peer-deps
#20 CACHED

#21 [stage-1 10/23] COPY themes /app/themes-src
#21 CACHED

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#22 CACHED

#23 [stage-1 18/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#23 CACHED

#24 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#24 CACHED

#25 [stage-1 17/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#25 CACHED

#26 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#26 CACHED

#27 [evershop-source 2/5] WORKDIR /opt/evershop
#27 CACHED

#28 [evershop-source 4/5] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#28 CACHED

#29 [stage-1 21/23] RUN chmod +x /app/scripts/entrypoint.sh
#29 CACHED

#30 [stage-1 22/23] RUN npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#30 1.778 npm warn exec The following package was not found and will be installed: rimraf@6.1.0
#30 4.895 npm warn exec The following package was not found and will be installed: tsc@2.0.4
#30 5.055 
#30 5.055 [41m                                                                               [0m
#30 5.055 [41m[37m                This is not the tsc command you are looking for                [0m
#30 5.055 [41m                                                                               [0m
#30 5.055 
#30 5.055 To get access to the TypeScript compiler, [34mtsc[0m, from the command line either:
#30 5.055 
#30 5.055 - Use [1mnpm install typescript[0m to first add TypeScript to your project [1mbefore[0m using npx
#30 5.055 - Use [1myarn[0m to avoid accidentally running code from un-installed packages
#30 ERROR: process "/bin/sh -c npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 \"src/**/*.{graphql,scss,json}\" dist" did not complete successfully: exit code: 1
------
 > [stage-1 22/23] RUN npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist:
4.895 npm warn exec The following package was not found and will be installed: tsc@2.0.4
5.055 
5.055 [41m                                                                               [0m
5.055 [41m[37m                This is not the tsc command you are looking for                [0m
5.055 [41m                                                                               [0m
5.055 
5.055 To get access to the TypeScript compiler, [34mtsc[0m, from the command line either:
5.055 
5.055 - Use [1mnpm install typescript[0m to first add TypeScript to your project [1mbefore[0m using npx
5.055 - Use [1myarn[0m to avoid accidentally running code from un-installed packages
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c npx rimraf ./packages/evershop/dist &&     cd ./packages/evershop &&     npx tsc &&     npx copyfiles -u 1 \"src/**/*.{graphql,scss,json}\" dist" did not complete successfully: exit code: 1
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.97kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/6] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [evershop-source 3/6] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#5 CACHED

#6 [evershop-source 4/6] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#6 CACHED

#7 [evershop-source 2/6] WORKDIR /opt/evershop
#7 CACHED

#8 [evershop-source 5/6] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [internal] load build context
#9 transferring context: 2.28MB 3.8s done
#9 DONE 3.8s

#10 [evershop-source 6/6] RUN npm run compile:tsc
#10 1.206 
#10 1.206 > evershop@1.2.2 compile:tsc
#10 1.206 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#10 1.206 
#10 13.45 src/lib/event/emitter.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/lib/postgres/connection.ts(2,28): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/createProductAttribute.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/createProductAttribute.ts(9,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/deleteProductAttribute.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/deleteProductAttribute.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/updateProductAttribute.ts(1,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/attribute/updateProductAttribute.ts(11,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/createCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/createCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/deleteCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/deleteCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/updateCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/category/updateCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/createCollection.ts(6,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/createCollection.ts(7,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/deleteCollection.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/deleteCollection.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/updateCollection.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/collection/updateCollection.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getCategoriesBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getCollectionsBaseQuery.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getCollectionsBaseQuery.ts(2,34): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getProductsBaseQuery.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getProductsBaseQuery.ts(2,34): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getProductsByCategoryBaseQuery.ts(1,38): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/getProductsByCollectionBaseQuery.ts(1,29): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/product/createProduct.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/product/createProduct.ts(10,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/product/deleteProduct.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/product/deleteProduct.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/catalog/services/product/updateProduct.ts(11,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/checkout/services/getCurrentCart.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/checkout/services/orderCreator.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/checkout/services/saveCart.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/address/createCustomerAddress.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/address/deleteCustomerAddress.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/address/updateCustomerAddress.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/createCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/deleteCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/updateCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/customer/updatePassword.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/customer/services/getCustomersBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/oms/services/cancelOrder.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/oms/services/updateOrderStatus.ts(13,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/oms/services/updatePaymentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/oms/services/updateShipmentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/setting/services/setting.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 13.45 src/modules/setting/services/setting.ts(15,15): error TS18048: 'setting' is possibly 'undefined'.
#10 ERROR: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 2
------
 > [evershop-source 6/6] RUN npm run compile:tsc:
13.45 src/modules/customer/services/customer/deleteCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/customer/services/customer/updateCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/customer/services/customer/updatePassword.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/customer/services/getCustomersBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/oms/services/cancelOrder.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/oms/services/updateOrderStatus.ts(13,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/oms/services/updatePaymentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/oms/services/updateShipmentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/setting/services/setting.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
13.45 src/modules/setting/services/setting.ts(15,15): error TS18048: 'setting' is possibly 'undefined'.
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.97kB 0.8s done
#1 DONE 0.8s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.7s done
#3 DONE 0.7s

#4 [stage-1  1/22] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [evershop-source 2/6] WORKDIR /opt/evershop
#5 CACHED

#6 [evershop-source 3/6] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [evershop-source 4/6] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#7 CACHED

#8 [evershop-source 5/6] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [internal] load build context
#9 transferring context: 1.56MB 5.0s
#9 transferring context: 2.28MB 6.6s done
#9 DONE 6.6s

#10 [evershop-source 6/6] RUN npm run compile:tsc
#10 0.210 
#10 0.210 > evershop@1.2.2 compile:tsc
#10 0.210 > rimraf ./packages/evershop/dist && cd ./packages/evershop && tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#10 0.210 
#10 12.55 src/lib/event/emitter.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/lib/postgres/connection.ts(2,28): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/createProductAttribute.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/createProductAttribute.ts(9,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/deleteProductAttribute.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/deleteProductAttribute.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/updateProductAttribute.ts(1,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/attribute/updateProductAttribute.ts(11,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/createCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/createCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/deleteCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/deleteCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/updateCategory.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/category/updateCategory.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/createCollection.ts(6,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/createCollection.ts(7,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/deleteCollection.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/deleteCollection.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/updateCollection.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/collection/updateCollection.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getCategoriesBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getCollectionsBaseQuery.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getCollectionsBaseQuery.ts(2,34): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getProductsBaseQuery.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getProductsBaseQuery.ts(2,34): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getProductsByCategoryBaseQuery.ts(1,38): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/getProductsByCollectionBaseQuery.ts(1,29): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/product/createProduct.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/product/createProduct.ts(10,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/product/deleteProduct.ts(7,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/product/deleteProduct.ts(8,33): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/catalog/services/product/updateProduct.ts(11,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/checkout/services/getCurrentCart.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/checkout/services/orderCreator.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/checkout/services/saveCart.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/address/createCustomerAddress.ts(9,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/address/deleteCustomerAddress.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/address/updateCustomerAddress.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/createCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/deleteCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/updateCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/customer/updatePassword.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/customer/services/getCustomersBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/oms/services/cancelOrder.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/oms/services/updateOrderStatus.ts(13,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/oms/services/updatePaymentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/oms/services/updateShipmentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/setting/services/setting.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
#10 12.55 src/modules/setting/services/setting.ts(15,15): error TS18048: 'setting' is possibly 'undefined'.
#10 ERROR: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 2
------
 > [evershop-source 6/6] RUN npm run compile:tsc:
12.55 src/modules/customer/services/customer/deleteCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/customer/services/customer/updateCustomer.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/customer/services/customer/updatePassword.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/customer/services/getCustomersBaseQuery.ts(1,37): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/oms/services/cancelOrder.ts(10,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/oms/services/updateOrderStatus.ts(13,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/oms/services/updatePaymentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/oms/services/updateShipmentStatus.ts(8,8): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/setting/services/setting.ts(1,24): error TS2307: Cannot find module '@evershop/postgres-query-builder' or its corresponding type declarations.
12.55 src/modules/setting/services/setting.ts(15,15): error TS18048: 'setting' is possibly 'undefined'.
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c npm run compile:tsc" did not complete successfully: exit code: 2
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 3.97kB 1.4s done
#1 DONE 1.4s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/6] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [evershop-source 2/6] WORKDIR /opt/evershop
#5 CACHED

#6 [evershop-source 3/6] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [evershop-source 4/6] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#7 CACHED

#8 [evershop-source 5/6] RUN npm install --legacy-peer-deps
#8 CACHED

#9 [internal] load build context
#9 ...

#10 [evershop-source 6/6] RUN npm run compile
#10 0.202 
#10 0.202 > evershop@1.2.2 compile
#10 0.202 > rimraf ./packages/evershop/dist && cd ./packages/evershop && swc ./src/ -d dist/ --config-file .swcrc --copy-files --strip-leading-paths
#10 0.202 
#10 0.787 Successfully compiled: 1267 files, copied 398 files with swc (401.39ms)
#10 DONE 0.9s

#9 [internal] load build context
#9 ...

#11 [stage-1  2/22] WORKDIR /app
#11 CACHED

#12 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#12 CACHED

#9 [internal] load build context
#9 transferring context: 628.97kB 5.2s
#9 transferring context: 2.28MB 8.9s done
#9 DONE 8.9s

#13 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#13 DONE 15.6s

#14 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#14 9.253 npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
#14 12.98 
#14 12.98 added 211 packages, changed 1 package, and audited 1167 packages in 12s
#14 12.98 
#14 12.98 276 packages are looking for funding
#14 12.98   run `npm fund` for details
#14 12.99 
#14 12.99 9 vulnerabilities (3 low, 5 high, 1 critical)
#14 12.99 
#14 12.99 To address issues that do not require attention, run:
#14 12.99   npm audit fix
#14 12.99 
#14 12.99 To address all issues (including breaking changes), run:
#14 12.99   npm audit fix --force
#14 12.99 
#14 12.99 Run `npm audit` for details.
#14 12.99 npm notice
#14 12.99 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#14 12.99 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#14 12.99 npm notice To update run: npm install -g npm@11.6.2
#14 12.99 npm notice
#14 DONE 13.9s

#15 [stage-1  6/22] COPY config /app/config
#15 DONE 0.1s

#16 [stage-1  7/22] COPY patches /tmp/patches
#16 DONE 0.0s

#17 [stage-1  8/22] COPY scripts /app/scripts
#17 DONE 0.0s

#18 [stage-1  9/22] COPY extensions /app/extensions
#18 DONE 4.5s

#19 [stage-1 10/22] COPY themes /app/themes-src
#19 DONE 0.2s

#20 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#20 1.298 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#20 22.25 
#20 22.25 added 1 package, removed 712 packages, changed 2 packages, and audited 1161 packages in 22s
#20 22.25 
#20 22.25 276 packages are looking for funding
#20 22.25   run `npm fund` for details
#20 22.25 
#20 22.25 6 vulnerabilities (1 low, 4 high, 1 critical)
#20 22.25 
#20 22.25 To address issues that do not require attention, run:
#20 22.25   npm audit fix
#20 22.25 
#20 22.25 To address all issues (including breaking changes), run:
#20 22.25   npm audit fix --force
#20 22.25 
#20 22.25 Run `npm audit` for details.
#20 DONE 22.4s

#21 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#21 DONE 0.1s

#22 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#22 0.081 + [ -d /app/themes/redtheme ]
#22 0.082 + basename /app/themes/redtheme
#22 0.083 + name=redtheme
#22 0.083 + [ -f /app/themes/redtheme/package.json ]
#22 0.083 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#22 0.186 npm warn config production Use `--omit=dev` instead.
#22 1.392 
#22 1.392 added 5 packages, and audited 6 packages in 1s
#22 1.393 
#22 1.393 found 0 vulnerabilities
#22 1.415 + npm run build --prefix /app/themes/redtheme
#22 1.565 
#22 1.565 > redtheme@0.1.0 build
#22 1.565 > tsc --project tsconfig.json
#22 1.565 
#22 3.084 + [ -d /app/themes/redtheme/dist ]
#22 3.084 + mkdir -p /app/themes-src/redtheme
#22 3.086 + rm -rf /app/themes-src/redtheme/dist
#22 3.087 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#22 3.091 + [ -d /app/themes/venia ]
#22 3.091 + basename /app/themes/venia
#22 3.092 + name=venia
#22 3.092 + [ -f /app/themes/venia/package.json ]
#22 3.092 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#22 3.196 npm warn config production Use `--omit=dev` instead.
#22 4.050 
#22 4.050 added 5 packages, and audited 6 packages in 887ms
#22 4.051 
#22 4.051 found 0 vulnerabilities
#22 4.073 + npm run build --prefix /app/themes/venia
#22 4.205 
#22 4.205 > venia@0.1.0 build
#22 4.205 > tsc --project tsconfig.json
#22 4.205 
#22 5.672 + [ -d /app/themes/venia/dist ]
#22 5.672 + mkdir -p /app/themes-src/venia
#22 5.673 + rm -rf /app/themes-src/venia/dist
#22 5.674 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#22 DONE 5.8s

#23 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#23 DONE 0.0s

#24 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#24 DONE 0.0s

#25 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#25 DONE 0.0s

#26 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#26 0.083 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#26 0.084 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#26 0.084 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#26 0.084 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#26 0.084 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#26 0.084 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#26 DONE 0.1s

#27 [stage-1 18/22] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#27 DONE 0.0s

#28 [stage-1 19/22] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#28 DONE 0.1s

#29 [stage-1 20/22] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#29 DONE 0.1s

#30 [stage-1 21/22] RUN chmod +x /app/scripts/entrypoint.sh
#30 DONE 0.1s

#31 [stage-1 22/22] RUN npm run build
#31 0.261 
#31 0.261 > evershop@1.2.2 build
#31 0.261 > node ./packages/evershop/dist/bin/build/index.js
#31 0.261 
#31 1.147 Error: Cannot find package '/app/node_modules/@evershop/postgres-query-builder/dist/index.js' imported from /app/packages/evershop/dist/modules/auth/services/loginUserWithEmail.js
#31 1.147     at legacyMainResolve (node:internal/modules/esm/resolve:215:26)
#31 1.147     at packageResolve (node:internal/modules/esm/resolve:860:14)
#31 1.147     at moduleResolve (node:internal/modules/esm/resolve:946:18)
#31 1.147     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
#31 1.147     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
#31 1.147     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
#31 1.147     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
#31 1.147     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
#31 1.147     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
#31 1.147   code: 'ERR_MODULE_NOT_FOUND'
#31 1.147 }
#31 1.147 Called from: at build (file:///app/packages/evershop/dist/bin/build/index.js:56:9)
#31 1.155 [31mâŒ[0m [31merror[0m: 
#31 1.155 [31mCannot find package '/app/node_modules/@evershop/postgres-query-builder/dist/index.js' imported from /app/packages/evershop/dist/modules/auth/services/loginUserWithEmail.js[39m
#31 1.155 [31mError: Cannot find package '/app/node_modules/@evershop/postgres-query-builder/dist/index.js' imported from /app/packages/evershop/dist/modules/auth/services/loginUserWithEmail.js[39m
#31 1.155 [31m    at legacyMainResolve (node:internal/modules/esm/resolve:215:26)[39m
#31 1.155 [31m    at packageResolve (node:internal/modules/esm/resolve:860:14)[39m
#31 1.155 [31m    at moduleResolve (node:internal/modules/esm/resolve:946:18)[39m
#31 1.155 [31m    at defaultResolve (node:internal/modules/esm/resolve:1188:11)[39m
#31 1.155 [31m    at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)[39m
#31 1.155 [31m    at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)[39m
#31 1.155 [31m    at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)[39m
#31 1.155 [31m    at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)[39m
#31 1.155 [31m    at ModuleJob._link (node:internal/modules/esm/module_job:168:49)[39m
#31 DONE 1.2s

#32 exporting to image
#32 exporting layers
#32 exporting layers 19.9s done
#32 exporting manifest sha256:50222b7b0b09215ef1f98857e967e90b3f93315d2960a22661d572bc1f6583a4 done
#32 exporting config sha256:800082f7019ba284e3f82c369d4006eaa63b92d7bf7fd590e38547b9d6a8463e done
#32 pushing layers for registry.fly.io/evershop-fly:deployment-01K91M706G6Q7635N748Y69WDG@sha256:50222b7b0b09215ef1f98857e967e90b3f93315d2960a22661d572bc1f6583a4
#32 pushing layer sha256:800082f7019ba284e3f82c369d4006eaa63b92d7bf7fd590e38547b9d6a8463e
#32 pushing layer sha256:f69c77e16fb3178f92ef07b6e36c680234dea0e8d5de95718412cec7d89fecf5
#32 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#32 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#32 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#32 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#32 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#32 pushing layer sha256:957683b99254608afb35663326b84c9df5d3df0870464db561c4e9298e0cce04
#32 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#32 pushing layer sha256:e505715f0cc3412892614a0aca0563569315680e3fa7973d85c905fcd0b90c83
#32 pushing layer sha256:e389769b766bb5b7c7b2c72078de3f8b949cfcc9a5b9361f38e40b18474ccba0
#32 pushing layer sha256:1a6bcaefab50190bbe2b4ebbc576525d6bcc987d52b2af3dedeba73945c1732f
#32 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#32 pushing layer sha256:13499583fb6ad44324fed38ea209fa2d6f69d64bedc23490a32d605da0f3c0a9
#32 pushing layer sha256:68890ff00a5b26ee3b109c2dd3d3163ad2731b2c6739de3a913160d8be1e30be
#32 pushing layer sha256:a9b5b89f8f731ed445e9e847f570e38a334f855e4ebdeb71c96ec5cfe2e5f051
#32 pushing layer sha256:a6c37945f22abf6aea1581a99747cd4ae79ba3ab96a7a7b2e1d48e7dc8f59628
#32 pushing layer sha256:ae625c49a9f427492925b51ad557b4e8ee64d7c189da79ce97f06ed64e4038ae
#32 pushing layer sha256:0fab9d49442e7d48fe12d2c2a411c144bfbd4a1a4383dae5f2b62d7675d69521
#32 pushing layer sha256:0380e8b585689f099a0e2ce8640f95b2dabb00f8671652f53536cefe681c72db
#32 pushing layer sha256:d887b20700cdb60059481b5a79c13c813917dacc49a5a037409996aab375191c
#32 pushing layer sha256:e3aec88d865dba862855c5a0aa7cf669a2befa9b45e266df51904ddcb92e6017
#32 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#32 pushing layer sha256:fc84be4d02c0443e17247db5e32fc15508ebc21217eabdc1a7718094e82e46d9
#32 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#32 pushing layer sha256:28da4e13cf9059603eaecaaa4da55dde7d12da54aaaaa71bbc6f1421904d4cfe
#32 pushing layer sha256:a272ea052a68aba31833dd37f3535c06fb6b49525845c8c8fc7d6f9f09923bd6
#32 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#32 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#32 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.7s done
#32 pushing layer sha256:f69c77e16fb3178f92ef07b6e36c680234dea0e8d5de95718412cec7d89fecf5 3.8s done
#32 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.7s done
#32 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.8s done
#32 pushing layer sha256:e505715f0cc3412892614a0aca0563569315680e3fa7973d85c905fcd0b90c83 3.8s done
#32 pushing layer sha256:800082f7019ba284e3f82c369d4006eaa63b92d7bf7fd590e38547b9d6a8463e 4.0s done
#32 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 4.0s done
#32 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 4.0s done
#32 pushing layer sha256:957683b99254608afb35663326b84c9df5d3df0870464db561c4e9298e0cce04 4.0s done
#32 pushing layer sha256:1a6bcaefab50190bbe2b4ebbc576525d6bcc987d52b2af3dedeba73945c1732f 4.1s done
#32 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 4.0s done
#32 pushing layer sha256:68890ff00a5b26ee3b109c2dd3d3163ad2731b2c6739de3a913160d8be1e30be 4.0s done
#32 pushing layer sha256:a6c37945f22abf6aea1581a99747cd4ae79ba3ab96a7a7b2e1d48e7dc8f59628 4.2s done
#32 pushing layer sha256:a9b5b89f8f731ed445e9e847f570e38a334f855e4ebdeb71c96ec5cfe2e5f051 4.2s done
#32 pushing layer sha256:ae625c49a9f427492925b51ad557b4e8ee64d7c189da79ce97f06ed64e4038ae 4.2s done
#32 pushing layer sha256:0fab9d49442e7d48fe12d2c2a411c144bfbd4a1a4383dae5f2b62d7675d69521 4.2s done
#32 pushing layer sha256:e3aec88d865dba862855c5a0aa7cf669a2befa9b45e266df51904ddcb92e6017 4.2s done
#32 pushing layer sha256:28da4e13cf9059603eaecaaa4da55dde7d12da54aaaaa71bbc6f1421904d4cfe 4.5s done
#32 pushing layer sha256:fc84be4d02c0443e17247db5e32fc15508ebc21217eabdc1a7718094e82e46d9 4.5s done
#32 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 4.6s done
#32 pushing layer sha256:d887b20700cdb60059481b5a79c13c813917dacc49a5a037409996aab375191c 5.1s done
#32 pushing layer sha256:0380e8b585689f099a0e2ce8640f95b2dabb00f8671652f53536cefe681c72db 5.2s done
#32 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 5.2s done
#32 pushing layer sha256:13499583fb6ad44324fed38ea209fa2d6f69d64bedc23490a32d605da0f3c0a9 5.6s done
#32 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 5.9s done
#32 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 6.3s done
#32 pushing layer sha256:a272ea052a68aba31833dd37f3535c06fb6b49525845c8c8fc7d6f9f09923bd6 6.4s done
#32 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 6.5s done
#32 pushing layer sha256:e389769b766bb5b7c7b2c72078de3f8b949cfcc9a5b9361f38e40b18474ccba0 6.9s done
#32 pushing layers for registry.fly.io/evershop-fly:deployment-01K91M706G6Q7635N748Y69WDG@sha256:50222b7b0b09215ef1f98857e967e90b3f93315d2960a22661d572bc1f6583a4 7.6s done
#32 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 7.6s done
#32 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91M706G6Q7635N748Y69WDG@sha256:50222b7b0b09215ef1f98857e967e90b3f93315d2960a22661d572bc1f6583a4
#32 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91M706G6Q7635N748Y69WDG@sha256:50222b7b0b09215ef1f98857e967e90b3f93315d2960a22661d572bc1f6583a4 0.1s done
#32 DONE 27.8s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91M706G6Q7635N748Y69WDG
image size: 476 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached started state
> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ– Unrecoverable error: timeout reached waiting for health checks to pass for machine 1859727f4d5d58: failed to get VM 1859727f4d5d58: Get "https://api.machines.dev/v1/apps/evershop-fly/machines/1859727f4d5d58": net/http: request canceled
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Error: failed to update machine 1859727f4d5d58: Unrecoverable error: timeout reached waiting for health checks to pass for machine 1859727f4d5d58: failed to get VM 1859727f4d5d58: Get "https://api.machines.dev/v1/apps/evershop-fly/machines/1859727f4d5d58": net/http: request canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.03kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [internal] load build context
#4 DONE 0.0s

#5 [evershop-source 1/7] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#5 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#5 DONE 0.0s

#6 [evershop-source 4/7] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#6 CACHED

#7 [evershop-source 2/7] WORKDIR /opt/evershop
#7 CACHED

#8 [evershop-source 3/7] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#8 CACHED

#9 [evershop-source 5/7] RUN npm install --legacy-peer-deps
#9 CACHED

#10 [evershop-source 6/7] RUN npm run compile
#10 CACHED

#4 [internal] load build context
#4 ...

#11 [evershop-source 7/7] RUN npm run compile --workspace @evershop/postgres-query-builder
#11 0.834 
#11 0.834 > @evershop/postgres-query-builder@2.0.0 compile
#11 0.834 > tsc
#11 0.834 
#11 DONE 3.1s

#4 [internal] load build context
#4 transferring context: 2.28MB 5.0s
#4 transferring context: 2.28MB 5.0s done
#4 DONE 5.2s

#12 [stage-1  2/22] WORKDIR /app
#12 CACHED

#13 [stage-1  3/22] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#13 CACHED

#14 [stage-1  4/22] COPY --from=evershop-source /opt/evershop /app
#14 DONE 16.6s

#15 [stage-1  5/22] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#15 8.764 npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
#15 12.53 
#15 12.53 added 211 packages, changed 1 package, and audited 1167 packages in 12s
#15 12.53 
#15 12.53 276 packages are looking for funding
#15 12.53   run `npm fund` for details
#15 12.54 
#15 12.54 9 vulnerabilities (3 low, 5 high, 1 critical)
#15 12.54 
#15 12.54 To address issues that do not require attention, run:
#15 12.54   npm audit fix
#15 12.54 
#15 12.54 To address all issues (including breaking changes), run:
#15 12.54   npm audit fix --force
#15 12.54 
#15 12.54 Run `npm audit` for details.
#15 12.54 npm notice
#15 12.54 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#15 12.54 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#15 12.54 npm notice To update run: npm install -g npm@11.6.2
#15 12.54 npm notice
#15 DONE 12.9s

#16 [stage-1  6/22] COPY config /app/config
#16 DONE 0.1s

#17 [stage-1  7/22] COPY patches /tmp/patches
#17 DONE 0.0s

#18 [stage-1  8/22] COPY scripts /app/scripts
#18 DONE 0.0s

#19 [stage-1  9/22] COPY extensions /app/extensions
#19 DONE 6.6s

#20 [stage-1 10/22] COPY themes /app/themes-src
#20 DONE 0.2s

#21 [stage-1 11/22] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#21 1.356 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#21 21.24 
#21 21.24 added 1 package, removed 712 packages, changed 2 packages, and audited 1161 packages in 21s
#21 21.24 
#21 21.24 276 packages are looking for funding
#21 21.24   run `npm fund` for details
#21 21.25 
#21 21.25 6 vulnerabilities (1 low, 4 high, 1 critical)
#21 21.25 
#21 21.25 To address issues that do not require attention, run:
#21 21.25   npm audit fix
#21 21.25 
#21 21.25 To address all issues (including breaking changes), run:
#21 21.25   npm audit fix --force
#21 21.25 
#21 21.25 Run `npm audit` for details.
#21 DONE 21.4s

#22 [stage-1 12/22] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#22 DONE 0.1s

#23 [stage-1 13/22] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#23 0.084 + [ -d /app/themes/redtheme ]
#23 0.084 + basename /app/themes/redtheme
#23 0.086 + name=redtheme
#23 0.086 + [ -f /app/themes/redtheme/package.json ]
#23 0.086 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#23 0.190 npm warn config production Use `--omit=dev` instead.
#23 1.417 
#23 1.417 added 5 packages, and audited 6 packages in 1s
#23 1.418 
#23 1.418 found 0 vulnerabilities
#23 1.440 + npm run build --prefix /app/themes/redtheme
#23 1.571 
#23 1.571 > redtheme@0.1.0 build
#23 1.571 > tsc --project tsconfig.json
#23 1.571 
#23 3.079 + [ -d /app/themes/redtheme/dist ]
#23 3.079 + mkdir -p /app/themes-src/redtheme
#23 3.081 + rm -rf /app/themes-src/redtheme/dist
#23 3.082 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#23 3.086 + [ -d /app/themes/venia ]
#23 3.087 + basename /app/themes/venia
#23 3.087 + name=venia
#23 3.087 + [ -f /app/themes/venia/package.json ]
#23 3.087 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#23 3.194 npm warn config production Use `--omit=dev` instead.
#23 4.080 
#23 4.080 added 5 packages, and audited 6 packages in 921ms
#23 4.081 
#23 4.081 found 0 vulnerabilities
#23 4.104 + npm run build --prefix /app/themes/venia
#23 4.239 
#23 4.239 > venia@0.1.0 build
#23 4.239 > tsc --project tsconfig.json
#23 4.239 
#23 5.715 + [ -d /app/themes/venia/dist ]
#23 5.715 + mkdir -p /app/themes-src/venia
#23 5.717 + rm -rf /app/themes-src/venia/dist
#23 5.718 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#23 DONE 5.9s

#24 [stage-1 14/22] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#24 DONE 0.0s

#25 [stage-1 15/22] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#25 DONE 0.0s

#26 [stage-1 16/22] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#26 DONE 0.0s

#27 [stage-1 17/22] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#27 0.069 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#27 0.069 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#27 0.069 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#27 0.069 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#27 0.069 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#27 0.069 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#27 DONE 0.1s

#28 [stage-1 18/22] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#28 DONE 0.0s

#29 [stage-1 19/22] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#29 DONE 0.1s

#30 [stage-1 20/22] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#30 DONE 0.1s

#31 [stage-1 21/22] RUN chmod +x /app/scripts/entrypoint.sh
#31 DONE 0.1s

#32 [stage-1 22/22] RUN npm run build
#32 0.234 
#32 0.234 > evershop@1.2.2 build
#32 0.234 > node ./packages/evershop/dist/bin/build/index.js
#32 0.234 
#32 1.717 Error: Invalid configuration:
#32 1.717 /system/file_storage must be one of the following values: local
#32 1.717     at validateConfiguration (file:///app/packages/evershop/dist/lib/util/validateConfiguration.js:48:15)
#32 1.717     at build (file:///app/packages/evershop/dist/bin/build/index.js:54:9)
#32 1.717 Called from: at build (file:///app/packages/evershop/dist/bin/build/index.js:56:9)
#32 1.723 [31mâŒ[0m [31merror[0m: 
#32 1.723 [31mInvalid configuration:[39m
#32 1.723 [31m/system/file_storage must be one of the following values: local[39m
#32 1.723 [31mError: Invalid configuration:[39m
#32 1.723 [31m/system/file_storage must be one of the following values: local[39m
#32 1.723 [31m    at validateConfiguration (file:///app/packages/evershop/dist/lib/util/validateConfiguration.js:48:15)[39m
#32 1.723 [31m    at build (file:///app/packages/evershop/dist/bin/build/index.js:54:9)[39m
#32 DONE 1.8s

#33 exporting to image
#33 exporting layers
#33 exporting layers 12.2s done
#33 exporting manifest sha256:68aa635eb2a954ac60a32f9ab3d57e78f51b9ef57620907f1d6ea8657a22a64c done
#33 exporting config sha256:ebd2b25342b224367d6b184d6c9f1c8d32c56469dcf8535c8db2c4c1eac8fa23 done
#33 pushing layers for registry.fly.io/evershop-fly:deployment-01K91MPCHFDEH60VMXH105DYAC@sha256:68aa635eb2a954ac60a32f9ab3d57e78f51b9ef57620907f1d6ea8657a22a64c
#33 pushing layer sha256:416e4c3c979db27b2122457d74cc2eee7fcce37d5ce7befd7f3dad09b4a4ad69
#33 pushing layer sha256:ebd2b25342b224367d6b184d6c9f1c8d32c56469dcf8535c8db2c4c1eac8fa23
#33 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#33 pushing layer sha256:6bdc0d2115e37ad4d03f2a7dbdb6afcf57a7eab33bc359216a3249d6cf302e96
#33 pushing layer sha256:87bb853af7f8f81b6003b5c7dac859e00d692fca3e3ab66b43216cce9cff7f85
#33 pushing layer sha256:9257a925b1692c1d55c8bb6f06f436ac8ca30f0de97eb4a2c9c8a9181550d7c6
#33 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#33 pushing layer sha256:c022717a7b8e36bbf6782bc0ba3fdc2ace6b2760d2866867e78e81fd8cbc3539
#33 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#33 pushing layer sha256:e9626dc3a2d9ed9942547836965ebd4dba3ae659db6c6f85eb95c612421c47f2
#33 pushing layer sha256:f1b9b68f503728f06f5d72bfda1ca05b1bc86f522f80601598f8082a4822357f
#33 pushing layer sha256:c998ffb68aa7a89a3fec699aa52a980af0aeb05b196f4d134809bb6dcb948e66
#33 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#33 pushing layer sha256:6d3d97ccb3a2a15380c1ec79cf494c00a910a4cd9e8cb0870c2dbb7715292e2b
#33 pushing layer sha256:79644932ce3d414c107fe2d9a8c9c1b642e3c92f6706f8b1a0ab89a476cef5d1
#33 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#33 pushing layer sha256:398683a5785d2d9d9bd97920801bdd568bfdb2d04b63fa142f120c7161957f64
#33 pushing layer sha256:93faf54afd97e5fb98bfedba2e071e84b9b9119f9834242c2e907147e729ea5c
#33 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#33 pushing layer sha256:f4869e6fea4b002d80a6c8473fa4a83b7467c234759d0cbd1faa50b57da766c9
#33 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#33 pushing layer sha256:443b64079031e1bc89ec91f014434eac3ebb5d7d16bd3fafa121f1105dca6028
#33 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#33 pushing layer sha256:db3ac3b65dc17576fa6728840b6ca5d112a663ea9bab553f75d3c30830b56357
#33 pushing layer sha256:54ac16e239aeaa779cb621820116be53f18445338637195a83e9b2ccf280aafe
#33 pushing layer sha256:90fb1271f2dedbb2c22ed4ad3594fe7bfc435afb7f042c2ed8e4d0a056ad9997
#33 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#33 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#33 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#33 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 0.3s done
#33 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 0.9s done
#33 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 1.3s done
#33 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 3.0s done
#33 pushing layer sha256:416e4c3c979db27b2122457d74cc2eee7fcce37d5ce7befd7f3dad09b4a4ad69 3.1s done
#33 pushing layer sha256:e9626dc3a2d9ed9942547836965ebd4dba3ae659db6c6f85eb95c612421c47f2 3.2s done
#33 pushing layer sha256:f1b9b68f503728f06f5d72bfda1ca05b1bc86f522f80601598f8082a4822357f 3.1s done
#33 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 3.0s done
#33 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.0s done
#33 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 3.0s done
#33 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 3.0s done
#33 pushing layer sha256:ebd2b25342b224367d6b184d6c9f1c8d32c56469dcf8535c8db2c4c1eac8fa23 3.2s done
#33 pushing layer sha256:9257a925b1692c1d55c8bb6f06f436ac8ca30f0de97eb4a2c9c8a9181550d7c6 3.2s done
#33 pushing layer sha256:c022717a7b8e36bbf6782bc0ba3fdc2ace6b2760d2866867e78e81fd8cbc3539 3.2s done
#33 pushing layer sha256:c998ffb68aa7a89a3fec699aa52a980af0aeb05b196f4d134809bb6dcb948e66 3.2s done
#33 pushing layer sha256:6d3d97ccb3a2a15380c1ec79cf494c00a910a4cd9e8cb0870c2dbb7715292e2b 3.2s done
#33 pushing layer sha256:79644932ce3d414c107fe2d9a8c9c1b642e3c92f6706f8b1a0ab89a476cef5d1 3.2s done
#33 pushing layer sha256:398683a5785d2d9d9bd97920801bdd568bfdb2d04b63fa142f120c7161957f64 3.2s done
#33 pushing layer sha256:93faf54afd97e5fb98bfedba2e071e84b9b9119f9834242c2e907147e729ea5c 3.3s done
#33 pushing layer sha256:db3ac3b65dc17576fa6728840b6ca5d112a663ea9bab553f75d3c30830b56357 3.2s done
#33 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.2s done
#33 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 3.2s done
#33 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 3.3s done
#33 pushing layer sha256:54ac16e239aeaa779cb621820116be53f18445338637195a83e9b2ccf280aafe 3.3s done
#33 pushing layer sha256:87bb853af7f8f81b6003b5c7dac859e00d692fca3e3ab66b43216cce9cff7f85 3.6s done
#33 pushing layer sha256:443b64079031e1bc89ec91f014434eac3ebb5d7d16bd3fafa121f1105dca6028 3.7s done
#33 pushing layer sha256:f4869e6fea4b002d80a6c8473fa4a83b7467c234759d0cbd1faa50b57da766c9 4.0s done
#33 pushing layer sha256:90fb1271f2dedbb2c22ed4ad3594fe7bfc435afb7f042c2ed8e4d0a056ad9997 4.2s done
#33 pushing layers for registry.fly.io/evershop-fly:deployment-01K91MPCHFDEH60VMXH105DYAC@sha256:68aa635eb2a954ac60a32f9ab3d57e78f51b9ef57620907f1d6ea8657a22a64c 4.7s done
#33 pushing layer sha256:6bdc0d2115e37ad4d03f2a7dbdb6afcf57a7eab33bc359216a3249d6cf302e96 4.7s done
#33 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91MPCHFDEH60VMXH105DYAC@sha256:68aa635eb2a954ac60a32f9ab3d57e78f51b9ef57620907f1d6ea8657a22a64c
#33 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91MPCHFDEH60VMXH105DYAC@sha256:68aa635eb2a954ac60a32f9ab3d57e78f51b9ef57620907f1d6ea8657a22a64c 0.1s done
#33 DONE 17.1s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91MPCHFDEH60VMXH105DYAC
image size: 476 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.25kB 2.0s done
#1 DONE 2.0s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.8s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.5s done
#3 DONE 0.5s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [evershop-source 2/8] WORKDIR /opt/evershop
#5 CACHED

#6 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#6 CACHED

#7 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#7 CACHED

#8 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#8 DONE 0.2s

#9 [internal] load build context
#9 transferring context: 1.17MB 4.9s
#9 transferring context: 2.28MB 7.2s done
#9 ...

#10 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#10 7.197 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#10 7.435 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#10 32.81 
#10 32.81 > evershop@1.2.2 prepare
#10 32.81 > husky install
#10 32.81 
#10 32.88 husky - Git hooks installed
#10 32.90 
#10 32.90 added 1466 packages, and audited 1485 packages in 33s
#10 32.90 
#10 32.90 293 packages are looking for funding
#10 32.90   run `npm fund` for details
#10 32.91 
#10 32.91 9 vulnerabilities (6 low, 2 high, 1 critical)
#10 32.91 
#10 32.91 To address all issues, run:
#10 32.91   npm audit fix
#10 32.91 
#10 32.91 Run `npm audit` for details.
#10 32.91 npm notice
#10 32.91 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#10 32.91 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#10 32.91 npm notice To update run: npm install -g npm@11.6.2
#10 32.91 npm notice
#10 DONE 38.0s

#9 [internal] load build context
#9 ...

#11 [evershop-source 7/8] RUN npm run compile
#11 1.263 
#11 1.263 > evershop@1.2.2 compile
#11 1.263 > rimraf ./packages/evershop/dist && cd ./packages/evershop && swc ./src/ -d dist/ --config-file .swcrc --copy-files --strip-leading-paths
#11 1.263 
#11 1.953 Successfully compiled: 1267 files, copied 398 files with swc (511.31ms)
#11 DONE 2.1s

#9 [internal] load build context
#9 ...

#12 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#12 0.292 
#12 0.292 > @evershop/postgres-query-builder@2.0.0 compile
#12 0.292 > tsc
#12 0.292 
#12 DONE 2.1s

#9 [internal] load build context
#9 ...

#13 [stage-1  2/23] WORKDIR /app
#13 CACHED

#14 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#14 CACHED

#15 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#15 DONE 16.3s

#9 [internal] load build context
#9 ...

#16 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#16 8.529 npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
#16 12.22 
#16 12.22 added 211 packages, changed 1 package, and audited 1167 packages in 11s
#16 12.22 
#16 12.22 276 packages are looking for funding
#16 12.22   run `npm fund` for details
#16 12.23 
#16 12.23 9 vulnerabilities (3 low, 5 high, 1 critical)
#16 12.23 
#16 12.23 To address issues that do not require attention, run:
#16 12.23   npm audit fix
#16 12.23 
#16 12.23 To address all issues (including breaking changes), run:
#16 12.23   npm audit fix --force
#16 12.23 
#16 12.23 Run `npm audit` for details.
#16 12.23 npm notice
#16 12.23 npm notice New major version of npm available! 10.8.2 -> 11.6.2
#16 12.23 npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
#16 12.23 npm notice To update run: npm install -g npm@11.6.2
#16 12.23 npm notice
#16 DONE 13.1s

#9 [internal] load build context
#9 ...

#17 [stage-1  6/23] COPY config /app/config
#17 DONE 0.1s

#18 [stage-1  7/23] COPY patches /tmp/patches
#18 DONE 0.0s

#19 [stage-1  8/23] COPY scripts /app/scripts
#19 DONE 0.0s

#20 [stage-1  9/23] COPY extensions /app/extensions
#20 DONE 7.0s

#9 [internal] load build context
#9 ...

#21 [stage-1 10/23] COPY themes /app/themes-src
#21 DONE 0.2s

#9 [internal] load build context
#9 ...

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#22 1.340 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#22 21.49 
#22 21.49 added 1 package, removed 712 packages, changed 2 packages, and audited 1161 packages in 21s
#22 21.49 
#22 21.49 276 packages are looking for funding
#22 21.49   run `npm fund` for details
#22 21.50 
#22 21.50 6 vulnerabilities (1 low, 4 high, 1 critical)
#22 21.50 
#22 21.50 To address issues that do not require attention, run:
#22 21.50   npm audit fix
#22 21.50 
#22 21.50 To address all issues (including breaking changes), run:
#22 21.50   npm audit fix --force
#22 21.50 
#22 21.50 Run `npm audit` for details.
#22 DONE 21.7s

#9 [internal] load build context
#9 ...

#23 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#23 0.264 
#23 0.264 > @evershop/chatbot@1.0.0 build
#23 0.264 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 0.264 
#23 0.268 sh: 1: tsc: not found
#23 0.271 npm error Lifecycle script `build` failed with error:
#23 0.272 npm error code 127
#23 0.272 npm error path /app/extensions/chatbot
#23 0.272 npm error workspace @evershop/chatbot@1.0.0
#23 0.272 npm error location /app/extensions/chatbot
#23 0.272 npm error command failed
#23 0.272 npm error command sh -c tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 ERROR: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi" did not complete successfully: exit code: 127

#9 [internal] load build context
------
 > [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi:
0.264 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
0.264 
0.268 sh: 1: tsc: not found
0.271 npm error Lifecycle script `build` failed with error:
0.272 npm error code 127
0.272 npm error path /app/extensions/chatbot
0.272 npm error workspace @evershop/chatbot@1.0.0
0.272 npm error location /app/extensions/chatbot
0.272 npm error command failed
0.272 npm error command sh -c tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
------
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.25kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [stage-1  1/23] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 4.3s done
#5 DONE 4.3s

#6 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#6 CACHED

#7 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#7 CACHED

#8 [evershop-source 2/8] WORKDIR /opt/evershop
#8 CACHED

#9 [stage-1  8/23] COPY scripts /app/scripts
#9 CACHED

#10 [stage-1  9/23] COPY extensions /app/extensions
#10 CACHED

#11 [evershop-source 7/8] RUN npm run compile
#11 CACHED

#12 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#12 CACHED

#13 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#13 CACHED

#14 [stage-1  7/23] COPY patches /tmp/patches
#14 CACHED

#15 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#15 CACHED

#16 [stage-1 10/23] COPY themes /app/themes-src
#16 CACHED

#17 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#17 CACHED

#18 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#18 CACHED

#19 [stage-1  2/23] WORKDIR /app
#19 CACHED

#20 [stage-1  6/23] COPY config /app/config
#20 CACHED

#21 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#21 CACHED

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 npm install --legacy-peer-deps --ignore-scripts; fi
#22 CACHED

#23 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#23 0.266 
#23 0.266 > @evershop/chatbot@1.0.0 build
#23 0.266 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 0.266 
#23 0.271 sh: 1: tsc: not found
#23 0.274 npm error Lifecycle script `build` failed with error:
#23 0.274 npm error code 127
#23 0.274 npm error path /app/extensions/chatbot
#23 0.275 npm error workspace @evershop/chatbot@1.0.0
#23 0.275 npm error location /app/extensions/chatbot
#23 0.275 npm error command failed
#23 0.275 npm error command sh -c tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 ERROR: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi" did not complete successfully: exit code: 127
------
 > [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi:
0.266 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
0.266 
0.271 sh: 1: tsc: not found
0.274 npm error Lifecycle script `build` failed with error:
0.274 npm error code 127
0.274 npm error path /app/extensions/chatbot
0.275 npm error workspace @evershop/chatbot@1.0.0
0.275 npm error location /app/extensions/chatbot
0.275 npm error command failed
0.275 npm error command sh -c tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
------
Error: failed to fetch an image or build from source: error building: failed to solve: process "/bin/sh -c if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi" did not complete successfully: exit code: 127
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.30kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.2s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 3.4s done
#5 DONE 3.5s

#6 [evershop-source 2/8] WORKDIR /opt/evershop
#6 CACHED

#7 [stage-1  6/23] COPY config /app/config
#7 CACHED

#8 [stage-1  2/23] WORKDIR /app
#8 CACHED

#9 [stage-1  9/23] COPY extensions /app/extensions
#9 CACHED

#10 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#10 CACHED

#11 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#11 CACHED

#12 [evershop-source 7/8] RUN npm run compile
#12 CACHED

#13 [stage-1  8/23] COPY scripts /app/scripts
#13 CACHED

#14 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#14 CACHED

#15 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#15 CACHED

#16 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#16 CACHED

#17 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#17 CACHED

#18 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#18 CACHED

#19 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#19 CACHED

#20 [stage-1  7/23] COPY patches /tmp/patches
#20 CACHED

#21 [stage-1 10/23] COPY themes /app/themes-src
#21 CACHED

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#22 0.222 npm warn config production Use `--omit=dev` instead.
#22 1.316 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#22 20.38 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#22 20.40 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#22 20.91 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#22 21.00 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#22 23.94 
#22 23.94 added 325 packages, removed 712 packages, changed 2 packages, and audited 1487 packages in 24s
#22 23.94 
#22 23.94 323 packages are looking for funding
#22 23.94   run `npm fund` for details
#22 23.95 
#22 23.95 6 vulnerabilities (1 low, 4 high, 1 critical)
#22 23.95 
#22 23.95 To address issues that do not require attention, run:
#22 23.95   npm audit fix
#22 23.95 
#22 23.95 To address all issues (including breaking changes), run:
#22 23.95   npm audit fix --force
#22 23.95 
#22 23.95 Run `npm audit` for details.
#22 DONE 24.9s

#23 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#23 0.376 
#23 0.376 > @evershop/chatbot@1.0.0 build
#23 0.376 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 0.376 
#23 DONE 3.1s

#24 [stage-1 13/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#24 DONE 0.1s

#25 [stage-1 14/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#25 0.076 + [ -d /app/themes/redtheme ]
#25 0.077 + basename /app/themes/redtheme
#25 0.079 + name=redtheme
#25 0.079 + [ -f /app/themes/redtheme/package.json ]
#25 0.079 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#25 0.188 npm warn config production Use `--omit=dev` instead.
#25 1.296 
#25 1.296 added 5 packages, and audited 6 packages in 1s
#25 1.296 
#25 1.296 found 0 vulnerabilities
#25 1.318 + npm run build --prefix /app/themes/redtheme
#25 1.447 
#25 1.447 > redtheme@0.1.0 build
#25 1.447 > tsc --project tsconfig.json
#25 1.447 
#25 3.145 + [ -d /app/themes/redtheme/dist ]
#25 3.145 + mkdir -p /app/themes-src/redtheme
#25 3.147 + rm -rf /app/themes-src/redtheme/dist
#25 3.149 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#25 3.154 + [ -d /app/themes/venia ]
#25 3.154 + basename /app/themes/venia
#25 3.155 + name=venia
#25 3.155 + [ -f /app/themes/venia/package.json ]
#25 3.155 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#25 3.258 npm warn config production Use `--omit=dev` instead.
#25 4.129 
#25 4.129 added 5 packages, and audited 6 packages in 902ms
#25 4.130 
#25 4.130 found 0 vulnerabilities
#25 4.152 + npm run build --prefix /app/themes/venia
#25 4.280 
#25 4.280 > venia@0.1.0 build
#25 4.280 > tsc --project tsconfig.json
#25 4.280 
#25 6.045 + [ -d /app/themes/venia/dist ]
#25 6.045 + mkdir -p /app/themes-src/venia
#25 6.047 + rm -rf /app/themes-src/venia/dist
#25 6.048 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#25 DONE 6.2s

#26 [stage-1 15/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#26 DONE 0.0s

#27 [stage-1 16/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#27 DONE 0.0s

#28 [stage-1 17/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#28 DONE 0.0s

#29 [stage-1 18/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#29 0.072 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#29 0.072 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.072 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#29 0.072 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 0.072 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.072 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 DONE 0.1s

#30 [stage-1 19/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#30 DONE 0.0s

#31 [stage-1 20/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#31 DONE 0.1s

#32 [stage-1 21/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#32 DONE 0.1s

#33 [stage-1 22/23] RUN chmod +x /app/scripts/entrypoint.sh
#33 DONE 0.1s

#34 [stage-1 23/23] RUN npm run build
#34 0.237 
#34 0.237 > evershop@1.2.2 build
#34 0.237 > node ./packages/evershop/dist/bin/build/index.js
#34 0.237 
#34 2.405 â„¹ Compiling Client
#34 2.435 â„¹ Compiling Server
#34 41.04 Browserslist: browsers data (caniuse-lite) is 7 months old. Please run:
#34 41.04   npx update-browserslist-db@latest
#34 41.04   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#34 117.0 âœ” Client: Compiled successfully in 1.91m
#34 117.1 âœ” Server: Compiled successfully in 1.91m
#34 DONE 118.0s

#35 exporting to image
#35 exporting layers
#35 exporting layers 14.2s done
#35 exporting manifest sha256:5a8dda81f0e6ec8b3830d131c43494077a67a88e038520ba9d2663459db1e8fd done
#35 exporting config sha256:06e187d0b931a3cdf3c9d6ca1bbabd7b60d8b6ab4097f65c6d8765c3f66b4973 done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91NGMX4MCCNN1JPDMFP1PH8@sha256:5a8dda81f0e6ec8b3830d131c43494077a67a88e038520ba9d2663459db1e8fd
#35 pushing layer sha256:b2f79dabaf248736db7f4e24a349409db58b7bbb7211f7034eea6d517bb3b231
#35 pushing layer sha256:06e187d0b931a3cdf3c9d6ca1bbabd7b60d8b6ab4097f65c6d8765c3f66b4973
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#35 pushing layer sha256:4623bdb3a4dad92aee879cb1da7b567da65c54fcc45a69cc12dc4e30dc606a27
#35 pushing layer sha256:9952903f8a7370928351ffdd5905e0c418b86f39f6aa3b48efee53078baa1493
#35 pushing layer sha256:b8b35347143e43887a6fc2bfeb590f485ee34e137b678bfe981a68744a04cccd
#35 pushing layer sha256:9c58df790bd02e00436805bc5c5c7794fc9bad918258c24fe4cee4293e71011f
#35 pushing layer sha256:ba84b28bfe902c2ff8ad427bdd4f2edb75ab48f5e05d8738b840d3963987cae6
#35 pushing layer sha256:4327fb4b582fdc318c193b187b3c91f898fd34af28653d96836f1a4b0ee66259
#35 pushing layer sha256:759506c609dcbf61baf110e6ecd79579fc95c5e3f93d9fe592f1d75df19644a3
#35 pushing layer sha256:65a3fed2922a5f39501122c1a0ccdc987bd125868efcd8e61f207a3cd40f5f0d
#35 pushing layer sha256:704a3ba8cf02f27b39f6ab14b58e12db63848292e930b30be8f0f80f3bca0f30
#35 pushing layer sha256:08059970e43461d5c5ffcd2717d134cb5413157bf5b2015e4d14dba521861131
#35 pushing layer sha256:4ac716c59a56fed85776d793e4e4eaba8f5ea114221b80d81b68e06c28af7048
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#35 pushing layer sha256:c7a10da275bd72ab8053286d23fd3ac1f9c9534619f55cfef8b029ae06996e28
#35 pushing layer sha256:291248d619eaa54607821c2e10c87f5d6aeb456154f519473256be0b5d86339e
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 1.1s done
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 1.3s done
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.0s done
#35 pushing layer sha256:b2f79dabaf248736db7f4e24a349409db58b7bbb7211f7034eea6d517bb3b231 3.0s done
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 3.0s done
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 3.0s done
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 3.0s done
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 3.0s done
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 3.0s done
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 3.0s done
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 3.0s done
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 3.1s done
#35 pushing layer sha256:06e187d0b931a3cdf3c9d6ca1bbabd7b60d8b6ab4097f65c6d8765c3f66b4973 3.2s done
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 3.2s done
#35 pushing layer sha256:4623bdb3a4dad92aee879cb1da7b567da65c54fcc45a69cc12dc4e30dc606a27 3.1s done
#35 pushing layer sha256:b8b35347143e43887a6fc2bfeb590f485ee34e137b678bfe981a68744a04cccd 3.2s done
#35 pushing layer sha256:ba84b28bfe902c2ff8ad427bdd4f2edb75ab48f5e05d8738b840d3963987cae6 3.2s done
#35 pushing layer sha256:4327fb4b582fdc318c193b187b3c91f898fd34af28653d96836f1a4b0ee66259 3.2s done
#35 pushing layer sha256:65a3fed2922a5f39501122c1a0ccdc987bd125868efcd8e61f207a3cd40f5f0d 3.3s done
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.2s done
#35 pushing layer sha256:704a3ba8cf02f27b39f6ab14b58e12db63848292e930b30be8f0f80f3bca0f30 3.4s done
#35 pushing layer sha256:759506c609dcbf61baf110e6ecd79579fc95c5e3f93d9fe592f1d75df19644a3 3.6s done
#35 pushing layer sha256:08059970e43461d5c5ffcd2717d134cb5413157bf5b2015e4d14dba521861131 3.4s done
#35 pushing layer sha256:4ac716c59a56fed85776d793e4e4eaba8f5ea114221b80d81b68e06c28af7048 3.4s done
#35 pushing layer sha256:c7a10da275bd72ab8053286d23fd3ac1f9c9534619f55cfef8b029ae06996e28 3.5s done
#35 pushing layer sha256:291248d619eaa54607821c2e10c87f5d6aeb456154f519473256be0b5d86339e 3.4s done
#35 pushing layer sha256:9952903f8a7370928351ffdd5905e0c418b86f39f6aa3b48efee53078baa1493 4.1s done
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 4.3s done
#35 pushing layer sha256:9c58df790bd02e00436805bc5c5c7794fc9bad918258c24fe4cee4293e71011f 4.4s done
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 4.9s done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91NGMX4MCCNN1JPDMFP1PH8@sha256:5a8dda81f0e6ec8b3830d131c43494077a67a88e038520ba9d2663459db1e8fd 4.9s done
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91NGMX4MCCNN1JPDMFP1PH8@sha256:5a8dda81f0e6ec8b3830d131c43494077a67a88e038520ba9d2663459db1e8fd 0.1s done
#35 DONE 19.5s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91NGMX4MCCNN1JPDMFP1PH8
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 DONE 0.0s

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.30kB 0.7s done
#1 DONE 0.7s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.7s done
#3 DONE 0.7s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 3.6s done
#5 DONE 3.6s

#6 [stage-1  6/23] COPY config /app/config
#6 CACHED

#7 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#7 CACHED

#8 [stage-1  2/23] WORKDIR /app
#8 CACHED

#9 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#9 CACHED

#10 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#10 CACHED

#11 [evershop-source 2/8] WORKDIR /opt/evershop
#11 CACHED

#12 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#12 CACHED

#13 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#13 CACHED

#14 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#14 CACHED

#15 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#15 CACHED

#16 [evershop-source 7/8] RUN npm run compile
#16 CACHED

#17 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#17 CACHED

#18 [stage-1  7/23] COPY patches /tmp/patches
#18 CACHED

#19 [stage-1  8/23] COPY scripts /app/scripts
#19 DONE 0.0s

#20 [stage-1  9/23] COPY extensions /app/extensions
#20 DONE 4.3s

#21 [stage-1 10/23] COPY themes /app/themes-src
#21 DONE 0.2s

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#22 0.238 npm warn config production Use `--omit=dev` instead.
#22 1.335 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#22 19.69 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#22 19.74 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#22 20.23 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#22 20.27 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#22 23.39 
#22 23.39 added 325 packages, removed 712 packages, changed 2 packages, and audited 1487 packages in 23s
#22 23.39 
#22 23.39 323 packages are looking for funding
#22 23.39   run `npm fund` for details
#22 23.40 
#22 23.40 6 vulnerabilities (1 low, 4 high, 1 critical)
#22 23.40 
#22 23.40 To address issues that do not require attention, run:
#22 23.40   npm audit fix
#22 23.40 
#22 23.40 To address all issues (including breaking changes), run:
#22 23.40   npm audit fix --force
#22 23.40 
#22 23.40 Run `npm audit` for details.
#22 DONE 24.6s

#23 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#23 0.393 
#23 0.393 > @evershop/chatbot@1.0.0 build
#23 0.393 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 0.393 
#23 DONE 3.1s

#24 [stage-1 13/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#24 DONE 0.1s

#25 [stage-1 14/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#25 0.093 + [ -d /app/themes/redtheme ]
#25 0.093 + basename /app/themes/redtheme
#25 0.095 + name=redtheme
#25 0.095 + [ -f /app/themes/redtheme/package.json ]
#25 0.095 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#25 0.213 npm warn config production Use `--omit=dev` instead.
#25 1.445 
#25 1.445 added 5 packages, and audited 6 packages in 1s
#25 1.446 
#25 1.446 found 0 vulnerabilities
#25 1.464 + npm run build --prefix /app/themes/redtheme
#25 1.594 
#25 1.594 > redtheme@0.1.0 build
#25 1.594 > tsc --project tsconfig.json
#25 1.594 
#25 3.292 + [ -d /app/themes/redtheme/dist ]
#25 3.292 + mkdir -p /app/themes-src/redtheme
#25 3.294 + rm -rf /app/themes-src/redtheme/dist
#25 3.295 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#25 3.300 + [ -d /app/themes/venia ]
#25 3.300 + basename /app/themes/venia
#25 3.301 + name=venia
#25 3.301 + [ -f /app/themes/venia/package.json ]
#25 3.301 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#25 3.403 npm warn config production Use `--omit=dev` instead.
#25 4.288 
#25 4.288 added 5 packages, and audited 6 packages in 918ms
#25 4.289 
#25 4.289 found 0 vulnerabilities
#25 4.310 + npm run build --prefix /app/themes/venia
#25 4.436 
#25 4.436 > venia@0.1.0 build
#25 4.436 > tsc --project tsconfig.json
#25 4.436 
#25 6.135 + [ -d /app/themes/venia/dist ]
#25 6.135 + mkdir -p /app/themes-src/venia
#25 6.136 + rm -rf /app/themes-src/venia/dist
#25 6.137 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#25 DONE 6.3s

#26 [stage-1 15/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#26 DONE 0.0s

#27 [stage-1 16/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#27 DONE 0.0s

#28 [stage-1 17/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#28 DONE 0.0s

#29 [stage-1 18/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#29 0.093 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#29 0.093 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.093 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#29 0.093 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 0.093 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.093 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 DONE 0.1s

#30 [stage-1 19/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#30 DONE 0.0s

#31 [stage-1 20/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#31 DONE 0.1s

#32 [stage-1 21/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#32 DONE 0.1s

#33 [stage-1 22/23] RUN chmod +x /app/scripts/entrypoint.sh
#33 DONE 0.1s

#34 [stage-1 23/23] RUN npm run build
#34 0.278 
#34 0.278 > evershop@1.2.2 build
#34 0.278 > node ./packages/evershop/dist/bin/build/index.js
#34 0.278 
#34 2.328 â„¹ Compiling Client
#34 2.355 â„¹ Compiling Server
#34 40.48 Browserslist: browsers data (caniuse-lite) is 7 months old. Please run:
#34 40.48   npx update-browserslist-db@latest
#34 40.48   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#34 115.8 âœ” Client: Compiled successfully in 1.89m
#34 115.9 âœ” Server: Compiled successfully in 1.89m
#34 DONE 116.7s

#35 exporting to image
#35 exporting layers
#35 exporting layers 4.1s done
#35 exporting manifest sha256:9b4bbc2fb8c4db3039fd0d5dbd246c9f80ca962b014cee053222dd386efa7ca1 done
#35 exporting config sha256:25d0b1c2abbeaf817d82bed310982cb5153a3a125dbdea62bc554f250aff6db6 done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91NW9A7QD3G818JFME8CZZX@sha256:9b4bbc2fb8c4db3039fd0d5dbd246c9f80ca962b014cee053222dd386efa7ca1
#35 pushing layer sha256:25d0b1c2abbeaf817d82bed310982cb5153a3a125dbdea62bc554f250aff6db6
#35 pushing layer sha256:26c8095554faf1a9e7aa4c07c39611c4add2156df30afc04f28719cbb48eeeec
#35 pushing layer sha256:177ccd3e9544cfe11c1c12de6bb40f97cdb2276073c40303dc4819e04f227889
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#35 pushing layer sha256:93ae8fbd3deb58edf543bf84965c07d0061a5a8a1edfc63b8ac026de79201f10
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#35 pushing layer sha256:090526eb622301b6ff820d3948d860e21160e6a3054e11d89cebbea7a27db41b
#35 pushing layer sha256:ce24463d7720ba8d3b24eaddc5268b2aa8c7fe607d39484eb33bb19abe3279dc
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#35 pushing layer sha256:d048f885376ad74855cde4c7da344c0d1bb64415f05e2fb469deab4ab794570e
#35 pushing layer sha256:31328a6c34d27a7cfb60700f8a2908724507834a93f3de14e494613ebe109eee
#35 pushing layer sha256:e1e7d8a3e08bb32fb7ddb570eaf3cd4a4990b38d09f3cd2bf21ba52ea348c4e4
#35 pushing layer sha256:2e5e7f363698db22900eb03d47d5399cbe8ae9250dcccd338cadff1e54f18087
#35 pushing layer sha256:f01538352702417c970f00a36e3b428ab7e635d7ab42f44632eac22795a7bd69
#35 pushing layer sha256:e13e791e8fe6d30199994ed820c7f2da2d17d1f2981dff2de5d14a2ba291f407
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#35 pushing layer sha256:3a425dacd7c95c0cf311655a2042c573c2a2d6d61b08f7febee6bf974aa1ba05
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#35 pushing layer sha256:f80e2465bd32906f3b4426cdb0266f315b373087d2e3cf38193d551dd61c2341
#35 pushing layer sha256:778c0c4db9bdf59b8ea5b9e70a43cedab67d5a8194592ef70c0a6d2f7204da14
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 2.3s done
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 2.3s done
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 2.3s done
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 2.3s done
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 2.3s done
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 2.3s done
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 2.3s done
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 2.3s done
#35 pushing layer sha256:090526eb622301b6ff820d3948d860e21160e6a3054e11d89cebbea7a27db41b 2.3s done
#35 pushing layer sha256:ce24463d7720ba8d3b24eaddc5268b2aa8c7fe607d39484eb33bb19abe3279dc 2.4s done
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 2.3s done
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 2.3s done
#35 pushing layer sha256:f01538352702417c970f00a36e3b428ab7e635d7ab42f44632eac22795a7bd69 2.4s done
#35 pushing layer sha256:e13e791e8fe6d30199994ed820c7f2da2d17d1f2981dff2de5d14a2ba291f407 2.4s done
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 2.3s done
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 2.3s done
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 2.3s done
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 2.3s done
#35 pushing layer sha256:f80e2465bd32906f3b4426cdb0266f315b373087d2e3cf38193d551dd61c2341 2.4s done
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 2.5s done
#35 pushing layer sha256:25d0b1c2abbeaf817d82bed310982cb5153a3a125dbdea62bc554f250aff6db6 2.5s done
#35 pushing layer sha256:26c8095554faf1a9e7aa4c07c39611c4add2156df30afc04f28719cbb48eeeec 2.6s done
#35 pushing layer sha256:177ccd3e9544cfe11c1c12de6bb40f97cdb2276073c40303dc4819e04f227889 2.5s done
#35 pushing layer sha256:d048f885376ad74855cde4c7da344c0d1bb64415f05e2fb469deab4ab794570e 2.5s done
#35 pushing layer sha256:31328a6c34d27a7cfb60700f8a2908724507834a93f3de14e494613ebe109eee 2.5s done
#35 pushing layer sha256:2e5e7f363698db22900eb03d47d5399cbe8ae9250dcccd338cadff1e54f18087 2.5s done
#35 pushing layer sha256:3a425dacd7c95c0cf311655a2042c573c2a2d6d61b08f7febee6bf974aa1ba05 2.6s done
#35 pushing layer sha256:93ae8fbd3deb58edf543bf84965c07d0061a5a8a1edfc63b8ac026de79201f10 2.8s done
#35 pushing layer sha256:778c0c4db9bdf59b8ea5b9e70a43cedab67d5a8194592ef70c0a6d2f7204da14 3.1s done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91NW9A7QD3G818JFME8CZZX@sha256:9b4bbc2fb8c4db3039fd0d5dbd246c9f80ca962b014cee053222dd386efa7ca1 3.2s done
#35 pushing layer sha256:e1e7d8a3e08bb32fb7ddb570eaf3cd4a4990b38d09f3cd2bf21ba52ea348c4e4 3.2s done
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91NW9A7QD3G818JFME8CZZX@sha256:9b4bbc2fb8c4db3039fd0d5dbd246c9f80ca962b014cee053222dd386efa7ca1
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91NW9A7QD3G818JFME8CZZX@sha256:9b4bbc2fb8c4db3039fd0d5dbd246c9f80ca962b014cee053222dd386efa7ca1 0.1s done
#35 DONE 7.5s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91NW9A7QD3G818JFME8CZZX
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.30kB 0.6s done
#1 DONE 0.6s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 3.0s done
#5 DONE 3.0s

#6 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#6 CACHED

#7 [stage-1 14/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#7 CACHED

#8 [stage-1  8/23] COPY scripts /app/scripts
#8 CACHED

#9 [stage-1  7/23] COPY patches /tmp/patches
#9 CACHED

#10 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#10 CACHED

#11 [stage-1 10/23] COPY themes /app/themes-src
#11 CACHED

#12 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#12 CACHED

#13 [stage-1 15/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#13 CACHED

#14 [stage-1 19/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#14 CACHED

#15 [stage-1  6/23] COPY config /app/config
#15 CACHED

#16 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#16 CACHED

#17 [stage-1 22/23] RUN chmod +x /app/scripts/entrypoint.sh
#17 CACHED

#18 [stage-1  2/23] WORKDIR /app
#18 CACHED

#19 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#19 CACHED

#20 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#20 CACHED

#21 [evershop-source 7/8] RUN npm run compile
#21 CACHED

#22 [stage-1 16/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#22 CACHED

#23 [stage-1  9/23] COPY extensions /app/extensions
#23 CACHED

#24 [stage-1 17/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#24 CACHED

#25 [stage-1 18/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#25 CACHED

#26 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#26 CACHED

#27 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#27 CACHED

#28 [stage-1 13/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#28 CACHED

#29 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#29 CACHED

#30 [stage-1 20/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#30 CACHED

#31 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#31 CACHED

#32 [stage-1 21/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#32 CACHED

#33 [evershop-source 2/8] WORKDIR /opt/evershop
#33 CACHED

#34 [stage-1 23/23] RUN npm run build
#34 CACHED

#35 exporting to image
#35 exporting layers 0.0s done
#35 exporting manifest sha256:11f22f1c710789ca413b806eeb65ed4610398a52dd2e15fd59a5adac4afb9e21 done
#35 exporting config sha256:51db1e10c17fb58e39e2bd674541c91f173e2c859476960292c00429292bfa4a done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91P6SQ175GVN3DTW75JJP76@sha256:11f22f1c710789ca413b806eeb65ed4610398a52dd2e15fd59a5adac4afb9e21
#35 pushing layer sha256:51db1e10c17fb58e39e2bd674541c91f173e2c859476960292c00429292bfa4a
#35 pushing layer sha256:26c8095554faf1a9e7aa4c07c39611c4add2156df30afc04f28719cbb48eeeec
#35 pushing layer sha256:e1e7d8a3e08bb32fb7ddb570eaf3cd4a4990b38d09f3cd2bf21ba52ea348c4e4
#35 pushing layer sha256:090526eb622301b6ff820d3948d860e21160e6a3054e11d89cebbea7a27db41b
#35 pushing layer sha256:e13e791e8fe6d30199994ed820c7f2da2d17d1f2981dff2de5d14a2ba291f407
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#35 pushing layer sha256:f80e2465bd32906f3b4426cdb0266f315b373087d2e3cf38193d551dd61c2341
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#35 pushing layer sha256:f01538352702417c970f00a36e3b428ab7e635d7ab42f44632eac22795a7bd69
#35 pushing layer sha256:d048f885376ad74855cde4c7da344c0d1bb64415f05e2fb469deab4ab794570e
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#35 pushing layer sha256:778c0c4db9bdf59b8ea5b9e70a43cedab67d5a8194592ef70c0a6d2f7204da14
#35 pushing layer sha256:3a425dacd7c95c0cf311655a2042c573c2a2d6d61b08f7febee6bf974aa1ba05
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#35 pushing layer sha256:31328a6c34d27a7cfb60700f8a2908724507834a93f3de14e494613ebe109eee
#35 pushing layer sha256:ce24463d7720ba8d3b24eaddc5268b2aa8c7fe607d39484eb33bb19abe3279dc
#35 pushing layer sha256:2e5e7f363698db22900eb03d47d5399cbe8ae9250dcccd338cadff1e54f18087
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#35 pushing layer sha256:177ccd3e9544cfe11c1c12de6bb40f97cdb2276073c40303dc4819e04f227889
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#35 pushing layer sha256:93ae8fbd3deb58edf543bf84965c07d0061a5a8a1edfc63b8ac026de79201f10
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 0.5s done
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 0.6s done
#35 pushing layer sha256:26c8095554faf1a9e7aa4c07c39611c4add2156df30afc04f28719cbb48eeeec 0.8s done
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 1.0s done
#35 pushing layer sha256:d048f885376ad74855cde4c7da344c0d1bb64415f05e2fb469deab4ab794570e 3.2s done
#35 pushing layer sha256:e1e7d8a3e08bb32fb7ddb570eaf3cd4a4990b38d09f3cd2bf21ba52ea348c4e4 3.2s done
#35 pushing layer sha256:090526eb622301b6ff820d3948d860e21160e6a3054e11d89cebbea7a27db41b 3.2s done
#35 pushing layer sha256:e13e791e8fe6d30199994ed820c7f2da2d17d1f2981dff2de5d14a2ba291f407 3.2s done
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 3.2s done
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 3.2s done
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 3.2s done
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 3.2s done
#35 pushing layer sha256:f80e2465bd32906f3b4426cdb0266f315b373087d2e3cf38193d551dd61c2341 3.2s done
#35 pushing layer sha256:f01538352702417c970f00a36e3b428ab7e635d7ab42f44632eac22795a7bd69 3.2s done
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 3.2s done
#35 pushing layer sha256:778c0c4db9bdf59b8ea5b9e70a43cedab67d5a8194592ef70c0a6d2f7204da14 3.2s done
#35 pushing layer sha256:3a425dacd7c95c0cf311655a2042c573c2a2d6d61b08f7febee6bf974aa1ba05 3.2s done
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 3.2s done
#35 pushing layer sha256:31328a6c34d27a7cfb60700f8a2908724507834a93f3de14e494613ebe109eee 3.2s done
#35 pushing layer sha256:ce24463d7720ba8d3b24eaddc5268b2aa8c7fe607d39484eb33bb19abe3279dc 3.2s done
#35 pushing layer sha256:2e5e7f363698db22900eb03d47d5399cbe8ae9250dcccd338cadff1e54f18087 3.2s done
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 3.2s done
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.2s done
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 3.2s done
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 3.2s done
#35 pushing layer sha256:177ccd3e9544cfe11c1c12de6bb40f97cdb2276073c40303dc4819e04f227889 3.2s done
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 3.2s done
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 3.2s done
#35 pushing layer sha256:93ae8fbd3deb58edf543bf84965c07d0061a5a8a1edfc63b8ac026de79201f10 3.2s done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91P6SQ175GVN3DTW75JJP76@sha256:11f22f1c710789ca413b806eeb65ed4610398a52dd2e15fd59a5adac4afb9e21 3.3s done
#35 pushing layer sha256:51db1e10c17fb58e39e2bd674541c91f173e2c859476960292c00429292bfa4a 3.3s done
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91P6SQ175GVN3DTW75JJP76@sha256:11f22f1c710789ca413b806eeb65ed4610398a52dd2e15fd59a5adac4afb9e21
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91P6SQ175GVN3DTW75JJP76@sha256:11f22f1c710789ca413b806eeb65ed4610398a52dd2e15fd59a5adac4afb9e21 0.1s done
#35 DONE 3.5s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91P6SQ175GVN3DTW75JJP76
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
> Waiting for machine 1859727f4d5d58 to reach a good state
> Machine 1859727f4d5d58 reached stopped state
> Running smoke checks on machine 1859727f4d5d58
> Running machine checks on machine 1859727f4d5d58
> Checking health of machine 1859727f4d5d58
âœ– Unrecoverable error: timeout reached waiting for health checks to pass for machine 1859727f4d5d58: failed to get VM 1859727f4d5d58: Get "https://api.machines.dev/v1/apps/evershop-fly/machines/1859727f4d5d58": net/http: request canceled
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Error: failed to update machine 1859727f4d5d58: Unrecoverable error: timeout reached waiting for health checks to pass for machine 1859727f4d5d58: failed to get VM 1859727f4d5d58: Get "https://api.machines.dev/v1/apps/evershop-fly/machines/1859727f4d5d58": net/http: request canceled
==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.30kB 1.2s done
#1 DONE 1.2s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.6s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.4s done
#3 DONE 0.4s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 4.0s done
#5 DONE 4.1s

#6 [stage-1  2/23] WORKDIR /app
#6 CACHED

#7 [stage-1  5/23] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#7 CACHED

#8 [stage-1  3/23] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#8 CACHED

#9 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#9 CACHED

#10 [evershop-source 7/8] RUN npm run compile
#10 CACHED

#11 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#11 CACHED

#12 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#12 CACHED

#13 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#13 CACHED

#14 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#14 CACHED

#15 [stage-1  6/23] COPY config /app/config
#15 CACHED

#16 [stage-1  4/23] COPY --from=evershop-source /opt/evershop /app
#16 CACHED

#17 [evershop-source 2/8] WORKDIR /opt/evershop
#17 CACHED

#18 [stage-1  7/23] COPY patches /tmp/patches
#18 CACHED

#19 [stage-1  8/23] COPY scripts /app/scripts
#19 DONE 0.0s

#20 [stage-1  9/23] COPY extensions /app/extensions
#20 DONE 6.9s

#21 [stage-1 10/23] COPY themes /app/themes-src
#21 DONE 0.2s

#22 [stage-1 11/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#22 0.803 npm warn config production Use `--omit=dev` instead.
#22 2.226 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#22 21.80 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#22 21.91 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#22 22.31 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#22 22.46 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#22 25.39 
#22 25.39 added 325 packages, removed 712 packages, changed 2 packages, and audited 1487 packages in 25s
#22 25.39 
#22 25.39 323 packages are looking for funding
#22 25.39   run `npm fund` for details
#22 25.40 
#22 25.40 6 vulnerabilities (1 low, 4 high, 1 critical)
#22 25.40 
#22 25.40 To address issues that do not require attention, run:
#22 25.40   npm audit fix
#22 25.40 
#22 25.40 To address all issues (including breaking changes), run:
#22 25.40   npm audit fix --force
#22 25.40 
#22 25.40 Run `npm audit` for details.
#22 DONE 26.6s

#23 [stage-1 12/23] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#23 0.386 
#23 0.386 > @evershop/chatbot@1.0.0 build
#23 0.386 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#23 0.386 
#23 DONE 3.1s

#24 [stage-1 13/23] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#24 DONE 0.1s

#25 [stage-1 14/23] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#25 0.085 + [ -d /app/themes/redtheme ]
#25 0.085 + basename /app/themes/redtheme
#25 0.087 + name=redtheme
#25 0.087 + [ -f /app/themes/redtheme/package.json ]
#25 0.087 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#25 0.186 npm warn config production Use `--omit=dev` instead.
#25 1.341 
#25 1.341 added 5 packages, and audited 6 packages in 1s
#25 1.341 
#25 1.341 found 0 vulnerabilities
#25 1.363 + npm run build --prefix /app/themes/redtheme
#25 1.498 
#25 1.498 > redtheme@0.1.0 build
#25 1.498 > tsc --project tsconfig.json
#25 1.498 
#25 3.252 + [ -d /app/themes/redtheme/dist ]
#25 3.252 + mkdir -p /app/themes-src/redtheme
#25 3.254 + rm -rf /app/themes-src/redtheme/dist
#25 3.256 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#25 3.260 + [ -d /app/themes/venia ]
#25 3.261 + basename /app/themes/venia
#25 3.262 + name=venia
#25 3.262 + [ -f /app/themes/venia/package.json ]
#25 3.262 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#25 3.362 npm warn config production Use `--omit=dev` instead.
#25 4.250 
#25 4.250 added 5 packages, and audited 6 packages in 919ms
#25 4.251 
#25 4.251 found 0 vulnerabilities
#25 4.275 + npm run build --prefix /app/themes/venia
#25 4.404 
#25 4.404 > venia@0.1.0 build
#25 4.404 > tsc --project tsconfig.json
#25 4.404 
#25 6.111 + [ -d /app/themes/venia/dist ]
#25 6.111 + mkdir -p /app/themes-src/venia
#25 6.113 + rm -rf /app/themes-src/venia/dist
#25 6.114 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#25 DONE 6.3s

#26 [stage-1 15/23] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#26 DONE 0.0s

#27 [stage-1 16/23] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#27 DONE 0.0s

#28 [stage-1 17/23] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#28 DONE 0.0s

#29 [stage-1 18/23] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#29 0.079 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#29 0.079 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.079 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#29 0.079 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 0.079 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#29 0.079 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#29 DONE 0.1s

#30 [stage-1 19/23] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#30 DONE 0.0s

#31 [stage-1 20/23] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#31 DONE 0.1s

#32 [stage-1 21/23] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#32 DONE 0.1s

#33 [stage-1 22/23] RUN chmod +x /app/scripts/entrypoint.sh
#33 DONE 0.1s

#34 [stage-1 23/23] RUN npm run build
#34 0.225 
#34 0.225 > evershop@1.2.2 build
#34 0.225 > node ./packages/evershop/dist/bin/build/index.js
#34 0.225 
#34 3.040 â„¹ Compiling Client
#34 3.071 â„¹ Compiling Server
#34 41.35 Browserslist: browsers data (caniuse-lite) is 7 months old. Please run:
#34 41.35   npx update-browserslist-db@latest
#34 41.35   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#34 117.7 âœ” Client: Compiled successfully in 1.91m
#34 117.8 âœ” Server: Compiled successfully in 1.91m
#34 DONE 118.7s

#35 exporting to image
#35 exporting layers
#35 exporting layers 3.9s done
#35 exporting manifest sha256:3dc51e204d3acebc182e18c44444822aba473e947353af3f41923678ea768c4c done
#35 exporting config sha256:9a249f4c9a466da611979a4f0ac77879cde38deef07721be6d639454bc2ab6a1
#35 exporting config sha256:9a249f4c9a466da611979a4f0ac77879cde38deef07721be6d639454bc2ab6a1 done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91PMNCNP1FTQGTW5TFA2C8Y@sha256:3dc51e204d3acebc182e18c44444822aba473e947353af3f41923678ea768c4c
#35 pushing layer sha256:9a249f4c9a466da611979a4f0ac77879cde38deef07721be6d639454bc2ab6a1
#35 pushing layer sha256:99a20cd969c67a7952c20adb3ab7026b46c0c4a31c4ce168fe1562b849664ee7
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#35 pushing layer sha256:145ae4dd9d2e4568dcaa2e78dcfc4a1d1b9764e21bd238babd447b7b80d83aee
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#35 pushing layer sha256:0e8f7759426e56f74394c9b2105a012f05aa28d65851e368c9a2df92b9b02c22
#35 pushing layer sha256:27bfd112670411c111765fe323845c7b1e55edf7b43552274a1d70aeeb675697
#35 pushing layer sha256:dec62b4b8ec38eb2716f44cadd27603ddcb5d0906142879fdb06b00ac6354a5c
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#35 pushing layer sha256:4822fece0f925953bb7f993ce547683bcd3872c85ed52045ca860eaeb6ab0406
#35 pushing layer sha256:345f91b150a502f96e5438ca63125f25b6455092ef7ba491900354126713e222
#35 pushing layer sha256:1c06c141c4e4da6e61f0f3cdf65745ef9eb627a21b32f27d492f6a9d48685b0c
#35 pushing layer sha256:4ba99cbfaee93f24c2d3eafe8609d6d8b3ebce6f151da9341d866ce5a159e52c
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#35 pushing layer sha256:4f2b23b6488fba27cf4a2a9b5c21ec1b7a07509dacdee485e01ebe897c169d8e
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#35 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#35 pushing layer sha256:aa420443c2f727ef20d540f82b8fb7070bc5994fcc841a5b0616c5a8bea0f016
#35 pushing layer sha256:47c55bf2e5ef0fdde0009f7765f722e609d76876f21cef01d88132c463e0fab8
#35 pushing layer sha256:24b5f9a1202d14b9c17d9386fa9f511969a1ebaf70cf9ce24631c0da415ad7cf
#35 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 1.0s done
#35 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 2.4s done
#35 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 3.2s done
#35 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 3.2s done
#35 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 3.2s done
#35 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.2s done
#35 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 3.2s done
#35 pushing layer sha256:9a249f4c9a466da611979a4f0ac77879cde38deef07721be6d639454bc2ab6a1 3.4s done
#35 pushing layer sha256:99a20cd969c67a7952c20adb3ab7026b46c0c4a31c4ce168fe1562b849664ee7 3.4s done
#35 pushing layer sha256:27bfd112670411c111765fe323845c7b1e55edf7b43552274a1d70aeeb675697 3.2s done
#35 pushing layer sha256:dec62b4b8ec38eb2716f44cadd27603ddcb5d0906142879fdb06b00ac6354a5c 3.4s done
#35 pushing layer sha256:4822fece0f925953bb7f993ce547683bcd3872c85ed52045ca860eaeb6ab0406 3.4s done
#35 pushing layer sha256:345f91b150a502f96e5438ca63125f25b6455092ef7ba491900354126713e222 3.4s done
#35 pushing layer sha256:4ba99cbfaee93f24c2d3eafe8609d6d8b3ebce6f151da9341d866ce5a159e52c 3.2s done
#35 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 3.2s done
#35 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 3.2s done
#35 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 3.2s done
#35 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 3.2s done
#35 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832 3.4s done
#35 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 3.2s done
#35 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.2s done
#35 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 3.2s done
#35 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 3.2s done
#35 pushing layer sha256:0e8f7759426e56f74394c9b2105a012f05aa28d65851e368c9a2df92b9b02c22 3.6s done
#35 pushing layer sha256:4f2b23b6488fba27cf4a2a9b5c21ec1b7a07509dacdee485e01ebe897c169d8e 3.4s done
#35 pushing layer sha256:aa420443c2f727ef20d540f82b8fb7070bc5994fcc841a5b0616c5a8bea0f016 3.4s done
#35 pushing layer sha256:47c55bf2e5ef0fdde0009f7765f722e609d76876f21cef01d88132c463e0fab8 3.4s done
#35 pushing layer sha256:24b5f9a1202d14b9c17d9386fa9f511969a1ebaf70cf9ce24631c0da415ad7cf 3.4s done
#35 pushing layer sha256:1c06c141c4e4da6e61f0f3cdf65745ef9eb627a21b32f27d492f6a9d48685b0c 3.9s done
#35 pushing layers for registry.fly.io/evershop-fly:deployment-01K91PMNCNP1FTQGTW5TFA2C8Y@sha256:3dc51e204d3acebc182e18c44444822aba473e947353af3f41923678ea768c4c 4.0s done
#35 pushing layer sha256:145ae4dd9d2e4568dcaa2e78dcfc4a1d1b9764e21bd238babd447b7b80d83aee 4.0s done
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91PMNCNP1FTQGTW5TFA2C8Y@sha256:3dc51e204d3acebc182e18c44444822aba473e947353af3f41923678ea768c4c
#35 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91PMNCNP1FTQGTW5TFA2C8Y@sha256:3dc51e204d3acebc182e18c44444822aba473e947353af3f41923678ea768c4c 0.1s done
#35 DONE 8.0s
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91PMNCNP1FTQGTW5TFA2C8Y
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.37kB 1.5s done
#1 DONE 1.5s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.3s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.7s done
#3 DONE 0.7s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.14MB 5.1s
#5 transferring context: 2.28MB 7.0s done
#5 ...

#6 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#6 CACHED

#7 [evershop-source 2/8] WORKDIR /opt/evershop
#7 CACHED

#8 [stage-1  3/24] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#8 CACHED

#9 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#9 CACHED

#10 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#10 CACHED

#11 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#11 CACHED

#12 [stage-1  2/24] WORKDIR /app
#12 CACHED

#13 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#13 CACHED

#14 [stage-1  7/24] COPY patches /tmp/patches
#14 CACHED

#15 [evershop-source 7/8] RUN npm run compile
#15 CACHED

#16 [stage-1  6/24] COPY config /app/config
#16 CACHED

#17 [stage-1  5/24] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#17 CACHED

#18 [stage-1  4/24] COPY --from=evershop-source /opt/evershop /app
#18 CACHED

#19 [stage-1  8/24] COPY scripts /app/scripts
#19 CACHED

#20 [stage-1  9/24] RUN sed -i 's/set -euo pipefail/set -eu/' /app/scripts/entrypoint.sh
#20 DONE 0.1s

#5 [internal] load build context
#5 ...

#21 [stage-1 10/24] COPY extensions /app/extensions
#21 DONE 4.2s

#5 [internal] load build context
#5 ...

#22 [stage-1 11/24] COPY themes /app/themes-src
#22 DONE 0.2s

#5 [internal] load build context
#5 ...

#23 [stage-1 12/24] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#23 0.245 npm warn config production Use `--omit=dev` instead.
#23 1.284 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#23 20.62 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#23 20.63 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#23 21.23 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#23 21.38 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#23 24.32 
#23 24.32 added 325 packages, removed 712 packages, changed 2 packages, and audited 1487 packages in 24s
#23 24.32 
#23 24.32 323 packages are looking for funding
#23 24.32   run `npm fund` for details
#23 24.33 
#23 24.33 6 vulnerabilities (1 low, 4 high, 1 critical)
#23 24.33 
#23 24.33 To address issues that do not require attention, run:
#23 24.33   npm audit fix
#23 24.33 
#23 24.33 To address all issues (including breaking changes), run:
#23 24.33   npm audit fix --force
#23 24.33 
#23 24.33 Run `npm audit` for details.
#23 DONE 25.3s

#5 [internal] load build context
#5 ...

#24 [stage-1 13/24] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#24 0.369 
#24 0.369 > @evershop/chatbot@1.0.0 build
#24 0.369 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#24 0.369 
#24 DONE 3.1s

#5 [internal] load build context
#5 ...

#25 [stage-1 14/24] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#25 DONE 0.1s

#26 [stage-1 15/24] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#26 0.071 + [ -d /app/themes/redtheme ]
#26 0.071 + basename /app/themes/redtheme
#26 0.072 + name=redtheme
#26 0.072 + [ -f /app/themes/redtheme/package.json ]
#26 0.072 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#26 0.199 npm warn config production Use `--omit=dev` instead.
#26 1.289 
#26 1.289 added 5 packages, and audited 6 packages in 1s
#26 1.290 
#26 1.290 found 0 vulnerabilities
#26 1.313 + npm run build --prefix /app/themes/redtheme
#26 1.466 
#26 1.466 > redtheme@0.1.0 build
#26 1.466 > tsc --project tsconfig.json
#26 1.466 
#26 3.218 + [ -d /app/themes/redtheme/dist ]
#26 3.218 + mkdir -p /app/themes-src/redtheme
#26 3.220 + rm -rf /app/themes-src/redtheme/dist
#26 3.221 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#26 3.225 + [ -d /app/themes/venia ]
#26 3.225 + basename /app/themes/venia
#26 3.226 + name=venia
#26 3.226 + [ -f /app/themes/venia/package.json ]
#26 3.226 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#26 3.328 npm warn config production Use `--omit=dev` instead.
#26 4.191 
#26 4.191 added 5 packages, and audited 6 packages in 896ms
#26 4.192 
#26 4.192 found 0 vulnerabilities
#26 4.214 + npm run build --prefix /app/themes/venia
#26 4.344 
#26 4.344 > venia@0.1.0 build
#26 4.344 > tsc --project tsconfig.json
#26 4.344 
#26 6.077 + [ -d /app/themes/venia/dist ]
#26 6.077 + mkdir -p /app/themes-src/venia
#26 6.079 + rm -rf /app/themes-src/venia/dist
#26 6.079 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#26 DONE 6.2s

#5 [internal] load build context
#5 ...

#27 [stage-1 16/24] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#27 DONE 0.0s

#28 [stage-1 17/24] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#28 DONE 0.0s

#29 [stage-1 18/24] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#29 DONE 0.0s

#30 [stage-1 19/24] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#30 0.095 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#30 0.095 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#30 0.095 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#30 0.095 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#30 0.095 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#30 0.095 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#30 DONE 0.1s

#31 [stage-1 20/24] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#31 DONE 0.0s

#32 [stage-1 21/24] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#32 DONE 0.1s

#5 [internal] load build context
#5 ...

#33 [stage-1 22/24] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#33 DONE 0.1s

#34 [stage-1 23/24] RUN chmod +x /app/scripts/entrypoint.sh
#34 DONE 0.1s

#35 [stage-1 24/24] RUN npm run build
#35 0.250 
#35 0.250 > evershop@1.2.2 build
#35 0.250 > node ./packages/evershop/dist/bin/build/index.js
#35 0.250 
#35 2.345 â„¹ Compiling Client
#35 2.378 â„¹ Compiling Server
#35 40.60 Browserslist: browsers data (caniuse-lite) is 7 months old. Please run:
#35 40.60   npx update-browserslist-db@latest
#35 40.60   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#35 116.5 âœ” Client: Compiled successfully in 1.90m
#35 116.6 âœ” Server: Compiled successfully in 1.90m
#35 DONE 117.4s

#5 [internal] load build context
#5 ...

#36 exporting to image
#36 exporting layers
#36 exporting layers 4.0s done
#36 exporting manifest sha256:7db1923c4326bcfdf8ff662a97bb4748013ec3fde35e4be3a2da08b565674107 done
#36 exporting config sha256:9069f525f0e94ee83bb04b4c0accc371bd2ad9d69eb02ce81573733ae94f8fbc done
#36 pushing layers for registry.fly.io/evershop-fly:deployment-01K91Q08YT981GAX42WT4C7ZN7@sha256:7db1923c4326bcfdf8ff662a97bb4748013ec3fde35e4be3a2da08b565674107
#36 pushing layer sha256:8952f08c2eece580e5a87e1c01c13b3426a25756b19289713809ae6e9733b029
#36 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#36 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#36 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#36 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#36 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832
#36 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#36 pushing layer sha256:cb4dbddf69351e7b732a4153bf04e700395184a977003c549637b471439e6b5d
#36 pushing layer sha256:9069f525f0e94ee83bb04b4c0accc371bd2ad9d69eb02ce81573733ae94f8fbc
#36 pushing layer sha256:0466984f24f0e0f9bbcf08517734f0fca28c4223ddf371be02282be681e981d0
#36 pushing layer sha256:373724865ef4247eca1ff77ae525b2fa9faae1536553b0184715bd9b357fa4c6
#36 pushing layer sha256:e060162795ca1544567bdeb9bb9b4854ad251bb84d3fbbc4f14b5c410d0b35d0
#36 pushing layer sha256:0da55a0c33e0aa8f964512bf6e4971b816135c22fd3b5bc3eac79c417e5c9f95
#36 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#36 pushing layer sha256:4199f9f2517e2b3c6b5087d4fd0a4effbe63776bb439a445f10ca1bc1a5f10e4
#36 pushing layer sha256:236a783bc0a9a1663e6e0e2330b31e20429de277b3d0bfc2951a63c058d433cf
#36 pushing layer sha256:3e46576ac19e7b5b471b4bd69dd18a690d7fb0adefde24bb5f1b5525f87cb30e
#36 pushing layer sha256:105f49863516b8ed8c610b5221b5ccd33e2e5ccdfde1b0fd7ce3aee7b1f01d94
#36 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#36 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#36 pushing layer sha256:a84b6760c30e865e673c9ebdfefec412b31d232a1dee741829ee8449bc713499
#36 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#36 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#36 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#36 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#36 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#36 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#36 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#36 pushing layer sha256:7445ab6c00f1c088b45ff9e98662e04f38d54bc3eb7c4ecb0124520fb2736199
#36 pushing layer sha256:757efeb8d0c88814b434fa26d1d76f425a6ed0b882b3fa7d57f6b02cbc4cb5f3
#36 pushing layer sha256:e5c0b29cc8565d3fd81d32b696211c65dd4a806a794cc84096801534369479b0
#36 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 0.6s done
#36 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 1.0s done
#36 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 1.7s done
#36 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832 2.0s done
#36 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 2.2s done
#36 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 4.2s done
#36 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 4.2s done
#36 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 4.2s done
#36 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 4.2s done
#36 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 4.2s done
#36 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 4.2s done
#36 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 4.2s done
#36 pushing layer sha256:8952f08c2eece580e5a87e1c01c13b3426a25756b19289713809ae6e9733b029 4.3s done
#36 pushing layer sha256:cb4dbddf69351e7b732a4153bf04e700395184a977003c549637b471439e6b5d 4.3s done
#36 pushing layer sha256:9069f525f0e94ee83bb04b4c0accc371bd2ad9d69eb02ce81573733ae94f8fbc 4.4s done
#36 pushing layer sha256:0466984f24f0e0f9bbcf08517734f0fca28c4223ddf371be02282be681e981d0 4.3s done
#36 pushing layer sha256:373724865ef4247eca1ff77ae525b2fa9faae1536553b0184715bd9b357fa4c6 4.4s done
#36 pushing layer sha256:0da55a0c33e0aa8f964512bf6e4971b816135c22fd3b5bc3eac79c417e5c9f95 4.4s done
#36 pushing layer sha256:4199f9f2517e2b3c6b5087d4fd0a4effbe63776bb439a445f10ca1bc1a5f10e4 4.4s done
#36 pushing layer sha256:236a783bc0a9a1663e6e0e2330b31e20429de277b3d0bfc2951a63c058d433cf 4.4s done
#36 pushing layer sha256:3e46576ac19e7b5b471b4bd69dd18a690d7fb0adefde24bb5f1b5525f87cb30e 4.7s done
#36 pushing layer sha256:a84b6760c30e865e673c9ebdfefec412b31d232a1dee741829ee8449bc713499 4.4s done
#36 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 4.2s done
#36 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 4.2s done
#36 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 4.2s done
#36 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 4.2s done
#36 pushing layer sha256:7445ab6c00f1c088b45ff9e98662e04f38d54bc3eb7c4ecb0124520fb2736199 4.4s done
#36 pushing layer sha256:757efeb8d0c88814b434fa26d1d76f425a6ed0b882b3fa7d57f6b02cbc4cb5f3 4.5s done
#36 pushing layer sha256:e5c0b29cc8565d3fd81d32b696211c65dd4a806a794cc84096801534369479b0 4.4s done
#36 pushing layer sha256:105f49863516b8ed8c610b5221b5ccd33e2e5ccdfde1b0fd7ce3aee7b1f01d94 4.9s done
#36 pushing layers for registry.fly.io/evershop-fly:deployment-01K91Q08YT981GAX42WT4C7ZN7@sha256:7db1923c4326bcfdf8ff662a97bb4748013ec3fde35e4be3a2da08b565674107 5.0s done
#36 pushing layer sha256:e060162795ca1544567bdeb9bb9b4854ad251bb84d3fbbc4f14b5c410d0b35d0 5.0s done
#36 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91Q08YT981GAX42WT4C7ZN7@sha256:7db1923c4326bcfdf8ff662a97bb4748013ec3fde35e4be3a2da08b565674107 0.1s done
#36 DONE 9.2s

#5 [internal] load build context
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91Q08YT981GAX42WT4C7ZN7
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

==> Verifying app config
Validating /Users/mac/Sync/project/ecommerce/evershop-fly/fly.toml
[32mâœ“[0m Configuration is valid
--> Verified app config
==> Building image
Waiting for depot builder...

==> Building image with Depot
--> build:  (â€‹)
#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile:
#1 transferring dockerfile: 4.76kB 0.8s done
#1 DONE 0.8s

#2 [internal] load metadata for docker.io/library/node:20-bullseye
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context:
#3 transferring context: 2B 0.7s done
#3 DONE 0.7s

#4 [evershop-source 1/8] FROM docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7
#4 resolve docker.io/library/node:20-bullseye@sha256:fd16d0493915f578fe2b2bfb9d9179267076ffc899e47e4bcec9ecd42687c6e7 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 2.28MB 4.9s done
#5 ...

#6 [evershop-source 7/8] RUN npm run compile
#6 CACHED

#7 [evershop-source 5/8] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     packages/evershop/src/modules/cms/bootstrap.js
#7 CACHED

#8 [evershop-source 4/8] RUN git clone --depth 1 --branch v2.0.0 https://github.com/evershopcommerce/evershop.git .
#8 CACHED

#9 [evershop-source 8/8] RUN npm run compile --workspace @evershop/postgres-query-builder
#9 CACHED

#10 [stage-1  7/24] COPY patches /tmp/patches
#10 CACHED

#11 [stage-1  2/24] WORKDIR /app
#11 CACHED

#12 [stage-1  3/24] RUN apt-get update &&     apt-get install -y --no-install-recommends ca-certificates python3 make g++ git &&     update-ca-certificates &&     rm -rf /var/lib/apt/lists/*
#12 CACHED

#13 [stage-1  5/24] RUN npm install @evershop/s3_file_storage global-agent stream-chat@8.40.0 stream-chat-react@11.22.0 --legacy-peer-deps
#13 CACHED

#14 [evershop-source 2/8] WORKDIR /opt/evershop
#14 CACHED

#15 [stage-1  4/24] COPY --from=evershop-source /opt/evershop /app
#15 CACHED

#16 [evershop-source 6/8] RUN npm install --legacy-peer-deps
#16 CACHED

#17 [evershop-source 3/8] RUN apt-get update &&     apt-get install -y --no-install-recommends git &&     rm -rf /var/lib/apt/lists/*
#17 CACHED

#18 [stage-1  6/24] COPY config /app/config
#18 CACHED

#19 [stage-1  8/24] COPY scripts /app/scripts
#19 CACHED

#20 [stage-1  9/24] RUN cat <<'EOF' > /app/scripts/entrypoint.sh
#20 DONE 0.1s

#21 [stage-1 10/24] COPY extensions /app/extensions
#21 DONE 4.2s

#5 [internal] load build context
#5 ...

#22 [stage-1 11/24] COPY themes /app/themes-src
#22 DONE 0.2s

#23 [stage-1 12/24] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && HUSKY=0 NPM_CONFIG_PRODUCTION=false npm install --legacy-peer-deps --ignore-scripts --include=dev; fi
#23 0.238 npm warn config production Use `--omit=dev` instead.
#23 1.266 npm warn workspaces @evershop/chatbot in filter set, but no workspace folder present
#23 20.75 npm warn deprecated abab@2.0.6: Use your platform's native atob() and btoa() methods instead
#23 20.79 npm warn deprecated domexception@4.0.0: Use your platform's native DOMException instead
#23 21.31 npm warn deprecated inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
#23 21.32 npm warn deprecated glob@7.2.3: Glob versions prior to v9 are no longer supported
#23 24.37 
#23 24.37 added 325 packages, removed 712 packages, changed 2 packages, and audited 1487 packages in 24s
#23 24.37 
#23 24.37 323 packages are looking for funding
#23 24.37   run `npm fund` for details
#23 24.38 
#23 24.38 6 vulnerabilities (1 low, 4 high, 1 critical)
#23 24.38 
#23 24.38 To address issues that do not require attention, run:
#23 24.38   npm audit fix
#23 24.38 
#23 24.38 To address all issues (including breaking changes), run:
#23 24.38   npm audit fix --force
#23 24.38 
#23 24.38 Run `npm audit` for details.
#23 DONE 25.4s

#5 [internal] load build context
#5 ...

#24 [stage-1 13/24] RUN if [ -f /app/extensions/chatbot/package.json ]; then   cd /app/extensions/chatbot && npm run build; fi
#24 0.363 
#24 0.363 > @evershop/chatbot@1.0.0 build
#24 0.363 > tsc && copyfiles -u 1 "src/**/*.{graphql,scss,json}" dist
#24 0.363 
#24 DONE 3.1s

#5 [internal] load build context
#5 ...

#25 [stage-1 14/24] RUN mkdir -p /app/themes && cp -R /app/themes-src/. /app/themes/
#25 DONE 0.1s

#26 [stage-1 15/24] RUN set -eux;   for theme in /app/themes/*; do     [ -d "${theme}" ] || continue;     name="$(basename "${theme}")";     if [ -f "${theme}/package.json" ]; then       NPM_CONFIG_PRODUCTION=false npm install --prefix "${theme}" --include=dev;       npm run build --prefix "${theme}";       if [ -d "${theme}/dist" ]; then         mkdir -p "/app/themes-src/${name}";         rm -rf "/app/themes-src/${name}/dist";         cp -R "${theme}/dist" "/app/themes-src/${name}/dist";       fi;     fi;   done
#26 0.084 + [ -d /app/themes/redtheme ]
#26 0.084 + basename /app/themes/redtheme
#26 0.085 + name=redtheme
#26 0.085 + [ -f /app/themes/redtheme/package.json ]
#26 0.085 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/redtheme --include=dev
#26 0.192 npm warn config production Use `--omit=dev` instead.
#26 1.305 
#26 1.305 added 5 packages, and audited 6 packages in 1s
#26 1.306 
#26 1.306 found 0 vulnerabilities
#26 1.329 + npm run build --prefix /app/themes/redtheme
#26 1.457 
#26 1.457 > redtheme@0.1.0 build
#26 1.457 > tsc --project tsconfig.json
#26 1.457 
#26 3.129 + [ -d /app/themes/redtheme/dist ]
#26 3.129 + mkdir -p /app/themes-src/redtheme
#26 3.131 + rm -rf /app/themes-src/redtheme/dist
#26 3.131 + cp -R /app/themes/redtheme/dist /app/themes-src/redtheme/dist
#26 3.136 + [ -d /app/themes/venia ]
#26 3.136 + basename /app/themes/venia
#26 3.137 + name=venia
#26 3.137 + [ -f /app/themes/venia/package.json ]
#26 3.137 + NPM_CONFIG_PRODUCTION=false npm install --prefix /app/themes/venia --include=dev
#26 3.238 npm warn config production Use `--omit=dev` instead.
#26 4.142 
#26 4.142 added 5 packages, and audited 6 packages in 936ms
#26 4.143 
#26 4.143 found 0 vulnerabilities
#26 4.167 + npm run build --prefix /app/themes/venia
#26 4.297 
#26 4.297 > venia@0.1.0 build
#26 4.297 > tsc --project tsconfig.json
#26 4.297 
#26 5.986 + [ -d /app/themes/venia/dist ]
#26 5.986 + mkdir -p /app/themes-src/venia
#26 5.988 + rm -rf /app/themes-src/venia/dist
#26 5.989 + cp -R /app/themes/venia/dist /app/themes-src/venia/dist
#26 DONE 6.1s

#5 [internal] load build context
#5 ...

#27 [stage-1 16/24] COPY patches/awsFileUploader.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileUploader.js
#27 DONE 0.0s

#5 [internal] load build context
#5 ...

#28 [stage-1 17/24] COPY patches/awsFileBrowser.js /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileBrowser.js
#28 DONE 0.0s

#29 [stage-1 18/24] COPY patches/awsGenerateProductImageVariant.js /app/node_modules/@evershop/s3_file_storage/dist/subscribers/product_image_added/awsGenerateProductImageVariant.js
#29 DONE 0.0s

#30 [stage-1 19/24] RUN set -eux;   for f in     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js     /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js; do     if [ -f "$f" ]; then       sed -i 's/new S3Client({ region: getEnv("AWS_REGION") });/new S3Client({ region: getEnv("AWS_REGION"), endpoint: process.env.AWS_ENDPOINT_URL_S3, forcePathStyle: true });/g' "$f";     else       echo "Skipping patch for missing file $f";     fi;   done
#30 0.081 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js ]
#30 0.082 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#30 0.082 + [ -f /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js ]
#30 0.082 + echo Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#30 0.082 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFolderCreator.js
#30 0.082 Skipping patch for missing file /app/node_modules/@evershop/s3_file_storage/dist/services/awsFileDeleter.js
#30 DONE 0.1s

#31 [stage-1 20/24] COPY patches/uploadFile.js /app/node_modules/@evershop/evershop/src/modules/cms/services/uploadFile.js
#31 DONE 0.0s

#32 [stage-1 21/24] RUN sed -i '/"type": "module",/a\  "main": "dist/bootstrap.js",'     /app/node_modules/@evershop/s3_file_storage/package.json
#32 DONE 0.1s

#33 [stage-1 22/24] RUN sed -i "s/enum: \['local'\]/enum: ['local', 's3']/"     /app/node_modules/@evershop/evershop/src/modules/cms/bootstrap.js
#33 DONE 0.1s

#34 [stage-1 23/24] RUN chmod +x /app/scripts/entrypoint.sh
#34 DONE 0.1s

#35 [stage-1 24/24] RUN npm run build
#35 0.215 
#35 0.215 > evershop@1.2.2 build
#35 0.215 > node ./packages/evershop/dist/bin/build/index.js
#35 0.215 
#35 2.281 â„¹ Compiling Client
#35 2.309 â„¹ Compiling Server
#35 40.02 Browserslist: browsers data (caniuse-lite) is 7 months old. Please run:
#35 40.02   npx update-browserslist-db@latest
#35 40.02   Why you should do it regularly: https://github.com/browserslist/update-db#readme
#35 116.3 âœ” Client: Compiled successfully in 1.90m
#35 116.3 âœ” Server: Compiled successfully in 1.90m
#35 DONE 117.1s

#5 [internal] load build context
#5 ...

#36 exporting to image
#36 exporting layers
#36 exporting layers 4.0s done
#36 exporting manifest sha256:046e48d4e78fe969850c1f964633d52299dda60a63c5b73d2690fd49a7b9ce58 done
#36 exporting config sha256:07e29f35b3918b8c21f209c92f90bfcedb9016d409aa184396d6d0bb759f66c7 done
#36 pushing layers for registry.fly.io/evershop-fly:deployment-01K91Q9N8GZB0YCY4GHCDZCY9X@sha256:046e48d4e78fe969850c1f964633d52299dda60a63c5b73d2690fd49a7b9ce58
#36 pushing layer sha256:07e29f35b3918b8c21f209c92f90bfcedb9016d409aa184396d6d0bb759f66c7
#36 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609
#36 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff
#36 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f
#36 pushing layer sha256:f65bbff5c1d8c85ba60bc0a25ebc794330a07adb1cc55ab8d00df22276e07b07
#36 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1
#36 pushing layer sha256:9da9f1be625e7895cdd639ed578808a903ddd03e6114708573a8ea1ee17fece3
#36 pushing layer sha256:db36128467709c236cc05be1b8a144f5d1ca65a17c7de7b50e2606b14012ff1e
#36 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158
#36 pushing layer sha256:812da3e817304d4ee9448790849c219ef978ae2af3fcd3c9054de154ea67e2f6
#36 pushing layer sha256:2fdc7297f65c718680abdcb7af240255c7b480995b8b17193b966e1f944692a3
#36 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a
#36 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6
#36 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3
#36 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832
#36 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0
#36 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e
#36 pushing layer sha256:30df31b43082fb0314c841fd64375222a0ddf3816c349d9c6b6cd2eedd53cb59
#36 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3
#36 pushing layer sha256:19c9a04a5333e4e32221a1cb9f8ad2bc0e51763d487ba78c70cf317ab4e3d6a6
#36 pushing layer sha256:6d1043efd24fbfd77a56a4fb2eff64ac90e10c8a13280b0b278188c09e76ff27
#36 pushing layer sha256:61404b733c59d5503f061eae5d153db565e34054c72f055cb03fc5d8305af99d
#36 pushing layer sha256:a71dc2a4816da92be2b715d4a5063f388b6c4d15271cd7271f03db04c1865b42
#36 pushing layer sha256:99cb8f0f96db32e42fb10bd044d7eb0d50151101b6500471be369afe04d1a7d9
#36 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f
#36 pushing layer sha256:ec0e6511fdcf0f5cbb29d71ce2f0d1bb05b03496584abc18d4d5249e7a2153a2
#36 pushing layer sha256:4aaa87979775ed62c9c66d98d169e168d1096f005fee12168f8bf90cec764c15
#36 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d
#36 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13
#36 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207
#36 pushing layer sha256:036f5f3b764e3d588be040f83868fd81e363cb7d4cdd48368b3551cf823d537e
#36 pushing layer sha256:1fdd1092a8324c9c682489951617441e923953c1c58ae4b72df54891a729a5ff 0.5s done
#36 pushing layer sha256:08ba12cd8ffe2f2f03c1d98b8819aa7e93eb6dc8b52da75f240871b61e787158 3.9s done
#36 pushing layer sha256:1d2a8e3c86a3f98ea964a5179cfe04ce8f534a77133ec5c3099a5987129a4609 3.9s done
#36 pushing layer sha256:2c1ce468d9f3d941396801f6e3afc8921466650dd05430fe644cd3537713d27f 3.9s done
#36 pushing layer sha256:8549298772a6ce4eb21f60ffe6e1b8d1f7e16c91404b401f141da6c4e48471c1 3.9s done
#36 pushing layer sha256:89e55550533e191c85eb40d658155b7640ab655c671a54aab156a072e0cd5a7a 3.9s done
#36 pushing layer sha256:d40cc0d79de261c5f68079d400823fd250caa2dc5bfcbe1233716181037f02e6 3.9s done
#36 pushing layer sha256:ac8427482ecaecbc4ff4495a538e625720bebc9b19e049d8dbac02a58965c1e3 3.9s done
#36 pushing layer sha256:d001abc85623e6730198382fc0cf845746a7d89e4f7944ecb66d1108ca81b832 3.9s done
#36 pushing layer sha256:567cd1fe65a6238ce3dd7e74ea6995d02a03b7761d4bd61394e945c9031345c0 3.9s done
#36 pushing layer sha256:1d527ac9b092b99b0b25dfded3e5e069e9dc86df18370826cf2c3a1b7b7a437e 3.9s done
#36 pushing layer sha256:e92441c3ef359de633ca173cee97a78bd3ab9e59f176389dee656bfb2eff1dd3 3.9s done
#36 pushing layer sha256:095d94e285292075c94c2994bbfcdd011019b44580a93ca37cb594ee38974f4f 3.9s done
#36 pushing layer sha256:812da3e817304d4ee9448790849c219ef978ae2af3fcd3c9054de154ea67e2f6 4.1s done
#36 pushing layer sha256:07e29f35b3918b8c21f209c92f90bfcedb9016d409aa184396d6d0bb759f66c7 4.1s done
#36 pushing layer sha256:9da9f1be625e7895cdd639ed578808a903ddd03e6114708573a8ea1ee17fece3 4.1s done
#36 pushing layer sha256:db36128467709c236cc05be1b8a144f5d1ca65a17c7de7b50e2606b14012ff1e 4.2s done
#36 pushing layer sha256:2fdc7297f65c718680abdcb7af240255c7b480995b8b17193b966e1f944692a3 4.1s done
#36 pushing layer sha256:19c9a04a5333e4e32221a1cb9f8ad2bc0e51763d487ba78c70cf317ab4e3d6a6 4.2s done
#36 pushing layer sha256:61404b733c59d5503f061eae5d153db565e34054c72f055cb03fc5d8305af99d 4.1s done
#36 pushing layer sha256:a71dc2a4816da92be2b715d4a5063f388b6c4d15271cd7271f03db04c1865b42 4.2s done
#36 pushing layer sha256:5653bca1ef1bdbaef8e7501541c4a77cd1fa711077974fca7d3afd53e0e9340d 4.2s done
#36 pushing layer sha256:115fc342b4f2f082c946ce776457453891567f9c63830e5f3ad1e67ddda14207 4.2s done
#36 pushing layer sha256:6d1043efd24fbfd77a56a4fb2eff64ac90e10c8a13280b0b278188c09e76ff27 4.2s done
#36 pushing layer sha256:99cb8f0f96db32e42fb10bd044d7eb0d50151101b6500471be369afe04d1a7d9 4.2s done
#36 pushing layer sha256:ec0e6511fdcf0f5cbb29d71ce2f0d1bb05b03496584abc18d4d5249e7a2153a2 4.2s done
#36 pushing layer sha256:45a89ecccab18aa890a4eec5ca00397c84f488ec1ed35d356bb01e4216115b13 4.2s done
#36 pushing layer sha256:036f5f3b764e3d588be040f83868fd81e363cb7d4cdd48368b3551cf823d537e 4.5s done
#36 pushing layer sha256:30df31b43082fb0314c841fd64375222a0ddf3816c349d9c6b6cd2eedd53cb59 4.6s done
#36 pushing layer sha256:4aaa87979775ed62c9c66d98d169e168d1096f005fee12168f8bf90cec764c15 4.9s done
#36 pushing layers for registry.fly.io/evershop-fly:deployment-01K91Q9N8GZB0YCY4GHCDZCY9X@sha256:046e48d4e78fe969850c1f964633d52299dda60a63c5b73d2690fd49a7b9ce58 5.0s done
#36 pushing layer sha256:f65bbff5c1d8c85ba60bc0a25ebc794330a07adb1cc55ab8d00df22276e07b07 5.0s done
#36 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91Q9N8GZB0YCY4GHCDZCY9X@sha256:046e48d4e78fe969850c1f964633d52299dda60a63c5b73d2690fd49a7b9ce58
#36 pushing manifest for registry.fly.io/evershop-fly:deployment-01K91Q9N8GZB0YCY4GHCDZCY9X@sha256:046e48d4e78fe969850c1f964633d52299dda60a63c5b73d2690fd49a7b9ce58 0.1s done
#36 DONE 9.1s

#5 [internal] load build context
--> Build Summary:  (â€‹)
[38;5;252m--> Building image done[0m
image: registry.fly.io/evershop-fly:deployment-01K91Q9N8GZB0YCY4GHCDZCY9X
image size: 498 MB

Watch your deployment at https://fly.io/apps/evershop-fly/monitoring

Updating existing machines in 'evershop-fly' with rolling strategy
> Acquiring lease for 1859727f4d5d58
> Acquired lease for 1859727f4d5d58
> Updating machine config for 1859727f4d5d58
> Updating 1859727f4d5d58 [app]
> Updated machine config for 1859727f4d5d58
âœ” Machine 1859727f4d5d58 is now in a good state
> Clearing lease for 1859727f4d5d58
âœ” Cleared lease for 1859727f4d5d58
Checking DNS configuration for evershop-fly.fly.dev
WARNING: DNS verification failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0
Your app is deployed but DNS may take a few minutes to propagate globally
[33mWARN[0m DNS checks failed: expected 1 AAAA records for evershop-fly.fly.dev., got 0


Visit your newly deployed app at https://evershop-fly.fly.dev/

